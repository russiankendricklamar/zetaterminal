# 3D Визуализация пространства скрытых состояний (HMM Regime Space)

## Описание

Инновационная 3D визуализация пространства скрытых состояний для анализа рыночных режимов с использованием Hidden Markov Models (HMM). Визуализация показывает, как рынок перемещается между различными режимами в трехмерном пространстве, где:
- **X-ось**: Доходность (Return, %)
- **Y-ось**: Волатильность (Volatility, %)  
- **Z-ось**: Ликвидность (Volume/Liquidity ratio)

## Архитектура

### Модули

1. **`useHMMModel.ts`** - Класс `HMMModel`:
   - Forward-Backward алгоритм для вычисления posterior probabilities
   - Viterbi алгоритм для определения наиболее вероятной последовательности
   - Вычисление стационарного распределения
   - Вычисление ожидаемой длительности режимов
   - Генерация mock данных для тестирования

2. **`useRegimeSpace3D.ts`** - Класс `RegimeSpaceRenderer`:
   - Инициализация Three.js сцены, камеры, рендерера
   - Создание 3D визуализации:
     - Оси координат с цветовой кодировкой
     - Эллипсоиды режимов (полупрозрачные облака)
     - Центроиды режимов (яркие сферы)
     - Траектория рынка (линия и точки)
     - Стрелки вероятностей переходов
   - Управление камерой с preset views
   - Плавные анимации через GSAP

3. **`RegimeSpace3D.vue`** - Vue компонент:
   - Интеграция с HMM моделью и рендерером
   - UI контролы (параметры, видимость, камера)
   - Timeline для навигации по истории
   - Playback с регулируемой скоростью
   - Аналитические панели (матрица переходов, стационарное распределение)
   - Экспорт данных (PNG, CSV)

## Режимы рынка

По умолчанию определены 4 режима:

1. **Low Volatility / Accumulation** (Зеленый)
   - Низкая волатильность, накопление позиций
   - Положительная доходность
   - Высокая ликвидность

2. **Normal / Trending** (Голубой/Cyan)
   - Нормальная волатильность, тренд
   - Умеренная доходность
   - Средняя ликвидность

3. **High Volatility / Distribution** (Пурпурный/Magenta)
   - Высокая волатильность, распределение
   - Отрицательная доходность
   - Низкая ликвидность

4. **Crisis / Panic Selling** (Красный)
   - Экстремальная волатильность, паника
   - Сильно отрицательная доходность
   - Очень низкая ликвидность

## Использование

### Базовое использование

```vue
<template>
  <RegimeSpace3D 
    :initial-asset="'SPY'"
    :initial-n-states="4"
  />
</template>

<script setup>
import RegimeSpace3D from '@/components/common/RegimeSpace3D.vue'
</script>
```

### В странице RegimeAnalysis

Компонент уже интегрирован в `RegimeAnalysis.vue` с переключением между 2D и 3D видами через вкладки.

## Функции

### Визуализация
- ✅ 3D пространство с осями координат
- ✅ Траектория рынка (линия и точки)
- ✅ Эллипсоиды режимов (2-sigma confidence regions)
- ✅ Центроиды режимов с пульсирующей анимацией
- ✅ Стрелки вероятностей переходов между режимами
- ✅ Цветовая кодировка по режимам
- ✅ Размер точек зависит от уверенности модели

### Интерактивность
- ✅ OrbitControls: вращение, zoom, pan
- ✅ Preset views камеры (Top, Side, Isometric, Front)
- ✅ Плавные переходы между видами (GSAP)
- ✅ Auto-rotate режим
- ✅ Timeline slider для навигации по истории
- ✅ Playback с регулируемой скоростью (0.5x, 1x, 2x, 5x)

### Аналитика
- ✅ Матрица переходов (Transition Matrix)
- ✅ Стационарное распределение
- ✅ Ожидаемая длительность режимов
- ✅ Текущий режим с вероятностью и характеристиками
- ✅ Фильтры по времени (3M, 6M, 1Y, 2Y, All)

### Экспорт
- ✅ Скриншот текущего вида (PNG)
- ✅ Экспорт данных в CSV

## Производительность

- Instanced rendering для множества точек
- LOD (Level of Detail) для оптимизации
- Throttled render loop (60 FPS)
- WebGL для аппаратного ускорения
- Memory management для длинных траекторий

## Будущие улучшения

- [ ] Исторические события с маркерами
- [ ] "God View" режим (heatmap плотности вероятности)
- [ ] Pattern Recognition Mode
- [ ] Сравнение HMM vs GMM vs K-means
- [ ] Multi-asset режим синхронизации
- [ ] Видео запись траектории (WebM)
- [ ] Export GLTF/GLB 3D модели
- [ ] Web Workers для heavy calculations
- [ ] Baum-Welch визуализация процесса обучения

## Технические детали

### Зависимости
- `three` (^0.182.0) - 3D библиотека
- `gsap` (^3.14.2) - анимации
- `vue` (^3.4.15) - фреймворк

### Требования
- WebGL поддерживающий браузер
- Минимум 4GB RAM (для больших датасетов)

## Методология

Визуализация основана на концепции Джима Саймонса о том, что рынки - это не random walk, а learnable Markov processes. HMM позволяет:
- Идентифицировать скрытые состояния рынка
- Предсказывать переходы между режимами
- Анализировать временные характеристики режимов
- Строить более эффективные торговые стратегии
