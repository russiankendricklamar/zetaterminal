# 3.3. –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ HMM Regime Detection

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ —Ä–µ–∂–∏–º—ã —á–µ—Ä–µ–∑ **Hidden Markov Models** (—Å–∫—Ä—ã—Ç—ã–µ –º–∞—Ä–∫–æ–≤—Å–∫–∏–µ –º–æ–¥–µ–ª–∏) –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º 3D-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ.

## –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç HMM

### –ú–æ–¥–µ–ª—å
–ú—É–ª—å—Ç–∏–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–µ –≥–∞—É—Å—Å–æ–≤—Å–∫–∏–µ —ç–º–∏—Å—Å–∏–æ–Ω–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ —Ç—Ä—ë–º –∏–∑–º–µ—Ä–µ–Ω–∏—è–º:
- **Returns** (–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏)
- **Volatility** (–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)
- **Liquidity** (–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å)

### Forward-Backward –∞–ª–≥–æ—Ä–∏—Ç–º

–í—ã—á–∏—Å–ª—è–µ—Ç –∞–ø–æ—Å—Ç–µ—Ä–∏–æ—Ä–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ –Ω–∞ –∫–∞–∂–¥–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–º —à–∞–≥–µ.

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Œ±[0][i] = œÄ[i] √ó P(o[0] | i)
```

**–†–µ–∫—É—Ä—Å–∏—è (forward):**
```
Œ±[t][j] = Œ£·µ¢ (Œ±[t-1][i] √ó A[i][j]) √ó P(o[t] | j)
```

**Backward:**
```
Œ≤[T][i] = 1
Œ≤[t][i] = Œ£‚±º A[i][j] √ó P(o[t+1] | j) √ó Œ≤[t+1][j]
```

**Smoothed estimates:**
```
Œ≥[t][i] = (Œ±[t][i] √ó Œ≤[t][i]) / Œ£‚±º (Œ±[t][j] √ó Œ≤[t][j])
```

### Viterbi –∞–ª–≥–æ—Ä–∏—Ç–º

–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∫—Ä—ã—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π.

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Œ¥[0][i] = log(œÄ[i]) + log(P(o[0] | i))
```

**–†–µ–∫—É—Ä—Å–∏—è:**
```
Œ¥[t][j] = max_i(Œ¥[t-1][i] + log(A[i][j])) + log(P(o[t] | j))
œà[t][j] = argmax_i(Œ¥[t-1][i] + log(A[i][j]))
```

**Backtracking:**
```
s*[T] = argmax_i(Œ¥[T][i])
s*[t] = œà[t+1][s*[t+1]]
```

### –≠–º–∏—Å—Å–∏–æ–Ω–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å

–ú—É–ª—å—Ç–∏–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ–µ –≥–∞—É—Å—Å–æ–≤–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
```
P(o | s) = (2œÄ)^(-3/2) √ó |Œ£|^(-1/2) √ó exp(-0.5 √ó (o - Œº)·µÄ √ó Œ£‚Åª¬π √ó (o - Œº))
```
–≥–¥–µ `o` ‚Äî 3D –≤–µ–∫—Ç–æ—Ä –Ω–∞–±–ª—é–¥–µ–Ω–∏—è, `Œº` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ —Ä–µ–∂–∏–º–∞, `Œ£` ‚Äî –∫–æ–≤–∞—Ä–∏–∞—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞.

## 3D-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (RegimeSpace3D)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç RegimeSpace3D.vue
–û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é:
- –í—ã–±–æ—Ä –∞–∫—Ç–∏–≤–∞: SPY, QQQ, BTC, IMOEX
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π: 2-5
- –ü–µ—Ä–∏–æ–¥: 3M, 6M, 1Y, 2Y, ALL
- Toggle: —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏, —ç–ª–ª–∏–ø—Å–æ–∏–¥—ã, —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã, —Å–µ—Ç–∫–∞
- Timeline scrubbing –∏ playback –∞–Ω–∏–º–∞—Ü–∏—è

### –†–µ–Ω–¥–µ—Ä–µ—Ä (useRegimeSpace3D.ts)

**–°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**
- **X-axis**: Liquidity (–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å)
- **Y-axis**: Volatility (–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)
- **Z-axis**: Returns (–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏)

**–¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –ø–æ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏:**
- üîµ –°–∏–Ω–∏–π: <15% vol (–Ω–∏–∑–∫–∞—è)
- üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π: 15-30% vol (—Å—Ä–µ–¥–Ω—è—è)
- üî¥ –ö—Ä–∞—Å–Ω—ã–π: >30% vol (–≤—ã—Å–æ–∫–∞—è)

### –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

**–≠–ª–ª–∏–ø—Å–æ–∏–¥—ã —Ä–µ–∂–∏–º–æ–≤:**
```
radius = (‚àöcov[0][0] + ‚àöcov[1][1] + ‚àöcov[2][2]) / 3 √ó 4.5
```
–ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Å—Ñ–µ—Ä–∞ + wireframe overlay.

**–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏:**
BufferGeometry —Å –ª–∏–Ω–µ–π–Ω—ã–º–∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏, –æ–∫—Ä–∞—à–µ–Ω–Ω—ã–º–∏ –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ä–µ–∂–∏–º—É. –£–∑–ª—ã –Ω–∞ –∫–∞–∂–¥–æ–º timestep –¥–ª—è hover-–¥–µ—Ç–µ–∫—Ü–∏–∏.

**–°–µ—Ç–∫–∞:**
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è: 120√ó120 –µ–¥–∏–Ω–∏—Ü (X/Z), 24 –¥–µ–ª–µ–Ω–∏—è
- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è: 80 –µ–¥–∏–Ω–∏—Ü –≤—ã—Å–æ—Ç—ã (Y), 16 –¥–µ–ª–µ–Ω–∏–π

**–°—Ç—Ä–µ–ª–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ (–ø–æ—Ä–æ–≥ >0.1). –¶–≤–µ—Ç –ø–æ —Ü–µ–ª–µ–≤–æ–º—É —Ä–µ–∂–∏–º—É, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- GPU preference: `powerPreference: 'high-performance'`
- Pixel ratio ‚â§ 2x
- OrbitControls damping: 0.05
- Exponential fog (density: 0.008) –¥–ª—è –≥–ª—É–±–∏–Ω—ã
- Time-based –∏ regime visibility —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

## –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ (Portfolio.vue)

### KPI-–º–µ—Ç—Ä–∏–∫–∏
- Total P&L
- Annual return (%)
- VaR (95%)
- Sharpe ratio
- Diversification coefficient

### –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π
5 —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ 25 –ø–æ–∑–∏—Ü–∏–π –∫–∞–∂–¥—ã–π ‚Äî –º–∏–∫—Å —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∞–∫—Ü–∏–π (SBER, GAZP, LKOH) –∏ –æ–±–ª–∏–≥–∞—Ü–∏–π (–û–§–ó, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ).

### 3D Asset Heatmap
- –†–∞–∑–º–µ—Ä —Å—Ñ–µ—Ä—ã: –≤–µ—Å –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ
- –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏

## –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### CorrelationScatter3D
- Toggle 3D/2D —Ä–µ–∂–∏–º—ã
- Raw –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è vs PCA-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- –†–µ–∂–∏–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
- Confidence ellipses
- Outlier detection
- Regression line overlay
- K-Means –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è

### PCA —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
```
PC1 = x √ó eigenvec1[0] + y √ó eigenvec1[1]
PC2 = x √ó eigenvec2[0] + y √ó eigenvec2[1]
```

### K-Means –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
- –°–ª—É—á–∞–π–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è K —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤
- –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –∫ –±–ª–∏–∂–∞–π—à–µ–º—É —Ü–µ–Ω—Ç—Ä–æ–∏–¥—É (–µ–≤–∫–ª–∏–¥–æ–≤–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–∏—Ö
- –°—Ö–æ–¥–∏–º–æ—Å—Ç—å: <100 –∏—Ç–µ—Ä–∞—Ü–∏–π, Œî < 0.001

## –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è
- Device detection —á–µ—Ä–µ–∑ `useIsMobile()`
- Fallback –Ω–∞ 2D-—Ä–µ–∂–∏–º –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö
- –£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã
