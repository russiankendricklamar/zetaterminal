# 3.4. Терминал анализа рынка

## Обзор

Market Analysis Terminal — специализированный компонент для финансового анализа в стиле терминала, использующий спектральную декомпозицию для определения рыночных режимов.

## Архитектура

### Terminal.vue
Основной интерфейс включает:
- Выпадающий список активов
- Командный интерфейс для запуска анализа
- Визуализация результатов через ECharts
- Multi-window система

### Спектральный сервис (Backend)
`SpectralRegimeAnalyzer` в `spectral_regime_service.py`:
- Вычисление ACF (автокорреляционная функция)
- Метод Прони для спектральной факторизации
- Кластеризация полюсов
- Скользящее окно для динамического анализа

## Метод Прони

### Математический фундамент

Метод Прони восстанавливает компоненты сигнала как затухающие экспоненты, позволяя извлечь скрытые периодичности рыночных данных.

**Алгоритм:**

1. **Вычисление ACF** — автокорреляционная функция с максимальным лагом
2. **Ганкелева матрица** — построение матрицы из ACF-значений
3. **Eigendecomposition** — разложение на собственные значения (полюса)
4. **Кластеризация** — иерархическая кластеризация полюсов (scipy)
5. **Классификация режимов** — по модулю полюса

### Классификация полюсов

| Диапазон |λ_k| | Классификация |
|-----------|-----------------|
| < 0.5 | Шум |
| 0.5 - 0.8 | Слабый тренд |
| 0.8 - 0.95 | Умеренный тренд |
| 0.95 - 0.999 | Сильный тренд |
| ≥ 0.999 | Кризис |

### Динамический анализ

Скользящее окно вычисляет:
- **Режимные энергии** — вклад каждого режима в текущий момент
- **Энтропия Шеннона** — мера неопределённости распределения энергий

## Pipeline анализа

```
1. Пользователь выбирает актив в терминале
2. Запрос исторических цен через Yahoo Finance (2-year lookback)
3. Backend вычисляет ACF
4. Метод Прони факторизует спектральную плотность
5. Полюса кластеризуются
6. Результаты возвращаются клиенту
7. Terminal.vue рендерит через ECharts:
   - Диаграмма полюсов на комплексной плоскости
   - Спектральный график
   - Timeline режимов с энтропией
   - Таблица параметров режимов
```

## API Endpoints

| Метод | Endpoint | Назначение |
|-------|----------|------------|
| POST | `/api/spectral-regime/analyze` | Анализ массива доходностей |
| POST | `/api/spectral-regime/analyze-asset` | Fetch данных + анализ |
| GET | `/api/spectral-regime/available-assets` | Список доступных активов |

## Вычислительная сложность

| Этап | Сложность |
|------|-----------|
| Прони (Ганкелева матрица) | O(H³), H = max_lag |
| Кластеризация | O(M² log M), M = кол-во полюсов |
| Динамический анализ | O(T × K × W), T = длина ряда |

## Multi-Window система

Терминал поддерживает:
- Несколько независимых окон
- Управление вкладками
- Скроллинг вывода и история команд
- Встроенные графики ECharts
- Keyboard shortcuts для навигации
