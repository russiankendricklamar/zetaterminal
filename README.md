# Stochastic Dashboard v1

**ะัะพัะตััะธะพะฝะฐะปัะฝะฐั ะฐะฝะฐะปะธัะธัะตัะบะฐั ะฟะปะฐััะพัะผะฐ ะดะปั ะบะพะปะธัะตััะฒะตะฝะฝะพะณะพ ะผะพะดะตะปะธัะพะฒะฐะฝะธั ะฟัะพะธะทะฒะพะดะฝัั ะธะฝััััะผะตะฝัะพะฒ ะธ ัะฟัะฐะฒะปะตะฝะธั ััะฝะพัะฝัะผะธ ัะธัะบะฐะผะธ**

---

## ๐ Bottom Line

Stochastic Dashboard v1 โ ััะพ production-ready full-stack ะฟัะธะปะพะถะตะฝะธะต ะดะปั ะพัะตะฝะบะธ ัะปะพะถะฝัั ะฟัะพะธะทะฒะพะดะฝัั ะธะฝััััะผะตะฝัะพะฒ, ัััะตัั-ัะตััะธัะพะฒะฐะฝะธั ะฟะพัััะตะปะตะน ะธ ะฐะฝะฐะปะธะทะฐ ััะฝะพัะฝัั ัะตะถะธะผะพะฒ. ะะตะฐะปะธะทะพะฒะฐะฝะพ ะฝะฐ **Python 3.11+** (FastAPI) + **Vue.js 3** (Composition API) ั ะฟะพะดะดะตัะถะบะพะน ััะพัะฐััะธัะตัะบะธั ะผะพะดะตะปะตะน Lรฉvy, HMM-ัะตะณะธะผะฝัั ะฟะตัะตะบะปััะตะฝะธะน ะธ GARCH-ะฒะพะปะฐัะธะปัะฝะพััะธ. ะะพะดัะพะดะธั ะดะปั sell-side ััััะบัััะธัะพะฒะฐะฝะธั, ัะธัะบ-ะผะตะฝะตะดะถะผะตะฝัะฐ ะธ ะธััะปะตะดะพะฒะฐัะตะปััะบะพะณะพ ะฐะฝะฐะปะธะทะฐ.

---

## ะะปััะตะฒัะต ะฒะพะทะผะพะถะฝะพััะธ

| ะะพะดัะปั | ะะฟะธัะฐะฝะธะต | ะกัะฐััั |
|--------|----------|--------|
| **ะัะตะฝะบะฐ ะพะฟัะธะพะฝะพะฒ** | Black-Scholes, Heston, SABR, Lรฉvy-ะผะพะดะตะปะธ (CGMY, VG, NIG) | โ Production |
| **ะกัััะบัััะฝัะต ะฟัะพะดัะบัั** | Autocallables, Barrier options, Cliquets, Snowballs | โ Production |
| **ะะตะถะธะผะฝัะต ะผะพะดะตะปะธ** | Hidden Markov Models (2-4 ัะพััะพัะฝะธั), ัะธะปััั ะะธะผะผะฐ | โ Production |
| **ะะพะปะฐัะธะปัะฝะพััั** | GARCH(1,1), EGARCH, GJR-GARCH, Realized Volatility | โ Production |
| **ะะพะฝัะต-ะะฐัะปะพ** | Quasi-MC (Sobol), MLMC, Importance Sampling | โ Production |
| **ะะธะทัะฐะปะธะทะฐัะธั** | ะะฝัะตัะฐะบัะธะฒะฝัะต 3D-ะณัะฐัะธะบะธ ะฟะพะฒะตััะฝะพััะตะน ะฒะพะปะฐัะธะปัะฝะพััะธ, regime probabilities | โ Production |
| **API** | RESTful endpoints ั OpenAPI 3.0 ัะฟะตัะธัะธะบะฐัะธะตะน | โ Production |
| **ะะฐะทะฐ ะดะฐะฝะฝัั** | PostgreSQL + TimescaleDB ะดะปั ะฒัะตะผะตะฝะฝัั ััะดะพะฒ | โ Production |

---

## ะััะธัะตะบัััะฐ

### High-Level Design

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         Frontend Layer (Vue.js 3)                    โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโ โ
โ  โ Dashboard   โ  โ Pricing     โ  โ Risk        โ  โ Admin     โ โ
โ  โ Components  โ  โ Calculator  โ  โ Analytics   โ  โ Panel     โ โ
โ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโ โ
โ         โ                โ                โ                โ      โ
โ         โโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโดโโโโโโโ โ
โ                                  โ                                    โ
โ                         State Management (Pinia)                     โ
โ                                  โ                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ HTTP/HTTPS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         Backend Layer (FastAPI)                      โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโ โ
โ  โ API Routes  โ  โ Pricing     โ  โ Data        โ  โ Risk      โ โ
โ  โ /v1/pricing โ  โ Engine      โ  โ Connectors  โ  โ Engine    โ โ
โ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโโโ  โโโโโโโโฌโโโโโ โ
โ         โ                โ                โ                โ      โ
โ         โโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโดโโโโโโโ โ
โ                                  โ                                    โ
โ                         Services Layer                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  MOEX API | Bloomberg API | PostgreSQL | Redis (Cache)        โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

**Backend:**
- **FastAPI** โ ะฒััะพะบะพะฟัะพะธะทะฒะพะดะธัะตะปัะฝัะน ASGI-ััะตะนะผะฒะพัะบ
- **Pydantic** โ ะฒะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั ะธ ัะตัะธะฐะปะธะทะฐัะธั
- **NumPy/SciPy** โ ัะธัะปะตะฝะฝัะต ะฒััะธัะปะตะฝะธั
- **Numba** โ JIT-ะบะพะผะฟะธะปััะธั ะดะปั ะบัะธัะธัะฝะพะณะพ ะบ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะบะพะดะฐ
- **Cython** โ ะพะฟัะธะผะธะทะฐัะธั ะฒััะธัะปะตะฝะธะน ะะพะฝัะต-ะะฐัะปะพ
- **SQLAlchemy 2.0** โ ORM ั ะฐัะธะฝััะพะฝะฝะพะน ะฟะพะดะดะตัะถะบะพะน
- **Alembic** โ ะผะธะณัะฐัะธะธ ะฑะฐะทั ะดะฐะฝะฝัั
- **Redis** โ ะบััะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ ัะฐััะตัะพะฒ

**Frontend:**
- **Vue.js 3** โ Composition API + `<script setup>`
- **TypeScript** โ ัััะพะณะฐั ัะธะฟะธะทะฐัะธั
- **Vite** โ ัะฑะพัะบะฐ ะธ dev-ัะตัะฒะตั
- **Pinia** โ state management
- **Vue Router** โ ะฝะฐะฒะธะณะฐัะธั
- **ECharts 5** โ ะธะฝัะตัะฐะบัะธะฒะฝัะต ะณัะฐัะธะบะธ
- **Three.js** โ 3D-ะฒะธะทัะฐะปะธะทะฐัะธั ะฟะพะฒะตััะฝะพััะตะน
- **Element Plus** โ UI-ะบะพะผะฟะพะฝะตะฝัั

**Infrastructure:**
- **Docker** + Docker Compose
- **PostgreSQL 15** + TimescaleDB
- **Nginx** โ reverse proxy
- **Prometheus** + **Grafana** โ ะผะพะฝะธัะพัะธะฝะณ
- **pytest** โ ัะตััะธัะพะฒะฐะฝะธะต (unit + integration)
- **GitHub Actions** โ CI/CD

---

## ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Python 3.11+
- Node.js 18+
- PostgreSQL 15+ ั TimescaleDB
- Redis 7+
- Docker ะธ Docker Compose (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะฝะพ ัะตะบะพะผะตะฝะดัะตััั)

# ะะฝััััะบัะธั ะฟะพ ะดะตะฟะปะพั ะฟัะพะตะบัะฐ

## Frontend (ัะถะต ัะฐะทะฒะตัะฝัั)
Frontend ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะตะฟะปะพะธััั ะฝะฐ GitHub Pages ะฟัะธ ะฟััะต ะฒ `main` ะฒะตัะบั.

URL: `https://russiankendricklamar.github.io/stochastic-dashbord-v1/`

## Backend

### Railway.app

1. ะกะพะทะดะฐะตะผ ะฝะพะฒัะน ะฟัะพะตะบั โ **New Project** โ **Deploy from GitHub repo**
2. ะัะฑะธัะฐะตะผ ัะตะฟะพะทะธัะพัะธะน `stochastic-dashbord-v1`
3. Railway ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปะธั ััะพ ััะพ Python ะฟัะพะตะบั
4. ะะพะฑะฐะฒะปัะตะผ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
5. ะะฑะฝะพะฒะปัะตะผ frontend ััะพะฑั ะธัะฟะพะปัะทะพะฒะฐัั ััะพั URL:

## ะะพัะปะต ะดะตะฟะปะพั Backend

### ะะฑะฝะพะฒะปะตะฝะธะต Frontend ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั Production API

1. ะะพะปััะฐะตะผ URL ัะฐะทะฒะตัะฝััะพะณะพ backend
2. ะะฑะฝะพะฒะปัะตะผ GitHub Pages workflow ััะพะฑั ะธัะฟะพะปัะทะพะฒะฐัั ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั:
3. ะะพัะปะต ัะปะตะดัััะตะณะพ ะฟััะฐ frontend ะฑัะดะตั ะธัะฟะพะปัะทะพะฒะฐัั production backend

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

ะะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ ัะพะทะดะฐะตะผ ัะฐะนะป `frontend/.env.local`:
```
VITE_API_BASE_URL=http://localhost:8000
```

## ะัะพะฒะตัะบะฐ

ะะพัะปะต ะดะตะฟะปะพั ะฟัะพะฒะตััะตะผ:
1. Backend health: `https://your-backend.railway.app/health`
2. Frontend ะดะพะปะถะตะฝ ัะฐะฑะพัะฐัั: `https://russiankendricklamar.github.io/stochastic-dashbord-v1/`
3. ะ ะบะพะฝัะพะปะธ ะฑัะฐัะทะตัะฐ ะฝะต ะดะพะปะถะฝะพ ะฑััั CORS ะพัะธะฑะพะบ

### Docker-ัะฐะทะฒะตัััะฒะฐะฝะธะต (Production)

```bash
# ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose up -d --build

# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f

# ะััะฐะฝะพะฒะบะฐ
docker-compose down
```

---

## ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (`.env`)

```bash
# Database
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/stochastic_dashboard
POSTGRES_USER=stochastic_user
POSTGRES_PASSWORD=secure_password
POSTGRES_DB=stochastic_dashboard

# Redis
REDIS_URL=redis://localhost:6379/0

# API
SECRET_KEY=your-secret-key-here-min-32-chars
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# MOEX API
MOEX_API_URL=https://iss.moex.com/iss
MOEX_TIMEOUT=30

# Bloomberg (ะตัะปะธ ะดะพัััะฟะฝะพ)
BLOOMBERG_HOST=localhost
BLOOMBERG_PORT=8194

# Logging
LOG_LEVEL=INFO
LOG_FORMAT=json

# Performance
MAX_WORKERS=8
CACHE_TTL=3600
```

### ะะพะฝัะธะณััะฐัะธั ะผะพะดะตะปะตะน (`config/models.yaml`)

```yaml
pricing_models:
  black_scholes:
    default_volatility: 0.2
    risk_free_rate: 0.05
    
  heston:
    kappa: 2.0      # mean reversion speed
    theta: 0.04     # long-term variance
    sigma: 0.3      # vol of vol
    rho: -0.7       # correlation
    v0: 0.04        # initial variance
    
  sabr:
    alpha: 0.3      # vol level
    beta: 0.5       # elasticity
    rho: -0.5       # correlation
    nu: 0.4         # vol of vol

hmm_models:
  n_states: 3
  covariance_type: "full"
  n_iterations: 1000
  random_state: 42
```

---

# ะะฐัััะพะนะบะฐ Supabase ะดะปั Stochastic Dashboard

## ะกะพะทะดะฐะฝะธะต ะฟัะพะตะบัะฐ ะฒ Supabase

1. ะกะพะทะดะฐะตะผ ะฝะพะฒัะน ะฟัะพะตะบั:
2. ะะดัะผ ัะพะทะดะฐะฝะธั ะฟัะพะตะบัะฐ (ะพะฑััะฝะพ 1-2 ะผะธะฝััั)

## ะะพะปััะตะฝะธะต credentials

1. ะ ะฟัะพะตะบัะต ะฟะตัะตัะพะดะธะผ ะฒ **Settings** โ **API**
2. ะะพะฟะธััะตะผ ัะปะตะดัััะธะต ะทะฝะฐัะตะฝะธั:
   - **Project URL** โ ััะพ `SUPABASE_URL`
   - **anon public** key โ ััะพ `SUPABASE_ANON_KEY`
   - (ะะฟัะธะพะฝะฐะปัะฝะพ) **service_role** key โ ััะพ `SUPABASE_SERVICE_ROLE_KEY` (ะดะปั ะฐะดะผะธะฝ ะพะฟะตัะฐัะธะน)

## ะกะพะทะดะฐะฝะธะต ัะฐะฑะปะธั ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั

1. ะ Supabase ะฟะตัะตัะพะดะธะผ ะฒ **SQL Editor**
2. ะัะบััะฒะฐะตะผ ัะฐะนะป `backend/supabase_migrations.sql`
3. ะะพะฟะธัะฐะน ะฒะตัั SQL ะบะพะด
4. ะััะฐะฒะปัะตะผ ะฒ SQL Editor ะฒ Supabase

ะญัะพ ัะพะทะดะฐัั:
- ะขะฐะฑะปะธัั `bond_valuations` ะดะปั ััะฐะฝะตะฝะธั ัะฐััะตัะพะฒ ะพะฑะปะธะณะฐัะธะน
- ะขะฐะฑะปะธัั `portfolios` ะดะปั ััะฐะฝะตะฝะธั ะฟะพัััะตะปะตะน
- ะขะฐะฑะปะธัั `calculation_history` ะดะปั ะธััะพัะธะธ ัะฐััะตัะพะฒ
- ะะฝะดะตะบัั ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ
- ะขัะธะณะณะตัั ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั `updated_at`

## ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

### ะะพะบะฐะปัะฝะพ (ะดะปั ัะฐะทัะฐะฑะพัะบะธ):

1. ะกะพะทะดะฐะตะผ ัะฐะนะป `.env` ะฒ ะดะธัะตะบัะพัะธะธ `backend/` (ะตัะปะธ ะตะณะพ ะตัะต ะฝะตั)
2. ะะพะฑะฐะฒะปัะตะผ:
   ```env
   SUPABASE_URL=https://your-project-id.supabase.co
   SUPABASE_ANON_KEY=your-anon-key-here
   ```
   
### ะะฐ Railway (ะดะปั production):

1. ะัะบััะฒะฐะตะผ ะฟัะพะตะบั ะฒ Railway
2. ะะตัะตัะพะดะธะผ ะฒ **Settings** โ **Variables**
3. ะะพะฑะฐะฒะปัะตะผ ะฟะตัะตะผะตะฝะฝัะต:
   - **Key:** `SUPABASE_URL`
   - **Value:** Project URL ะธะท Supabase
4. ะะพะฑะฐะฒะปัะตะผ ะตัะต ะพะดะฝั:
   - **Key:** `SUPABASE_ANON_KEY`
   - **Value:** anon key ะธะท Supabase
5. Railway ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะทะฐะฟัััะธั ัะตัะฒะธั

## ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

ะ ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะต:
```bash
cd backend
pip install -r requirements.txt
```

ะะฐ Railway ะทะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะดะตะฟะปะพะต.

## ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั

### ะงะตัะตะท API:

1. ะะฐะฟััะบะฐะตะผ backend ะปะพะบะฐะปัะฝะพ ะธะปะธ ะธัะฟะพะปัะทัะตะผ Railway URL
2. ะัะพะฒะตััะตะผ health endpoint:
   ```bash
   curl https://your-railway-url.railway.app/health
   ```

3. ะกะพะทะดะฐะตะผ ะทะฐะฟะธัั ัะตัะตะท API:
   ```bash
   curl -X POST https://your-railway-url.railway.app/api/db/bond-valuations \
     -H "Content-Type: application/json" \
     -d '{
       "secid": "RU000A10AU99",
       "valuation_date": "2026-01-13",
       "discount_yield1": 14.0,
       "discount_yield2": 16.0,
       "dirty_price": 1000.50,
       "clean_price": 995.20,
       "ytm": 14.5,
       "duration": 5.2
     }'
   ```

### ะงะตัะตะท Supabase Dashboard:

1. ะ Supabase ะฟะตัะตัะพะดะธะผ ะฒ **Table Editor**
2. ะะพะปะถะฝั ะฑััั ะฒะธะดะฝั ัะฐะฑะปะธัั: `bond_valuations`, `portfolios`, `calculation_history`
3. ะัะพะฒะตััะตะผ, ััะพ ะดะฐะฝะฝัะต ัะพััะฐะฝััััั ะฟะพัะปะต API ะทะฐะฟัะพัะพะฒ

## ะะพัััะฟะฝัะต API Endpoints

ะะพัะปะต ะฝะฐัััะพะนะบะธ ะดะพัััะฟะฝั ัะปะตะดัััะธะต endpoints:

### Bond Valuations:
- `POST /api/db/bond-valuations` - ัะพะทะดะฐัั ะทะฐะฟะธัั
- `GET /api/db/bond-valuations` - ะฟะพะปััะธัั ะฒัะต ะทะฐะฟะธัะธ
- `GET /api/db/bond-valuations/{id}` - ะฟะพะปััะธัั ะฟะพ ID
- `GET /api/db/bond-valuations?secid=RU000A10AU99` - ะฟะพะปััะธัั ะฟะพ ISIN
- `GET /api/db/bond-valuations?start_date=2026-01-01&end_date=2026-01-31` - ะฟะพะปััะธัั ะฟะพ ะดะฐัะฐะผ
- `PUT /api/db/bond-valuations/{id}` - ะพะฑะฝะพะฒะธัั ะทะฐะฟะธัั
- `DELETE /api/db/bond-valuations/{id}` - ัะดะฐะปะธัั ะทะฐะฟะธัั

### Portfolios:
- `POST /api/db/portfolios` - ัะพะทะดะฐัั ะฟะพัััะตะปั
- `GET /api/db/portfolios` - ะฟะพะปััะธัั ะฒัะต ะฟะพัััะตะปะธ
- `GET /api/db/portfolios/{id}` - ะฟะพะปััะธัั ะฟะพัััะตะปั ะฟะพ ID

### Calculation History:
- `POST /api/db/calculation-history` - ัะพััะฐะฝะธัั ะธััะพัะธั ัะฐััะตัะฐ
- `GET /api/db/calculation-history` - ะฟะพะปััะธัั ะธััะพัะธั
- `GET /api/db/calculation-history?calculation_type=bond` - ะฟะพะปััะธัั ะฟะพ ัะธะฟั

## ะะฝัะตะณัะฐัะธั ั ัััะตััะฒัััะธะผะธ endpoints

ะะพะถะฝะพ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพััะฐะฝััั ัะตะทัะปััะฐัั ัะฐััะตัะพะฒ ะฒ ะะ. ะะฐะฟัะธะผะตั, ะฒ `bond.py`:

```python
from src.database.repositories import BondValuationRepository, CalculationHistoryRepository
from src.database.models import BondValuationRecord, CalculationHistory
import time

@router.post("/valuate", response_model=Dict[str, Any])
async def valuate_bond(request: BondValuationRequest):
    start_time = time.time()
    
    # ะัะฟะพะปะฝัะตะผ ัะฐััะตั
    result = calculate_bond_valuation(...)
    
    # ะกะพััะฐะฝัะตะผ ะฒ ะะ
    bond_repo = BondValuationRepository()
    history_repo = CalculationHistoryRepository()
    
    # ะกะพััะฐะฝัะตะผ ัะตะทัะปััะฐั ัะฐััะตัะฐ
    bond_record = BondValuationRecord(
        secid=request.secid,
        valuation_date=request.valuationDate,
        discount_yield1=request.discountYield1,
        discount_yield2=request.discountYield2,
        dirty_price=result["scenario1"]["dirtyPrice"],
        clean_price=result["scenario1"]["cleanPrice"],
        ytm=result["scenario1"]["ytmPercent"],
        duration=result["scenario1"]["duration"],
        modified_duration=result["scenario1"].get("modifiedDuration"),
        convexity=result["scenario1"].get("convexity")
    )
    bond_repo.create(bond_record)
    
    # ะกะพััะฐะฝัะตะผ ะฒ ะธััะพัะธั
    execution_time = (time.time() - start_time) * 1000
    history_record = CalculationHistory(
        calculation_type="bond",
        input_data=request.model_dump(),
        result_data=result,
        execution_time_ms=execution_time
    )
    history_repo.create(history_record)
    
    return result
```

## ะะตะทะพะฟะฐัะฝะพััั

### Row Level Security (RLS)

ะะพ ัะผะพะปัะฐะฝะธั RLS ะพัะบะปััะตะฝ. ะัะปะธ ะฝัะถะฝะพ ะฒะบะปััะธัั:

1. ะ Supabase SQL Editor ะฒัะฟะพะปะฝัะตะผ:
   ```sql
   ALTER TABLE bond_valuations ENABLE ROW LEVEL SECURITY;
   ```

2. ะกะพะทะดะฐะตะผ ะฟะพะปะธัะธะบั ะดะพัััะฟะฐ

### Service Role Key

**ะะฐะถะฝะพ:** Service Role Key ะพะฑัะพะดะธั RLS ะธ ะธะผะตะตั ะฟะพะปะฝัะน ะดะพัััะฟ. ะัะฟะพะปัะทัะตะผ ะตะณะพ ัะพะปัะบะพ:
- ะ backend ัะตัะฒะตัะฐั
- ะะปั ะฐะดะผะธะฝ ะพะฟะตัะฐัะธะน

## ะะพะฝะธัะพัะธะฝะณ ะธ ะฐะฝะฐะปะธัะธะบะฐ

ะ Supabase Dashboard ะดะพัััะฟะฝั:
- **Table Editor** - ะฟัะพัะผะพัั ะธ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั
- **SQL Editor** - ะฒัะฟะพะปะฝะตะฝะธะต SQL ะทะฐะฟัะพัะพะฒ
- **Database** โ **Reports** - ะฐะฝะฐะปะธัะธะบะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
- **Logs** - ะปะพะณะธ ะทะฐะฟัะพัะพะฒ

## ะะพะปะตะทะฝัะต ัััะปะบะธ

- [Supabase Documentation](https://supabase.com/docs)
- [Supabase Python Client](https://github.com/supabase/supabase-py)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)

---

## ๐ API ะะพะบัะผะตะฝัะฐัะธั

### ะัะฝะพะฒะฝัะต ัะฝะดะฟะพะธะฝัั

#### ะัะตะฝะบะฐ ะพะฟัะธะพะฝะพะฒ
- `POST /api/v1/pricing/european` โ ะะฒัะพะฟะตะนัะบะธะต ะพะฟัะธะพะฝั
- `POST /api/v1/pricing/american` โ ะะผะตัะธะบะฐะฝัะบะธะต ะพะฟัะธะพะฝั (LSM)
- `POST /api/v1/pricing/barrier` โ ะะฐััะตัะฝัะต ะพะฟัะธะพะฝั
- `POST /api/v1/pricing/asian` โ ะะทะธะฐััะบะธะต ะพะฟัะธะพะฝั

#### ะกัััะบัััะฝัะต ะฟัะพะดัะบัั
- `POST /api/v1/structured/autocallable` โ ะะฒัะพะบะพะปะปะตะนะฑะปั
- `POST /api/v1/structured/cliquet` โ Cliquet ะพะฟัะธะพะฝั
- `POST /api/v1/structured/snowball` โ Snowballs

#### ะะฝะฐะปะธะท ัะธัะบะพะฒ
- `GET /api/v1/risk/var` โ Value-at-Risk
- `GET /api/v1/risk/cvar` โ Conditional VaR
- `POST /api/v1/risk/stress-test` โ ะกััะตัั-ัะตััะธัะพะฒะฐะฝะธะต

#### ะัะฝะพัะฝัะต ะดะฐะฝะฝัะต
- `GET /api/v1/market/moex/{ticker}` โ ะะฐะฝะฝัะต ั MOEX
- `GET /api/v1/market/yield-curve` โ ะัะธะฒะฐั ะดะพัะพะดะฝะพััะธ OFZ
- `GET /api/v1/market/vol-surface` โ ะะพะฒะตััะฝะพััั ะฒะพะปะฐัะธะปัะฝะพััะธ

ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะดะพัััะฟะฝะฐ ะฟะพ ะฐะดัะตัั: `/docs` (Swagger UI) ะธะปะธ `/redoc` (ReDoc)

---

## ะะฐัะตะผะฐัะธัะตัะบะธะต ะผะพะดะตะปะธ

### 1. ะกัะพัะฐััะธัะตัะบะธะต ะผะพะดะตะปะธ ะฒะพะปะฐัะธะปัะฝะพััะธ

#### ะะพะดะตะปั ะฅะตััะพะฝะฐ (Heston, 1993)
\[
\begin{aligned}
dS_t &= rS_t dt + \sqrt{v_t} S_t dW_t^S \\
dv_t &= \kappa(\theta - v_t) dt + \sigma \sqrt{v_t} dW_t^v \\
dW_t^S dW_t^v &= \rho dt
\end{aligned}
\]

**ะะฐัะฐะผะตััั:**
- \( \kappa \) โ ัะบะพัะพััั ััะตะดะฝะตะณะพ ะฒะพะทะฒัะฐัะฐ ะฒะพะปะฐัะธะปัะฝะพััะธ
- \( \theta \) โ ะดะพะปะณะพััะพัะฝัะน ััะพะฒะตะฝั ะฒะพะปะฐัะธะปัะฝะพััะธ
- \( \sigma \) โ ะฒะพะปะฐัะธะปัะฝะพััั ะฒะพะปะฐัะธะปัะฝะพััะธ
- \( \rho \) โ ะบะพััะตะปััะธั ะผะตะถะดั ัะตะฝะพะน ะธ ะฒะพะปะฐัะธะปัะฝะพัััั

#### ะะพะดะตะปั SABR
\[
\begin{aligned}
dF_t &= \alpha_t F_t^\beta dW_t^1 \\
d\alpha_t &= \nu \alpha_t dW_t^2 \\
dW_t^1 dW_t^2 &= \rho dt
\end{aligned}
\]

### 2. ะะพะดะตะปะธ ัะบะฐัะบะพะฒ (Lรฉvy)

#### ะะพะดะตะปั Variance Gamma (VG)
\[
X(t; \sigma, \nu, \theta) = \theta G(t; \nu) + \sigma W(G(t; \nu))
\]

**ะฅะฐัะฐะบัะตัะธััะธัะตัะบะฐั ััะฝะบัะธั:**
\[
\phi_{VG}(u) = \left(1 - iu\theta\nu + \frac{1}{2}\sigma^2\nu u^2\right)^{-t/\nu}
\]

#### ะะพะดะตะปั CGMY
\[
\phi_{CGMY}(u) = \exp\left\{tC\Gamma(-Y)\left[(M-iu)^Y - M^Y + (G+iu)^Y - G^Y\right]\right\}
\]

### 3. Hidden Markov Models ะดะปั ััะฝะพัะฝัั ัะตะถะธะผะพะฒ

ะัะฟะพะปัะทัะตััั ะดะธัะบัะตัะฝะฐั HMM ั \(N\) ัะบััััะผะธ ัะพััะพัะฝะธัะผะธ \(S_t \in \{1, \dots, N\}\) ะธ ะฝะฐะฑะปัะดะฐะตะผัะผะธ ะดะพัะพะดะฝะพัััะผะธ \(r_t\).

- ะะฐััะธัะฐ ะฟะตัะตัะพะดะพะฒ: \(A = [a_{ij}]\), ะณะดะต \(a_{ij} = P(S_t = j \mid S_{t-1} = i)\)
- ะะฐัะฐะปัะฝะพะต ัะฐัะฟัะตะดะตะปะตะฝะธะต: \(\pi_i = P(S_0 = i)\)
- ะะปะพัะฝะพััะธ ะฝะฐะฑะปัะดะตะฝะธะน: \(f(r_t \mid S_t = i)\), ะพะฑััะฝะพ ะณะฐัััะพะฒัะบะธะต ะธะปะธ t-ัะฐัะฟัะตะดะตะปะตะฝะธั

ะัะตะฝะบะฐ ะฟะฐัะฐะผะตััะพะฒ ะฟัะพะธะทะฒะพะดะธััั ะฐะปะณะพัะธัะผะพะผ BaumโWelch (EM), ะดะตะบะพะดะธัะพะฒะฐะฝะธะต โ ะฐะปะณะพัะธัะผะพะผ ะะธัะตัะฑะธ, ัะณะปะฐะถะธะฒะฐะฝะธะต ะฒะตัะพััะฝะพััะตะน ัะตะถะธะผะพะฒ โ ะฟััะผะพะน/ะพะฑัะฐัะฝัะน ะฐะปะณะพัะธัะผ (forward-backward).

---

## ะขะตััะธัะพะฒะฐะฝะธะต

ะะฐะฟััะบ unit-ัะตััะพะฒ backend:

```bash
cd backend
pytest -q
```

ะะฐะฟััะบ ัะตััะพะฒ ั ะฟะพะบัััะธะตะผ:

```bash
pytest --cov=app --cov-report=term-missing
```

Frontend-ัะตััั (ะตัะปะธ ะฝะฐัััะพะตะฝั):

```bash
cd frontend
npm run test
```

---

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```text
stochastic-dashbord-v1/
โโโ backend/
โ   โโโ app/
โ   โ   โโโ api/
โ   โ   โโโ core/
โ   โ   โโโ models/
โ   โ   โโโ services/
โ   โ   โโโ schemas/
โ   โ   โโโ cli/
โ   โ   โโโ main.py
โ   โโโ tests/
โ   โโโ alembic/
โ   โโโ requirements.txt
โ   โโโ requirements-opt.txt
โโโ frontend/
โ   โโโ src/
โ   โ   โโโ components/
โ   โ   โโโ views/
โ   โ   โโโ store/
โ   โ   โโโ router/
โ   โ   โโโ main.ts
โ   โโโ vite.config.ts
โ   โโโ package.json
โโโ config/
โ   โโโ models.yaml
โโโ docker-compose.yml
โโโ Dockerfile.backend
โโโ Dockerfile.frontend
โโโ README.md
```

ะะปััะตะฒัะต ะดะธัะตะบัะพัะธะธ:

- `backend/app/api` โ ัะตะฐะปะธะทะฐัะธั REST API
- `backend/app/services` โ ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ (pricing, risk, HMM, GARCH)
- `backend/app/models` โ ORM-ะผะพะดะตะปะธ ะะ (ะฟะพัััะตะปะธ, ัะดะตะปะบะธ, ััะฝะพัะฝัะต ะดะฐะฝะฝัะต)
- `backend/app/schemas` โ Pydantic-ััะตะผั ะทะฐะฟัะพัะพะฒ/ะพัะฒะตัะพะฒ
- `backend/app/cli` โ CLI-ััะธะปะธัั ะดะปั batch-ัะฐััะตัะพะฒ
- `frontend/src/views` โ ะพัะฝะพะฒะฝัะต ัะบัะฐะฝั (Dashboard, Pricing, Risk, Settings)
- `frontend/src/components` โ ะฟะตัะตะธัะฟะพะปัะทัะตะผัะต UI-ะบะพะผะฟะพะฝะตะฝัั

---

## ะะบะปะฐะด ะธ ัะฐะทะฒะธัะธะต

Pull Requests ะธ feature-ะทะฐะฟัะพัั ะฟัะธะฒะตัััะฒััััั. ะะฐะทะพะฒัะน workflow:

1. ะคะพัะบะฝะธัะต ัะตะฟะพะทะธัะพัะธะน
2. ะกะพะทะดะฐะนัะต feature-ะฒะตัะบั: `feature/heston-calibration-ui`
3. ะะพะฑะฐะฒััะต ะธ ะฟะพะบัะพะนัะต ัะตััะฐะผะธ ะฝะพะฒัะน ััะฝะบัะธะพะฝะฐะป
4. ะฃะฑะตะดะธัะตัั, ััะพ `pytest` ะธ `npm run lint` ะฟัะพัะพะดัั ะฑะตะท ะพัะธะฑะพะบ
5. ะัะบัะพะนัะต PR ั ัะตัะบะธะผ ะพะฟะธัะฐะฝะธะตะผ ะธะทะผะตะฝะตะฝะธะน ะธ ะผะพัะธะฒะฐัะธะตะน

ะะตะบะพะผะตะฝะดัะตะผัะต ะฝะฐะฟัะฐะฒะปะตะฝะธั ัะฐะทะฒะธัะธั:

- ะะพะฑะฐะฒะปะตะฝะธะต **stochastic local volatility** ะผะพะดะตะปะตะน (SLV)
- ะะพะดะดะตัะถะบะฐ **credit derivatives** (CDS, CDO tranches)
- ะะฐััะธัะตะฝะธะต ะฑะปะพะบะฐ **XVA** (CVA, DVA, FVA, KVA)
- ะะฝัะตะณัะฐัะธั ั **Kafka** ะดะปั real-time ะฟะพัะพะบะพะฒ ะบะพัะธัะพะฒะพะบ
- UI ะดะปั ะบะพะฝัะธะณััะธัะพะฒะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั payoff-ััะฝะบัะธะน

---

## ะะณัะฐะฝะธัะตะฝะธั ะธ ะดะธัะบะปะตะนะผะตั

- ะัะพะตะบั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝ **ะธัะบะปััะธัะตะปัะฝะพ ะดะปั ะธััะปะตะดะพะฒะฐัะตะปััะบะธั ะธ ััะตะฑะฝัั ัะตะปะตะน**.
- ะะตะฐะปะธะทะพะฒะฐะฝะฝัะต ะผะพะดะตะปะธ ะธ ะบะฐะปะธะฑัะพะฒะบะฐ **ะฝะต ัะฒะปััััั** ัะตะบะพะผะตะฝะดะฐัะธะตะน ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ ะฟัะพะดะฐะบัะฝ-ัะธััะตะผะฐั ะฑะตะท ะฝะตะทะฐะฒะธัะธะผะพะน ะฒะฐะปะธะดะฐัะธะธ ะธ ะฟัะพะฒะตัะบะธ risk-ะผะพะดะตะปัะผะธ.
- ะ ัะฐััะตัะฐั ะฟัะตะดะฟะพะปะฐะณะฐะตััั ะพััััััะฒะธะต ะฐัะฑะธััะฐะถะฐ, ัะพะฒะตััะตะฝะฝัะต ััะฝะบะธ ะธ ััะฐะฝะดะฐััะฝัะต ะดะพะฟััะตะฝะธั ัะธัะบ-ะฝะตะนััะฐะปัะฝะพะณะพ ะผะธัะฐ.
- ะะฐัะตััะฒะพ ัะตะทัะปััะฐัะพะฒ ััะฒััะฒะธัะตะปัะฝะพ ะบ ะฒัะฑะพัั ะฒัะพะดะฝัั ะดะฐะฝะฝัั (ัะฐััะพัะฐ, ะณะปัะฑะธะฝะฐ ะธััะพัะธะธ, ะบะฐัะตััะฒะพ ะบะพัะธัะพะฒะพะบ) ะธ ะฟะฐัะฐะผะตััะพะฒ ะบะฐะปะธะฑัะพะฒะบะธ (initial guess, bounds, regularization).

ะะตัะตะด ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะฒ ัะตะฐะปัะฝะพะผ ัะธัะบ- ะธะปะธ PnL-ะบะพะฝััะต ะพะฑัะทะฐัะตะปัะฝะพ ะฟัะพะฒะตะดะธัะต:

- ะัะบัะตััั ะฝะฐ ะธััะพัะธัะตัะบะธั ะดะฐะฝะฝัั
- ะกััะตัั-ัะตััะธัะพะฒะฐะฝะธะต ะฝะฐ ัะบัััะตะผะฐะปัะฝัั ััะตะฝะฐัะธัั
- ะกัะฐะฒะฝะตะฝะธะต ั ะฑะตะฝัะผะฐัะบะฐะผะธ (Bloomberg, ะฒะฝัััะตะฝะฝะธะต ัะธััะตะผั ะฑะฐะฝะบะฐ)
- ะะตะทะฐะฒะธัะธะผัั ะฒะฐะปะธะดะฐัะธั ัะพ ััะพัะพะฝั risk-ะผะพะดะตะปะธ ะธ model validation.
