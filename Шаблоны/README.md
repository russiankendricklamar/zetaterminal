# üìä –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è Template –¥–ª—è –ê–∫—Ü–∏–π

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Template-–æ—Ç—á—ë—Ç–æ–≤ –ø–æ –∞–∫—Ü–∏—è–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –ë–∏—Ä–∂–∏ (ISS API).

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ú–æ—Å–ë–∏—Ä–∂–∏ (ISS API)
- ‚úÖ –†–∞—Å—á—ë—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (Historical Volatility)
- ‚úÖ –†–∞—Å—á—ë—Ç Œ≤-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ (Beta)
- ‚úÖ –û—Ü–µ–Ω–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä—ã–Ω–∫–∞ –ø–æ 5 –∫—Ä–∏—Ç–µ—Ä–∏—è–º
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel-–æ—Ç—á—ë—Ç–∞ (3 –ª–∏—Å—Ç–∞: Calculation, Template, Metrics)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –∞–Ω–∞–ª–∏–∑–∞

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–∏–ª–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è git
git clone <repository_url>
cd stock-template-automation
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Python 3.8+
- pandas
- numpy
- scipy
- requests
- openpyxl

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ê–Ω–∞–ª–∏–∑ –∞–∫—Ü–∏–π –ì–∞–∑–ø—Ä–æ–º–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥
python main.py --ticker GAZP

# –ê–Ω–∞–ª–∏–∑ –°–±–µ—Ä–±–∞–Ω–∫–∞ –∑–∞ 2 –≥–æ–¥–∞
python main.py --ticker SBER --period 730

# –ê–Ω–∞–ª–∏–∑ –õ—É–∫–æ–π–ª–∞ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
python main.py --ticker LKOH --start 2024-01-01 --end 2025-01-01
```

### –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `--ticker` | –¢–∏–∫–µ—Ä –∞–∫—Ü–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) | - |
| `--isin` | ISIN –∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –ê–≤—Ç–æ |
| `--start` | –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD) | -365 –¥–Ω–µ–π |
| `--end` | –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD) | –°–µ–≥–æ–¥–Ω—è |
| `--period` | –ü–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö (–µ—Å–ª–∏ --start –Ω–µ —É–∫–∞–∑–∞–Ω) | 365 |
| `--activity-days` | –ü–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ | 30 |
| `--output` | –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ | `<TICKER>_automated.xlsx` |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ main.py                      # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ moex_iss_client.py           # –ö–ª–∏–µ–Ω—Ç –¥–ª—è MOEX ISS API
‚îú‚îÄ‚îÄ stock_template_processor.py  # –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä —Ä–∞—Å—á—ë—Ç–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Template
‚îú‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ‚îÄ README.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. `moex_iss_client.py` - –ö–ª–∏–µ–Ω—Ç ISS API

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

```python
client = MoexISSClient()

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—É–º–∞–≥–µ
info = client.get_security_info('GAZP')

# –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤
history = client.get_security_history(
    'GAZP',
    start_date='2024-01-01',
    end_date='2024-12-31'
)

# –¢–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
market_data = client.get_market_data('GAZP')

# –ò—Å—Ç–æ—Ä–∏—è –∏–Ω–¥–µ–∫—Å–∞ (–¥–ª—è Œ≤)
index = client.get_index_history('IMOEX', start_date='2024-01-01')

# –†–µ–π—Ç–∏–Ω–≥–∏
ratings = client.get_company_ratings(company_id=123)

# –î–∏–≤–∏–¥–µ–Ω–¥—ã
dividends = client.get_dividends()
```

**–ü–æ–∫—Ä—ã—Ç—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`/securities/{ticker}`)
- –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤ (`/history/...`)
- –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ (`/engines/stock/markets/shares/securities/{ticker}`)
- –ò–Ω–¥–µ–∫—Å—ã (`/history/engines/stock/markets/index/...`)
- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (`/cci/...`)
- –†–µ–π—Ç–∏–Ω–≥–∏ (`/cci/rating/...`)
- –î–∏–≤–∏–¥–µ–Ω–¥—ã (`/cci/corp-actions/dividends`)

### 2. `stock_template_processor.py` - –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä

**–û—Å–Ω–æ–≤–Ω–æ–π workflow:**

```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
processor = StockTemplateProcessor('GAZP')

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
processor.fetch_all_data(
    start_date='2025-01-01',
    end_date='2026-01-01'
)

# –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫
metrics = processor.calculate_metrics(period_days=30)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Template
template = processor.generate_template()

# –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
processor.export_to_excel('GAZP_automated.xlsx')
```

**–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**

1. **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞** (5 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤):
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π –∑–∞ –º–µ—Å—è—Ü ‚â• 21
   - –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫ –∑–∞ 1 –¥–µ–Ω—å ‚â• 10
   - –°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º —Å–¥–µ–ª–æ–∫ –∑–∞ 1 –¥–µ–Ω—å ‚â• 0.0001% free-float
   - Free-float ‚â• 10%
   - Free-float ‚â• 1 –º–ª—Ä–¥ ‚ÇΩ

2. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** (Historical Volatility):
   - –î–Ω–µ–≤–Ω—ã–µ log-returns
   - –ê–Ω–Ω—É–∞–ª–∏–∑–∞—Ü–∏—è: œÉ_annual = œÉ_daily √ó ‚àö252

3. **Œ≤-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç**:
   - –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –∞–∫—Ü–∏–∏ –Ω–∞ –∏–Ω–¥–µ–∫—Å IMOEX
   - Œ≤ = Cov(R_stock, R_index) / Var(R_index)

4. **3m ADTV** (Average Daily Trading Volume):
   - –°—Ä–µ–¥–Ω–∏–π –¥–Ω–µ–≤–Ω–æ–π –æ–±—ä—ë–º –∑–∞ 3 –º–µ—Å—è—Ü–∞ (–º–ª–Ω ‚ÇΩ)

5. **–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏ Free-float**:
   - –†—ã–Ω–æ—á–Ω–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è = –¶–µ–Ω–∞ √ó –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ü–∏–π
   - Free-float (–≤ %, –≤ —Ä—É–±)

## üìä –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### Excel-—Ñ–∞–π–ª (3 –ª–∏—Å—Ç–∞)

#### 1. **Calculation** (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)
–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ —Å –ø–æ–ª—è–º–∏:
- TRADEDATE, OPEN, LOW, HIGH, CLOSE, WAPRICE
- VOLUME, NUMTRADES, VALUE, etc.

#### 2. **Template** (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç)
–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Template –ø–æ –æ–±—Ä–∞–∑—Ü—É Excel-—à–∞–±–ª–æ–Ω–∞:
- –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (ISIN, —ç–º–∏—Ç–µ–Ω—Ç, —Å–µ–∫—Ç–æ—Ä)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü.–±. (–ª–∏—Å—Ç–∏–Ω–≥, –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è, free-float)
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞ (–∫—Ä–∏—Ç–µ—Ä–∏–∏)
- –†—ã–Ω–æ—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (3m ADTV, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, Œ≤)

#### 3. **Metrics** (—Å–ø—Ä–∞–≤–∫–∞)
–î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫.

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑ –ì–∞–∑–ø—Ä–æ–º–∞

```bash
python main.py --ticker GAZP
```

**–í—ã–≤–æ–¥:**
```
======================================================================
  –ê–í–¢–û–ú–ê–¢–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø TEMPLATE –î–õ–Ø –ê–ö–¶–ò–ô
======================================================================
–¢–∏–∫–µ—Ä:        GAZP
–ü–µ—Ä–∏–æ–¥:       2025-02-10 ‚Üí 2026-02-10
–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:   30 –¥–Ω–µ–π
–í—ã—Ö–æ–¥:        GAZP_automated.xlsx
======================================================================

‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞...
‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å MOEX ISS...
  ‚úì ISIN: RU0007661625
  ‚úì –ò—Å—Ç–æ—Ä–∏—è: 252 –∑–∞–ø–∏—Å–µ–π
  ‚úì –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: 1 –∑–∞–ø–∏—Å–µ–π
  ‚úì –ò—Å—Ç–æ—Ä–∏—è –∏–Ω–¥–µ–∫—Å–∞ IMOEX: 252 –∑–∞–ø–∏—Å–µ–π

‚è≥ –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫...

======================================================================
  –ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò
======================================================================
–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–≥–æ–¥):       32.45%
Œ≤-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:              0.9234
3m ADTV:                    1542.67 –º–ª–Ω ‚ÇΩ
–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ (–≥–æ–¥):         123.45 ‚ÇΩ
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:               128.90 ‚ÇΩ
–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è:              2834.56 –º–ª—Ä–¥ ‚ÇΩ
Free-float:                 0.50%

–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞:           ‚úì –ê–ö–¢–ò–í–ù–´–ô
======================================================================

‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Template...
  ‚úì –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å—Ç—Ä–æ–∫: 35

‚è≥ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel: GAZP_automated.xlsx...
‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ GAZP_automated.xlsx

======================================================================
  ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û
======================================================================
–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω: GAZP_automated.xlsx
```

### –ü—Ä–∏–º–µ—Ä 2: –ê–Ω–∞–ª–∏–∑ –∑–∞ 2 –≥–æ–¥–∞ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –≤—ã—Ö–æ–¥–æ–º

```bash
python main.py --ticker SBER --period 730 --output SBER_2years_analysis.xlsx
```

### –ü—Ä–∏–º–µ—Ä 3: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥

```bash
python main.py --ticker LKOH --start 2024-01-01 --end 2024-12-31 --activity-days 60
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ISS API

```python
from moex_iss_client import MoexISSClient

client = MoexISSClient()

# –¢–µ—Å—Ç 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—É–º–∞–≥–µ
info = client.get_security_info('GAZP')
print(info['description'])

# –¢–µ—Å—Ç 2: –ò—Å—Ç–æ—Ä–∏—è
history = client.get_security_history('GAZP', start_date='2025-01-01')
print(f"–°—Ç—Ä–æ–∫: {len(history)}")

# –¢–µ—Å—Ç 3: –ò–Ω–¥–µ–∫—Å
index = client.get_index_history('IMOEX', start_date='2025-01-01')
print(f"–ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫: {len(index)}")
```

### –¢–µ—Å—Ç —Ä–∞—Å—á—ë—Ç–æ–≤

```python
from stock_template_processor import StockTemplateProcessor

processor = StockTemplateProcessor('SBER')
processor.fetch_all_data(start_date='2024-01-01', end_date='2025-01-01')
metrics = processor.calculate_metrics()

print(f"–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: {metrics['volatility_annual']:.2f}%")
print(f"Œ≤: {metrics['beta']:.4f}")
print(f"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: {metrics['is_active']}")
```

## üìö API Reference

### MoexISSClient

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `get_security_info(security)` | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ |
| `get_security_history(security, start_date, end_date)` | –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤ |
| `get_market_data(security)` | –¢–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `get_index_history(index, start_date, end_date)` | –ò—Å—Ç–æ—Ä–∏—è –∏–Ω–¥–µ–∫—Å–∞ |
| `get_orderbook(security)` | –°—Ç–∞–∫–∞–Ω –∑–∞—è–≤–æ–∫ |
| `get_trades(security)` | –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–µ–ª–∫–∏ |
| `get_candles(security, interval)` | OHLCV —Å–≤–µ—á–∏ |
| `get_company_ratings(company_id)` | –†–µ–π—Ç–∏–Ω–≥–∏ –∫–æ–º–ø–∞–Ω–∏–∏ |
| `get_security_ratings(security)` | –†–µ–π—Ç–∏–Ω–≥–∏ –≤—ã–ø—É—Å–∫–∞ |
| `get_dividends()` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∏–≤–∏–¥–µ–Ω–¥–∞—Ö |

### StockTemplateProcessor

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `fetch_all_data(start_date, end_date)` | –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ú–æ—Å–ë–∏—Ä–∂–∏ |
| `calculate_metrics(period_days)` | –†–∞—Å—á—ë—Ç –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫ |
| `generate_template()` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Template DataFrame |
| `export_to_excel(filename)` | –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel (3 –ª–∏—Å—Ç–∞) |

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–æ–ø—É—â–µ–Ω–∏—è

1. **Free-float**: –¢–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ free-float —Ç—Ä–µ–±—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–ù–†–î, —ç–º–∏—Ç–µ–Ω—Ç). –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è placeholder (0.5% –¥–ª—è –ì–∞–∑–ø—Ä–æ–º–∞).

2. **–†–µ–π—Ç–∏–Ω–≥–∏**: ISS API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ `/cci/rating/...`, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–Ω–∞–Ω–∏–µ `company_id`. –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ "N/A".

3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ü–∏–π –≤ –æ–±—Ä–∞—â–µ–Ω–∏–∏**: –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ `ISSUESIZE` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫.

4. **–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è**: –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `MARKETPRICE √ó ISSUESIZE`, —Ç–æ—á–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö ISS.

5. **–¢–æ—Ä–≥–æ–≤—ã–µ –¥–Ω–∏**: –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è 252 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è –≤ –≥–æ–¥—É –¥–ª—è –∞–Ω–Ω—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.

## üîÑ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

```python
# –í stock_template_processor.py –¥–æ–±–∞–≤—å—Ç–µ –≤ calculate_metrics():

def calculate_metrics(self, period_days: int = 30) -> Dict:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

    # –ù–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞: Sharpe Ratio
    sharpe_ratio = self._calculate_sharpe(df)

    self.metrics['sharpe_ratio'] = sharpe_ratio
    return self.metrics

def _calculate_sharpe(self, df: pd.DataFrame, risk_free_rate: float = 0.08) -> float:
    """–†–∞—Å—á—ë—Ç Sharpe Ratio"""
    df = df.copy()
    df['ret'] = df['WAPRICE'].pct_change()

    excess_ret = df['ret'].mean() * 252 - risk_free_rate
    vol = df['ret'].std() * np.sqrt(252)

    return excess_ret / vol if vol > 0 else 0.0
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

```python
# –ü—Ä–∏–º–µ—Ä: –∑–∞–≥—Ä—É–∑–∫–∞ free-float –∏–∑ –ù–†–î API
def _get_free_float_from_nsd(self, isin: str) -> float:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –ù–†–î –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ free-float"""
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ API –ù–†–î
    pass
```

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"

**–ü—Ä–∏—á–∏–Ω–∞:** `fetch_all_data()` –Ω–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω –∏–ª–∏ –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π DataFrame.

**–†–µ—à–µ–Ω–∏–µ:**
```python
processor.fetch_all_data(start_date='2024-01-01', end_date='2025-01-01')
```

### –û—à–∏–±–∫–∞: "Connection timeout"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ ISS API.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç
client = MoexISSClient(timeout=60)
```

### –ü—É—Å—Ç–æ–π DataFrame –≤ –∏—Å—Ç–æ—Ä–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–∫–µ—Ä –∏–ª–∏ –ø–µ—Ä–∏–æ–¥ –±–µ–∑ —Ç–æ—Ä–≥–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–∫–µ—Ä: `client.search_securities('–ì–∞–∑–ø—Ä–æ–º')`
- –†–∞—Å—à–∏—Ä—å—Ç–µ –ø–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞

## üìù TODO / Roadmap

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ù–†–î API –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ free-float
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ `company_id` –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- [ ] –†–∞—Å—á—ë—Ç Sharpe Ratio –∏ Information Ratio
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Flask/Streamlit)
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] Unit-—Ç–µ—Å—Ç—ã (pytest)
- [ ] CI/CD pipeline

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–†–∏—Å–∫-–∞–Ω–∞–ª–∏—Ç–∏–∫ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤, quantitative analyst  
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

---

**–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:** —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
