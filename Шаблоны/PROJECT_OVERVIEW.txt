"""
üì¶ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê: –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø TEMPLATE –î–õ–Ø –ê–ö–¶–ò–ô
=========================================================

–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å ISS API –ú–æ—Å–ë–∏—Ä–∂–∏.

"""

# ============================================================================
# –§–ê–ô–õ–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê
# ============================================================================

stock-template-automation/
‚îú‚îÄ‚îÄ main.py                         # ‚≠ê –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ moex_iss_client.py              # üîå –ö–ª–∏–µ–Ω—Ç –¥–ª—è MOEX ISS API
‚îú‚îÄ‚îÄ stock_template_processor.py     # üßÆ –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä —Ä–∞—Å—á—ë—Ç–æ–≤
‚îú‚îÄ‚îÄ examples.py                     # üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt                # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ README.md                       # üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ .gitignore                      # üö´ Git ignore rules


# ============================================================================
# –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢
# ============================================================================

# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å–∫ –±–∞–∑–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
python main.py --ticker GAZP

# 3. –ê–Ω–∞–ª–∏–∑ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
python main.py --ticker SBER --start 2024-01-01 --end 2025-01-01

# 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–æ–≤
python examples.py


# ============================================================================
# –û–ü–ò–°–ê–ù–ò–ï –§–ê–ô–õ–û–í
# ============================================================================

1. main.py
----------
–û—Å–Ω–æ–≤–Ω–æ–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Å–∫—Ä–∏–ø—Ç —Å CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    python main.py --ticker GAZP [--start YYYY-MM-DD] [--end YYYY-MM-DD]

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
    - –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
    - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è workflow: –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí —Ä–∞—Å—á—ë—Ç ‚Üí —ç–∫—Å–ø–æ—Ä—Ç
    - –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–í—ã—Ö–æ–¥:
    Excel-—Ñ–∞–π–ª —Å 3 –ª–∏—Å—Ç–∞–º–∏: Calculation, Template, Metrics


2. moex_iss_client.py
---------------------
HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ISS API –ú–æ—Å–ë–∏—Ä–∂–∏.

–ö–ª–∞—Å—Å: MoexISSClient

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
    - get_security_info(security)           # –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    - get_security_history(security, ...)   # –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤
    - get_market_data(security)             # –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
    - get_index_history(index, ...)         # –ò—Å—Ç–æ—Ä–∏—è –∏–Ω–¥–µ–∫—Å–∞
    - get_orderbook(security)               # –°—Ç–∞–∫–∞–Ω –∑–∞—è–≤–æ–∫
    - get_trades(security)                  # –°–¥–µ–ª–∫–∏
    - get_candles(security, interval)       # OHLCV —Å–≤–µ—á–∏
    - get_company_ratings(company_id)       # –†–µ–π—Ç–∏–Ω–≥–∏
    - get_dividends()                       # –î–∏–≤–∏–¥–µ–Ω–¥—ã
    - search_securities(query)              # –ü–æ–∏—Å–∫ –±—É–º–∞–≥

–ü–æ–∫—Ä—ã—Ç–∏–µ API:
    ‚úì Securities (—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)
    ‚úì Market Data (—Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ)
    ‚úì History (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
    ‚úì Indices (–∏–Ω–¥–µ–∫—Å—ã)
    ‚úì Corporate Info (–∫–æ—Ä–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
    ‚úì Ratings (—Ä–µ–π—Ç–∏–Ω–≥–∏)
    ‚úì Reference Data (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏)


3. stock_template_processor.py
-------------------------------
–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞—Å—á—ë—Ç–æ–≤.

–ö–ª–∞—Å—Å: StockTemplateProcessor

Workflow:
    1. __init__(ticker, isin)               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    2. fetch_all_data(start, end)           # –ó–∞–≥—Ä—É–∑–∫–∞ —Å MOEX
    3. calculate_metrics(period_days)       # –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫
    4. generate_template()                  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Template
    5. export_to_excel(filename)            # –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
    ‚úì –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (Historical Volatility)
        œÉ_annual = œÉ_daily √ó ‚àö252

    ‚úì Œ≤-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (Beta)
        –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è: R_stock = Œ± + Œ≤ √ó R_index

    ‚úì –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞ (5 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤):
        - –¢–æ—Ä–≥–æ–≤—ã–µ –¥–Ω–∏ –∑–∞ –º–µ—Å—è—Ü ‚â• 21
        - –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª-–≤–æ —Å–¥–µ–ª–æ–∫ ‚â• 10
        - –°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º ‚â• 0.0001% free-float
        - Free-float ‚â• 10%
        - Free-float ‚â• 1 –º–ª—Ä–¥ ‚ÇΩ

    ‚úì 3m ADTV (Average Daily Trading Volume)
    ‚úì –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏ Free-float
    ‚úì –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∑–∞ –≥–æ–¥


4. examples.py
--------------
–ù–∞–±–æ—Ä –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

–ü—Ä–∏–º–µ—Ä—ã:
    1. –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–π –∞–∫—Ü–∏–∏
    2. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–∫—Ü–∏–π
    3. –ê–Ω–∞–ª–∏–∑ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (Q1 2024)
    4. –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ISS API –∫–ª–∏–µ–Ω—Ç–∞
    5. –†–∞—Å—á—ë—Ç Œ≤ –¥–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª—è

–ó–∞–ø—É—Å–∫:
    python examples.py


5. requirements.txt
-------------------
–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python:
    pandas>=2.0.0       # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    numpy>=1.24.0       # –ß–∏—Å–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã
    scipy>=1.10.0       # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è)
    requests>=2.31.0    # HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ ISS API
    openpyxl>=3.1.0     # –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel


6. README.md
------------
–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:
    - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
    - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
    - API Reference
    - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    - Troubleshooting
    - Roadmap


7. .gitignore
-------------
–ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è Git:
    - Python cache (__pycache__, *.pyc)
    - Virtual environments (venv/, env/)
    - IDE (.vscode/, .idea/)
    - Output files (*.xlsx)
    - Logs (*.log)


# ============================================================================
# –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° ISS MOEX API
# ============================================================================

–ë–∞–∑–æ–≤—ã–π URL: https://iss.moex.com/iss

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

1. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
   GET /securities/{security}
   –ü—Ä–∏–º–µ—Ä: /securities/GAZP

2. –ò—Å—Ç–æ—Ä–∏—è —Ç–æ—Ä–≥–æ–≤
   GET /history/engines/{engine}/markets/{market}/securities/{security}
   –ü—Ä–∏–º–µ—Ä: /history/engines/stock/markets/shares/securities/GAZP
   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: from, till, start (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)

3. –¢–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   GET /engines/{engine}/markets/{market}/securities/{security}
   –ü—Ä–∏–º–µ—Ä: /engines/stock/markets/shares/securities/GAZP

4. –ò—Å—Ç–æ—Ä–∏—è –∏–Ω–¥–µ–∫—Å–∞
   GET /history/engines/stock/markets/index/boards/SNDX/securities/{index}
   –ü—Ä–∏–º–µ—Ä: /history/engines/stock/markets/index/boards/SNDX/securities/IMOEX

5. –°—Ç–∞–∫–∞–Ω –∑–∞—è–≤–æ–∫
   GET /engines/{engine}/markets/{market}/securities/{security}/orderbook

6. –°–¥–µ–ª–∫–∏
   GET /engines/{engine}/markets/{market}/securities/{security}/trades

7. –†–µ–π—Ç–∏–Ω–≥–∏ –∫–æ–º–ø–∞–Ω–∏–∏
   GET /cci/rating/companies/{company_id}

8. –î–∏–≤–∏–¥–µ–Ω–¥—ã
   GET /cci/corp-actions/dividends

9. –ü–æ–∏—Å–∫ —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥
   GET /securities?q={query}

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON (iss.json=extended)
–ü–∞–≥–∏–Ω–∞—Ü–∏—è: start=0, start=100, start=200...
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: iss.meta=off (–¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏)


# ============================================================================
# –§–û–†–ú–£–õ–´ –†–ê–°–ß–Å–¢–û–í
# ============================================================================

1. –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (Historical Volatility)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   r_t = ln(P_t / P_{t-1})              # Log-returns
   œÉ_daily = std(r_t)                   # –î–Ω–µ–≤–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
   œÉ_annual = œÉ_daily √ó ‚àö252            # –ê–Ω–Ω—É–∞–ª–∏–∑–∞—Ü–∏—è (252 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è)


2. Œ≤-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (Beta)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –ú–æ–¥–µ–ª—å: R_stock = Œ± + Œ≤ √ó R_index + Œµ

   –ú–µ—Ç–æ–¥: –õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è (scipy.stats.linregress)
   Œ≤ = Cov(R_stock, R_index) / Var(R_index)

   –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:
       Œ≤ > 1:  –ê–∫—Ü–∏—è –±–æ–ª–µ–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–∞, —á–µ–º —Ä—ã–Ω–æ–∫ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è)
       Œ≤ = 1:  –ê–∫—Ü–∏—è –¥–≤–∏–∂–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å —Ä—ã–Ω–∫–æ–º (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è)
       Œ≤ < 1:  –ê–∫—Ü–∏—è –º–µ–Ω–µ–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–∞ (–∑–∞—â–∏—Ç–Ω–∞—è)


3. 3m ADTV (Average Daily Trading Volume)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   ADTV = Œ£(VOLUME_i) / N_days

   –ì–¥–µ:
       VOLUME_i - –æ–±—ä—ë–º —Ç–æ—Ä–≥–æ–≤ –≤ –¥–µ–Ω—å i (—Ä—É–±)
       N_days - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π –∑–∞ 3 –º–µ—Å—è—Ü–∞ (~63)


4. –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   MCAP = MARKETPRICE √ó ISSUESIZE

   –ì–¥–µ:
       MARKETPRICE - —Ä—ã–Ω–æ—á–Ω–∞—è —Ü–µ–Ω–∞ –∞–∫—Ü–∏–∏
       ISSUESIZE - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ü–∏–π –≤ –æ–±—Ä–∞—â–µ–Ω–∏–∏


5. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   a) N_trading_days ‚â• 21 (–∑–∞ –º–µ—Å—è—Ü)
   b) Avg_trades_per_day ‚â• 10
   c) Avg_volume_pct ‚â• 0.0001% –æ—Ç free-float
   d) Free-float ‚â• 10%
   e) Free-float ‚â• 1 –º–ª—Ä–¥ ‚ÇΩ

   –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å = (a) AND (b) AND (c) AND (e)


# ============================================================================
# –ü–†–ò–ú–ï–†–´ –í–´–ó–û–í–û–í
# ============================================================================

# –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
python main.py --ticker GAZP

# –ü—Ä–∏–º–µ—Ä 2: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
python main.py --ticker SBER --start 2024-01-01 --end 2024-12-31

# –ü—Ä–∏–º–µ—Ä 3: 2 –≥–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö + 60 –¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
python main.py --ticker LKOH --period 730 --activity-days 60

# –ü—Ä–∏–º–µ—Ä 4: –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤—ã—Ö–æ–¥
python main.py --ticker YNDX --output yandex_analysis.xlsx

# –ü—Ä–∏–º–µ—Ä 5: –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –≤—ã–∑–æ–≤
from stock_template_processor import StockTemplateProcessor

processor = StockTemplateProcessor('GAZP')
processor.fetch_all_data(start_date='2025-01-01', end_date='2026-01-01')
metrics = processor.calculate_metrics()
processor.export_to_excel('GAZP_output.xlsx')


# ============================================================================
# –í–´–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï
# ============================================================================

Excel-—Ñ–∞–π–ª (<TICKER>_automated.xlsx) —Å–æ–¥–µ—Ä–∂–∏—Ç 3 –ª–∏—Å—Ç–∞:

1. Calculation
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –°—ã—Ä—ã–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–ª—è–º–∏:
       TRADEDATE, OPEN, LOW, HIGH, CLOSE, WAPRICE
       VOLUME, NUMTRADES, VALUE, LEGALCLOSEPRICE
       MARKETPRICE2, ADMITTEDQUOTE, etc.

   –ò—Å—Ç–æ—á–Ω–∏–∫: /history/engines/stock/markets/shares/securities/{ticker}


2. Template
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ Excel-—à–∞–±–ª–æ–Ω–∞:

   –ë–ª–æ–∫–∏:
       - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ç–∏–∫–µ—Ä, ISIN, —ç–º–∏—Ç–µ–Ω—Ç, —Å–µ–∫—Ç–æ—Ä)
       - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü.–±. (–ª–∏—Å—Ç–∏–Ω–≥, –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è, free-float)
       - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–π –ø–µ—Ä–∏–æ–¥
       - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞ (5 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º)
       - –†—ã–Ω–æ—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (3m ADTV, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, Œ≤)

   –§–æ—Ä–º–∞—Ç: 4 –∫–æ–ª–æ–Ω–∫–∏ [–ü–∞—Ä–∞–º–µ—Ç—Ä, –ó–Ω–∞—á–µ–Ω–∏–µ, –î–æ–ø. –∏–Ω—Ñ–æ, –ö—Ä–∏—Ç–µ—Ä–∏–π]


3. Metrics
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –°–ø—Ä–∞–≤–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫:
       n_trading_days, avg_trades_per_day, avg_volume
       mcap, free_float_pct, free_float_value_rub
       volatility_annual, beta, adtv_3m
       is_active, criteria (—Å–ª–æ–≤–∞—Ä—å)


# ============================================================================
# –†–ê–°–®–ò–†–ï–ù–ò–Ø –ò –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–Ø
# ============================================================================

1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   # –í stock_template_processor.py ‚Üí calculate_metrics():

   def calculate_metrics(self, period_days: int = 30):
       # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

       # –ù–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞: Sharpe Ratio
       sharpe = self._calculate_sharpe(self.history_data)
       self.metrics['sharpe_ratio'] = sharpe

       return self.metrics

   def _calculate_sharpe(self, df, rf_rate=0.08):
       """Sharpe Ratio = (E[R] - Rf) / œÉ[R]"""
       returns = df['WAPRICE'].pct_change()
       excess_ret = returns.mean() * 252 - rf_rate
       vol = returns.std() * np.sqrt(252)
       return excess_ret / vol


2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   # –ü—Ä–∏–º–µ—Ä: free-float –∏–∑ –ù–†–î API

   def _get_free_float_from_nsd(self, isin: str) -> float:
       """–¢–æ—á–Ω—ã–π free-float –∏–∑ –ù–†–î"""
       url = f"https://nsd.ru/api/v1/securities/{isin}/free-float"
       response = requests.get(url)
       data = response.json()
       return data['free_float_pct']


3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   # –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

   import pickle
   from pathlib import Path

   def _load_from_cache(self, ticker, start_date, end_date):
       cache_file = Path(f"cache/{ticker}_{start_date}_{end_date}.pkl")
       if cache_file.exists():
           with open(cache_file, 'rb') as f:
               return pickle.load(f)
       return None

   def _save_to_cache(self, data, ticker, start_date, end_date):
       cache_dir = Path("cache")
       cache_dir.mkdir(exist_ok=True)
       cache_file = cache_dir / f"{ticker}_{start_date}_{end_date}.pkl"
       with open(cache_file, 'wb') as f:
           pickle.dump(data, f)


# ============================================================================
# TROUBLESHOOTING
# ============================================================================

–ü—Ä–æ–±–ª–µ–º–∞: "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
–†–µ—à–µ–Ω–∏–µ:  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ fetch_all_data() –±—ã–ª –≤—ã–∑–≤–∞–Ω –ø–µ—Ä–µ–¥ calculate_metrics()

–ü—Ä–æ–±–ª–µ–º–∞: "Connection timeout to ISS API"
–†–µ—à–µ–Ω–∏–µ:  –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç: MoexISSClient(timeout=60)

–ü—Ä–æ–±–ª–µ–º–∞: "Empty DataFrame in history"
–†–µ—à–µ–Ω–∏–µ:  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–∫–µ—Ä –∏ –ø–µ—Ä–∏–æ–¥. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ search_securities()

–ü—Ä–æ–±–ª–µ–º–∞: "Beta calculation returns 1.0"
–†–µ—à–µ–Ω–∏–µ:  –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–µ–∫ –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ (< 30). –†–∞—Å—à–∏—Ä—å—Ç–µ –ø–µ—Ä–∏–æ–¥.

–ü—Ä–æ–±–ª–µ–º–∞: "Free-float = 0.005"
–†–µ—à–µ–Ω–∏–µ:  Placeholder –∑–Ω–∞—á–µ–Ω–∏–µ. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –ù–†–î API –¥–ª—è —Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.


# ============================================================================
# ROADMAP
# ============================================================================

–í–µ—Ä—Å–∏—è 1.0 (—Ç–µ–∫—É—â–∞—è):
    ‚úì –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ISS API
    ‚úì –†–∞—Å—á—ë—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ—Ç—ã
    ‚úì –û—Ü–µ–Ω–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä—ã–Ω–∫–∞
    ‚úì –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel (3 –ª–∏—Å—Ç–∞)
    ‚úì CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–í–µ—Ä—Å–∏—è 1.1 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):
    ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ù–†–î API (—Ç–æ—á–Ω—ã–π free-float)
    ‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ company_id –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
    ‚è≥ Sharpe Ratio –∏ Information Ratio
    ‚è≥ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    ‚è≥ Unit-—Ç–µ—Å—Ç—ã (pytest)

–í–µ—Ä—Å–∏—è 2.0 (–±—É–¥—É—â–µ–µ):
    üîÆ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π
    üîÆ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Streamlit)
    üîÆ Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    üîÆ Portfolio analytics
    üîÆ Risk decomposition (VaR, CVaR)


# ============================================================================
# –ö–û–ù–¢–ê–ö–¢–´ –ò –ü–û–î–î–ï–†–ñ–ö–ê
# ============================================================================

–ê–≤—Ç–æ—Ä: –†–∏—Å–∫-–∞–Ω–∞–ª–∏—Ç–∏–∫ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤, quantitative analyst
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤:
    - –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ README.md
    - –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã: python examples.py


# ============================================================================
# ‚úÖ –ü–†–û–ï–ö–¢ –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ
# ============================================================================

–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã. –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–±–æ—Ç—É:

1. pip install -r requirements.txt
2. python main.py --ticker GAZP
3. –û—Ç–∫—Ä–æ–π—Ç–µ GAZP_automated.xlsx

–£—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã! üöÄ
