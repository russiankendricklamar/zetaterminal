import{d as l,r as a,c as e,e as s,g as t,t as n,x as u,y as c,L as o,j as d,w as i,T as r,q as v,f as p,M as b,F as m,i as h,n as y}from"./vendor-DLyKmMu8.js";import{g}from"./apiHeaders-DCeXWvJ_.js";import{_ as f}from"./index-AoYxWDki.js";const x={class:"page-container"},k={class:"section-header"},w={class:"header-actions"},C=["disabled"],P={key:0,width:"14",height:"14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},U={key:1,class:"spinner-mini"},V={class:"glass-card panel step-panel"},D={class:"controls-form"},F={class:"params-grid"},I={class:"form-group"},S={class:"form-group"},T={class:"form-group"},_={class:"form-group"},M=["disabled"],Y={key:0},A={key:1,class:"flex-center"},B={key:0,class:"alert-glass alert-danger"},R={key:0,class:"glass-card panel step-panel"},j={class:"report-config"},E={class:"config-section"},z={class:"checkbox-grid"},H={class:"checkbox-item"},L={class:"checkbox-item"},N={class:"checkbox-item"},O={class:"checkbox-item"},q={class:"checkbox-item"},$={class:"checkbox-item"},J={class:"config-section"},G={class:"form-row-2"},K={class:"form-group"},Q={class:"form-group"},W={class:"form-group"},X={key:0,class:"glass-card panel step-panel preview-panel"},Z={class:"report-preview"},ll={key:0,class:"report-section"},al={class:"summary-box"},el={class:"summary-row"},sl={class:"value mono"},tl={class:"summary-row"},nl={class:"value text-gradient-blue"},ul={class:"summary-row"},cl={class:"value"},ol={class:"summary-row"},dl={class:"value"},il={class:"summary-row"},rl={class:"value text-orange"},vl={key:1,class:"report-section"},pl={class:"report-table-wrapper"},bl={class:"report-table"},ml={class:"value mono"},hl={class:"value mono"},yl={class:"value mono"},gl={class:"value"},fl={class:"value"},xl={class:"value"},kl={key:2,class:"report-section"},wl={class:"report-table-wrapper"},Cl={class:"report-table"},Pl={class:"value mono text-gradient-blue"},Ul={class:"value mono"},Vl={class:"value mono"},Dl={class:"value mono"},Fl={class:"value mono text-orange"},Il={key:3,class:"report-section"},Sl={class:"table-scroll"},Tl={class:"report-table cf-table"},_l={class:"text-right mono"},Ml={class:"text-right mono"},Yl={class:"text-right mono"},Al={class:"text-right mono"},Bl={class:"text-right mono"},Rl={key:4,class:"report-section"},jl={class:"table-scroll"},El={class:"report-table coupon-table"},zl={class:"text-right mono"},Hl={key:5,class:"report-section"},Ll={class:"report-table-wrapper"},Nl={class:"report-table"},Ol={class:"value"},ql={class:"value mono"},$l={class:"value mono"},Jl={class:"value"},Gl={key:0},Kl={class:"value"},Ql={class:"report-footer"},Wl={key:0,class:"footer-item"},Xl={key:1,class:"footer-item"},Zl={class:"footer-item"},la={key:0,class:"action-bar"},aa=["disabled"],ea=f(l({__name:"BondReport",setup(l){const f=a({secid:"RU000A10AU99",valuationDate:(new Date).toISOString().split("T")[0],discountYield:14,dayCount:365}),ea=a({secid:"RU000A10AU99",faceValue:1e3,couponPercent:9,issueDate:"2023-01-01",maturityDate:"2028-01-01",paymentsPerYear:2,dirtyPrice:987.65,accruedInterest:15.5,cleanPrice:972.15,pricePercent:97.215,duration:2.45,cashFlows:[{date:"2026-07-03",t:.5,cf:45,df:.9326,pv:41.97},{date:"2027-01-03",t:1,cf:45,df:.8704,pv:39.17},{date:"2027-07-03",t:1.5,cf:45,df:.8118,pv:36.53},{date:"2028-01-03",t:2,cf:45,df:.7565,pv:34.04},{date:"2028-07-03",t:2.5,cf:45,df:.7041,pv:31.69},{date:"2029-01-03",t:3,cf:1045,df:.6543,pv:683.55}],allCoupons:[{date:"2025-07-03",value:45,isPaid:!0},{date:"2026-01-03",value:45,isPaid:!0},{date:"2026-07-03",value:45,isPaid:!1},{date:"2027-01-03",value:45,isPaid:!1},{date:"2027-07-03",value:45,isPaid:!1},{date:"2028-01-03",value:45,isPaid:!1},{date:"2028-07-03",value:45,isPaid:!1},{date:"2029-01-03",value:1045,isPaid:!1}]}),sa=a(!1),ta=a(""),na=a({includeExec:!0,includeBondInfo:!0,includeValuation:!0,includeCashFlows:!0,includeCoupons:!0,includeMetadata:!0,author:"Аналитик",company:"Компания",notes:""}),ua=async()=>{sa.value=!0,ta.value="",ea.value=null;try{const l=await fetch("   https://stochastic-dashbord-v1-production.up.railway.app/api/bond/valuate",{method:"POST",headers:g(),body:JSON.stringify({secid:f.value.secid,valuation_date:f.value.valuationDate,discount_yield:f.value.discountYield/100,day_count:f.value.dayCount})});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);ea.value=await l.json()}catch(l){ta.value=l.message||"Ошибка при расчёте облигации",ea.value=null}finally{sa.value=!1}},ca=()=>{ea.value=null},oa=async()=>{if(ea.value)try{sa.value=!0,window.print()}catch(l){ta.value="Ошибка при генерации отчета"}finally{sa.value=!1}},da=()=>{window.print()},ia=async()=>{const l=document.querySelector(".report-preview");if(l)try{const a=l.innerText;await navigator.clipboard.writeText(a),alert("Отчет скопирован в буфер обмена")}catch(a){ta.value="Ошибка при копировании"}},ra=(l,a=2)=>l.toLocaleString("ru-RU",{minimumFractionDigits:a,maximumFractionDigits:a}),va=l=>new Date(l+"T00:00:00").toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"});return(l,a)=>(v(),e("div",x,[s("div",k,[a[14]||(a[14]=s("div",{class:"header-left"},[s("h1",{class:"section-title"},"Отчет по оценке облигаций"),s("p",{class:"section-subtitle"},"Формирование аналитического отчёта")],-1)),s("div",w,[s("button",{class:"btn-glass primary",onClick:oa,disabled:sa.value||!ea.value},[sa.value?(v(),e("span",U)):(v(),e("svg",P,[...a[13]||(a[13]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m4-3H8m7-7H5a2 2 0 00-2 2v12a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2z"},null,-1)])])),s("span",null,n(sa.value?"Генерация...":"Скачать PDF"),1)],8,C)])]),s("div",V,[a[21]||(a[21]=s("div",{class:"panel-header"},[s("h3",null,"Шаг 1: Загрузка данных из оценки"),s("span",{class:"step-badge"},"1")],-1)),s("div",D,[s("div",F,[s("div",I,[a[15]||(a[15]=s("label",{class:"lbl"},"ISIN Облигации",-1)),u(s("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>f.value.secid=l),type:"text",class:"glass-input",placeholder:"RU000A10AU99",onChange:ca},null,544),[[c,f.value.secid]])]),s("div",S,[a[16]||(a[16]=s("label",{class:"lbl"},"Дата оценки",-1)),u(s("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>f.value.valuationDate=l),type:"date",class:"glass-input",onChange:ca},null,544),[[c,f.value.valuationDate]])]),s("div",T,[a[17]||(a[17]=s("label",{class:"lbl"},"Доходность (%)",-1)),u(s("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>f.value.discountYield=l),type:"number",step:"0.01",class:"glass-input",placeholder:"14.0",onChange:ca},null,544),[[c,f.value.discountYield,void 0,{number:!0}]])]),s("div",_,[a[19]||(a[19]=s("label",{class:"lbl"},"База расчета",-1)),u(s("select",{"onUpdate:modelValue":a[3]||(a[3]=l=>f.value.dayCount=l),class:"glass-input",onChange:ca},[...a[18]||(a[18]=[s("option",{value:365},"ACT/365",-1),s("option",{value:360},"30/360",-1)])],544),[[o,f.value.dayCount,void 0,{number:!0}]])])]),s("button",{class:"btn-glass primary wide",onClick:ua,disabled:sa.value},[sa.value?(v(),e("span",A,[...a[20]||(a[20]=[s("span",{class:"spinner-mini"},null,-1),d(" Загрузка...",-1)])])):(v(),e("span",Y,"Загрузить оценку"))],8,M)])]),t(r,{name:"fade"},{default:i(()=>[ta.value?(v(),e("div",B,[a[22]||(a[22]=s("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24"},[s("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})],-1)),s("span",null,n(ta.value),1)])):p("",!0)]),_:1}),t(r,{name:"fade"},{default:i(()=>[ea.value?(v(),e("div",R,[a[34]||(a[34]=s("div",{class:"panel-header"},[s("h3",null,"Шаг 2: Конфигурация отчёта"),s("span",{class:"step-badge variant-2"},"2")],-1)),s("div",j,[s("div",E,[a[29]||(a[29]=s("h4",{class:"section-label"},"Содержание отчета",-1)),s("div",z,[s("label",H,[u(s("input",{"onUpdate:modelValue":a[4]||(a[4]=l=>na.value.includeExec=l),type:"checkbox"},null,512),[[b,na.value.includeExec]]),a[23]||(a[23]=s("span",null,"Резюме",-1))]),s("label",L,[u(s("input",{"onUpdate:modelValue":a[5]||(a[5]=l=>na.value.includeBondInfo=l),type:"checkbox"},null,512),[[b,na.value.includeBondInfo]]),a[24]||(a[24]=s("span",null,"Параметры облигации",-1))]),s("label",N,[u(s("input",{"onUpdate:modelValue":a[6]||(a[6]=l=>na.value.includeValuation=l),type:"checkbox"},null,512),[[b,na.value.includeValuation]]),a[25]||(a[25]=s("span",null,"Результаты оценки",-1))]),s("label",O,[u(s("input",{"onUpdate:modelValue":a[7]||(a[7]=l=>na.value.includeCashFlows=l),type:"checkbox"},null,512),[[b,na.value.includeCashFlows]]),a[26]||(a[26]=s("span",null,"Таблица денежных потоков",-1))]),s("label",q,[u(s("input",{"onUpdate:modelValue":a[8]||(a[8]=l=>na.value.includeCoupons=l),type:"checkbox"},null,512),[[b,na.value.includeCoupons]]),a[27]||(a[27]=s("span",null,"График купонов",-1))]),s("label",$,[u(s("input",{"onUpdate:modelValue":a[9]||(a[9]=l=>na.value.includeMetadata=l),type:"checkbox"},null,512),[[b,na.value.includeMetadata]]),a[28]||(a[28]=s("span",null,"Метаданные модели",-1))])])]),s("div",J,[a[33]||(a[33]=s("h4",{class:"section-label"},"Параметры отчета",-1)),s("div",G,[s("div",K,[a[30]||(a[30]=s("label",{class:"lbl"},"Автор отчета",-1)),u(s("input",{"onUpdate:modelValue":a[10]||(a[10]=l=>na.value.author=l),type:"text",class:"glass-input",placeholder:"Имя аналитика"},null,512),[[c,na.value.author]])]),s("div",Q,[a[31]||(a[31]=s("label",{class:"lbl"},"Компания",-1)),u(s("input",{"onUpdate:modelValue":a[11]||(a[11]=l=>na.value.company=l),type:"text",class:"glass-input",placeholder:"Компания/Фонд"},null,512),[[c,na.value.company]])])]),s("div",W,[a[32]||(a[32]=s("label",{class:"lbl"},"Дополнительные примечания",-1)),u(s("textarea",{"onUpdate:modelValue":a[12]||(a[12]=l=>na.value.notes=l),class:"glass-input textarea",rows:"4",placeholder:"Комментарии, допущения, ограничения модели..."},null,512),[[c,na.value.notes]])])])])])):p("",!0)]),_:1}),t(r,{name:"fade"},{default:i(()=>[ea.value?(v(),e("div",X,[a[69]||(a[69]=s("div",{class:"panel-header"},[s("h3",null,"Шаг 3: Предпросмотр отчета"),s("span",{class:"step-badge variant-3"},"3")],-1)),s("div",Z,[na.value.includeExec?(v(),e("div",ll,[a[40]||(a[40]=s("h2",{class:"report-title"},"Резюме",-1)),s("div",al,[s("div",el,[a[35]||(a[35]=s("span",{class:"label"},"Облигация",-1)),s("span",sl,n(ea.value.secid),1)]),s("div",tl,[a[36]||(a[36]=s("span",{class:"label"},"Справедливая стоимость",-1)),s("span",nl,n(ra(ea.value.dirtyPrice,4))+" ₽",1)]),s("div",ul,[a[37]||(a[37]=s("span",{class:"label"},"Чистая цена",-1)),s("span",cl,n(ra(ea.value.cleanPrice,4))+" ₽",1)]),s("div",ol,[a[38]||(a[38]=s("span",{class:"label"},"% от номинала",-1)),s("span",dl,n(ra(ea.value.pricePercent,2))+"%",1)]),s("div",il,[a[39]||(a[39]=s("span",{class:"label"},"Дюрация (Modified)",-1)),s("span",rl,n(ra(ea.value.duration,4))+" лет",1)])])])):p("",!0),na.value.includeBondInfo?(v(),e("div",vl,[a[47]||(a[47]=s("h2",{class:"report-title"},"Параметры облигации",-1)),s("div",pl,[s("table",bl,[s("tbody",null,[s("tr",null,[a[41]||(a[41]=s("td",{class:"label"},"SECID/ISIN",-1)),s("td",ml,n(ea.value.secid),1)]),s("tr",null,[a[42]||(a[42]=s("td",{class:"label"},"Номинал",-1)),s("td",hl,n(ra(ea.value.faceValue))+" ₽",1)]),s("tr",null,[a[43]||(a[43]=s("td",{class:"label"},"Купон",-1)),s("td",yl,n(ra(ea.value.couponPercent,3))+"% годовых",1)]),s("tr",null,[a[44]||(a[44]=s("td",{class:"label"},"Дата выпуска",-1)),s("td",gl,n(va(ea.value.issueDate)),1)]),s("tr",null,[a[45]||(a[45]=s("td",{class:"label"},"Дата погашения",-1)),s("td",fl,n(va(ea.value.maturityDate)),1)]),s("tr",null,[a[46]||(a[46]=s("td",{class:"label"},"Периодичность выплат",-1)),s("td",xl,n(ea.value.paymentsPerYear)+" раз(а) в год",1)])])])])])):p("",!0),na.value.includeValuation?(v(),e("div",kl,[a[53]||(a[53]=s("h2",{class:"report-title"},"Результаты оценки",-1)),s("div",wl,[s("table",Cl,[s("tbody",null,[s("tr",null,[a[48]||(a[48]=s("td",{class:"label"},"Dirty Price",-1)),s("td",Pl,n(ra(ea.value.dirtyPrice,4))+" ₽",1)]),s("tr",null,[a[49]||(a[49]=s("td",{class:"label"},"НКД",-1)),s("td",Ul,n(ra(ea.value.accruedInterest,4))+" ₽",1)]),s("tr",null,[a[50]||(a[50]=s("td",{class:"label"},"Clean Price",-1)),s("td",Vl,n(ra(ea.value.cleanPrice,4))+" ₽",1)]),s("tr",null,[a[51]||(a[51]=s("td",{class:"label"},"Цена в % от номинала",-1)),s("td",Dl,n(ra(ea.value.pricePercent,3))+"%",1)]),s("tr",null,[a[52]||(a[52]=s("td",{class:"label"},"Дюрация (Modified)",-1)),s("td",Fl,n(ra(ea.value.duration,4))+" лет",1)])])])])])):p("",!0),na.value.includeCashFlows&&ea.value.cashFlows?(v(),e("div",Il,[a[56]||(a[56]=s("h2",{class:"report-title"},"Денежные потоки",-1)),a[57]||(a[57]=s("p",{class:"report-desc"},"Таблица дисконтированных денежных потоков",-1)),s("div",Sl,[s("table",Tl,[a[55]||(a[55]=s("thead",null,[s("tr",null,[s("th",null,"#"),s("th",null,"Дата"),s("th",{class:"text-right"},"T (лет)"),s("th",{class:"text-right"},"CF (₽)"),s("th",{class:"text-right"},"DF"),s("th",{class:"text-right"},"PV (₽)")])],-1)),s("tbody",null,[(v(!0),e(m,null,h(ea.value.cashFlows,(l,a)=>(v(),e("tr",{key:a},[s("td",null,n(a+1),1),s("td",null,n(va(l.date)),1),s("td",_l,n(ra(l.t,4)),1),s("td",Ml,n(ra(l.cf,2)),1),s("td",Yl,n(ra(l.df,6)),1),s("td",Al,n(ra(l.pv,4)),1)]))),128))]),s("tfoot",null,[s("tr",null,[a[54]||(a[54]=s("td",{colspan:"5",class:"text-right"},[s("strong",null,"Итого")],-1)),s("td",Bl,[s("strong",null,n(ra(ea.value.dirtyPrice,4)),1)])])])])])])):p("",!0),na.value.includeCoupons&&ea.value.allCoupons?(v(),e("div",Rl,[a[59]||(a[59]=s("h2",{class:"report-title"},"График купонных выплат",-1)),a[60]||(a[60]=s("p",{class:"report-desc"},"Полное расписание выплат купонов и номинала",-1)),s("div",jl,[s("table",El,[a[58]||(a[58]=s("thead",null,[s("tr",null,[s("th",null,"#"),s("th",null,"Дата купона"),s("th",{class:"text-right"},"Сумма (₽)"),s("th",null,"Статус")])],-1)),s("tbody",null,[(v(!0),e(m,null,h(ea.value.allCoupons,(l,a)=>(v(),e("tr",{key:a},[s("td",null,n(a+1),1),s("td",null,n(va(l.date)),1),s("td",zl,n(ra(l.value,2)),1),s("td",null,[s("span",{class:y(["status-badge",l.isPaid?"paid":"future"])},n(l.isPaid?"✓ Выплачен":"◯ Будущий"),3)])]))),128))])])])])):p("",!0),na.value.includeMetadata?(v(),e("div",Hl,[a[66]||(a[66]=s("h2",{class:"report-title"},"Метаданные модели",-1)),s("div",Ll,[s("table",Nl,[s("tbody",null,[s("tr",null,[a[61]||(a[61]=s("td",{class:"label"},"Дата оценки",-1)),s("td",Ol,n(va(f.value.valuationDate)),1)]),s("tr",null,[a[62]||(a[62]=s("td",{class:"label"},"Дисконтная ставка (YTM)",-1)),s("td",ql,n(ra(f.value.discountYield,3))+"%",1)]),s("tr",null,[a[63]||(a[63]=s("td",{class:"label"},"База расчета дней",-1)),s("td",$l,n(f.value.dayCount)+" дней",1)]),s("tr",null,[a[64]||(a[64]=s("td",{class:"label"},"Кол-во денежных потоков",-1)),s("td",Jl,n(ea.value.cashFlows.length),1)]),na.value.notes?(v(),e("tr",Gl,[a[65]||(a[65]=s("td",{class:"label"},"Примечания",-1)),s("td",Kl,n(na.value.notes),1)])):p("",!0)])])])])):p("",!0),s("div",Ql,[na.value.author?(v(),e("div",Wl,[a[67]||(a[67]=s("strong",null,"Автор:",-1)),d(" "+n(na.value.author),1)])):p("",!0),na.value.company?(v(),e("div",Xl,[a[68]||(a[68]=s("strong",null,"Компания:",-1)),d(" "+n(na.value.company),1)])):p("",!0),s("div",Zl,[s("small",null,"Отчет сформирован: "+n((new Date).toLocaleString("ru-RU")),1)])])])])):p("",!0)]),_:1}),t(r,{name:"fade"},{default:i(()=>[ea.value?(v(),e("div",la,[s("button",{class:"btn-glass primary",onClick:oa,disabled:sa.value}," Скачать PDF ",8,aa),s("button",{class:"btn-glass secondary",onClick:da}," Печать "),s("button",{class:"btn-glass secondary",onClick:ia}," Копировать ")])):p("",!0)]),_:1})]))}}),[["__scopeId","data-v-292e7a70"]]);export{ea as default};
