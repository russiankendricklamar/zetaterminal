import{d as a,r as l,v as e,G as s,c as t,e as i,f as n,x as r,L as u,y as d,C as o,t as v,F as c,n as p,A as m,q as b}from"./vendor-DLyKmMu8.js";import{i as f}from"./index-BjvaFruF.js";import{g as S,_ as k}from"./index-Ba4DjugF.js";const h={class:"sharpe-stats-page"},_={class:"page-header"},y={class:"header-right"},x=["disabled"],R={key:0},g={key:1},w={class:"input-grid"},F={class:"panel"},P={class:"input-row"},L={class:"panel"},A={class:"params-grid"},E={class:"param-row"},$={class:"param-row"},D={key:0,class:"error-banner"},V={class:"kpi-grid"},j={class:"kpi-value"},C={class:"kpi-sub"},I={class:"kpi-card"},N={class:"kpi-value"},U={class:"kpi-sub"},O={class:"kpi-card"},T={class:"kpi-value"},G={class:"kpi-sub"},H={class:"kpi-value"},q={class:"kpi-sub"},z={class:"kpi-value"},J={class:"kpi-sub"},B={class:"kpi-card"},K={class:"kpi-value"},M={class:"kpi-sub"},Q={class:"results-grid"},W={class:"panel"},X={class:"stats-table"},Y={class:"mono"},Z={class:"mono"},aa={class:"sep"},la={class:"mono"},ea={class:"mono accent"},sa={class:"mono"},ta={class:"mono accent"},ia={class:"sep"},na={class:"mono"},ra={class:"mono"},ua={class:"mono"},da={class:"panel"},oa={class:"panel"},va={class:"panel-header"},ca={class:"hint"},pa=k(a({__name:"SharpeStats",setup(a){const k=l(""),pa=l(.05),ma=l(252),ba=l(1),fa=l(1),Sa=l(!1),ka=l(""),ha=l(null),_a=l(null),ya=l(null);let xa=null,Ra=null;const ga=a=>a?.toFixed(2)??"—",wa=a=>a?.toFixed(3)??"—",Fa=a=>null!=a?(100*a).toFixed(2)+"%":"—",Pa=a=>null==a?"—":a<.001?"<0.001":a.toFixed(3),La=e(()=>{if(!ha.value)return"";const a=ha.value.sr_annual;return a>=2?"kpi-green":a>=1?"kpi-yellow":"kpi-red"}),Aa=e(()=>ha.value?ha.value.psr>=.95?"kpi-green":ha.value.psr>=.8?"kpi-yellow":"kpi-red":""),Ea=e(()=>ha.value?ha.value.dsr>=.95?"kpi-green":ha.value.dsr>=.8?"kpi-yellow":"kpi-red":"");async function $a(){ka.value="";const a=k.value.replace(/,/g," ").split(/\s+/).map(a=>a.trim()).filter(a=>a.length>0).map(a=>parseFloat(a)).filter(a=>!isNaN(a));if(a.length<10)ka.value="Нужно минимум 10 наблюдений";else{Sa.value=!0;try{const l=await fetch("   https://stochastic-dashbord-v1-production.up.railway.app/api/sharpe-stats/analyze",{method:"POST",headers:S(),body:JSON.stringify({returns:a,risk_free_rate:pa.value,periods_per_year:ma.value,benchmark_sr:ba.value,n_trials:fa.value})});if(!l.ok){const a=await l.json();throw new Error(a.detail||`HTTP ${l.status}`)}const e=await l.json();ha.value=e.result,await m(),Da()}catch(l){ka.value=l.message||"Неизвестная ошибка"}finally{Sa.value=!1}}}function Da(){ha.value&&(function(){if(!_a.value||!ha.value)return;xa||(xa=f(_a.value,"dark"));const{x:a,pdf:l}=ha.value.null_distribution,e=ha.value.sr_annual;ha.value.se_nonnormal;const s=ha.value.ci_95[0],t=ha.value.ci_95[1];xa.setOption({backgroundColor:"transparent",tooltip:{trigger:"axis",formatter:a=>`SR = ${parseFloat(a[0].axisValue).toFixed(3)}<br/>pdf = ${a[0].value[1].toFixed(4)}`},xAxis:{type:"value",name:"SR (годовой)",nameLocation:"middle",nameGap:25,axisLine:{lineStyle:{color:"#666"}}},yAxis:{type:"value",name:"Плотность",axisLine:{lineStyle:{color:"#666"}}},series:[{type:"line",data:a.map((a,e)=>[a,l[e]]),smooth:!0,lineStyle:{color:"#4e8ef7",width:2},areaStyle:{color:"rgba(78,142,247,0.15)"},showSymbol:!1,name:"H₀: SR=0"}],markLine:{data:[{xAxis:e,lineStyle:{color:"#f5c518",type:"solid",width:2},label:{formatter:`SR=${e.toFixed(2)}`}},{xAxis:s,lineStyle:{color:"#ff6b6b",type:"dashed"},label:{formatter:"95% ДИ"}},{xAxis:t,lineStyle:{color:"#ff6b6b",type:"dashed"},label:{formatter:""}}]},grid:{left:60,right:20,top:20,bottom:40}})}(),function(){if(!ya.value||!ha.value)return;Ra||(Ra=f(ya.value,"dark"));const{sr_star:a,psr_values:l}=ha.value.psr_curve,e=ha.value.benchmark_sr,s=ha.value.psr;Ra.setOption({backgroundColor:"transparent",tooltip:{trigger:"axis",formatter:a=>`SR* = ${parseFloat(a[0].axisValue).toFixed(2)}<br/>PSR = ${(100*a[0].value[1]).toFixed(1)}%`},xAxis:{type:"value",name:"SR* (пороговое значение)",nameLocation:"middle",nameGap:25,axisLine:{lineStyle:{color:"#666"}}},yAxis:{type:"value",name:"PSR(SR*)",min:0,max:1,axisLabel:{formatter:a=>(100*a).toFixed(0)+"%"},axisLine:{lineStyle:{color:"#666"}}},series:[{type:"line",data:a.map((a,e)=>[a,l[e]]),smooth:!0,lineStyle:{color:"#2ecc71",width:2},areaStyle:{color:"rgba(46,204,113,0.12)"},showSymbol:!1,name:"PSR",markLine:{data:[{xAxis:e,lineStyle:{color:"#f5c518",type:"solid",width:2},label:{formatter:`SR*=${e.toFixed(2)}\nPSR=${(100*s).toFixed(1)}%`}}]}}],grid:{left:65,right:20,top:20,bottom:40}})}())}return s(ha,()=>{m(Da)}),(a,l)=>{return b(),t("div",h,[i("div",_,[l[6]||(l[6]=i("div",{class:"header-left"},[i("h1",{class:"page-title"},"Статистика коэффициента Шарпа"),i("p",{class:"page-subtitle"},"SE, t-тест, PSR, DSR — проверка значимости и поправки на ненормальность")],-1)),i("div",y,[r(i("select",{"onUpdate:modelValue":l[0]||(l[0]=a=>ma.value=a),class:"control-select"},[...l[5]||(l[5]=[i("option",{value:252},"Дневные (252/год)",-1),i("option",{value:52},"Недельные (52/год)",-1),i("option",{value:12},"Месячные (12/год)",-1)])],512),[[u,ma.value]]),i("button",{onClick:$a,class:"btn-primary",disabled:Sa.value},[Sa.value?(b(),t("span",g,"↺ Считаю...")):(b(),t("span",R,"Рассчитать"))],8,x)])]),i("div",w,[i("div",F,[l[8]||(l[8]=i("div",{class:"panel-header"},[i("h3",null,"Ряд доходностей"),i("span",{class:"hint"},"Вставьте числа через запятую, пробел или перенос строки (в долях: 0.01 = 1%)")],-1)),r(i("textarea",{"onUpdate:modelValue":l[1]||(l[1]=a=>k.value=a),class:"returns-textarea",placeholder:"0.001\n-0.002\n0.003\n...",rows:"8"},null,512),[[d,k.value]]),i("div",P,[l[7]||(l[7]=i("label",null,"Безрисковая ставка (годовая):",-1)),r(i("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>pa.value=a),type:"number",step:"0.001",min:"0",max:"1",class:"param-input"},null,512),[[d,pa.value,void 0,{number:!0}]])])]),i("div",L,[l[11]||(l[11]=i("div",{class:"panel-header"},[i("h3",null,"Параметры тестирования")],-1)),i("div",A,[i("div",E,[l[9]||(l[9]=i("label",null,"Пороговое SR (для PSR):",-1)),r(i("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>ba.value=a),type:"number",step:"0.1",class:"param-input"},null,512),[[d,ba.value,void 0,{number:!0}]])]),i("div",$,[l[10]||(l[10]=i("label",null,"Кол-во стратегий N (для DSR):",-1)),r(i("input",{"onUpdate:modelValue":l[4]||(l[4]=a=>fa.value=a),type:"number",min:"1",step:"1",class:"param-input"},null,512),[[d,fa.value,void 0,{number:!0}]])])]),l[12]||(l[12]=o('<div class="formula-box" data-v-ba8fd68f><div class="formula-title" data-v-ba8fd68f>Ключевые формулы</div><div class="formula" data-v-ba8fd68f>SR = μ<sub data-v-ba8fd68f>e</sub> / σ · √T</div><div class="formula" data-v-ba8fd68f>SE<sub data-v-ba8fd68f>adj</sub> = √[(1 + SR²/2 − γ₁·SR + γ₂/4) / n]</div><div class="formula" data-v-ba8fd68f>PSR(SR*) = Φ[(SR̂ − SR*)·√(n−1) / √D]</div><div class="formula small" data-v-ba8fd68f>D = 1 − γ₁·SR̂ + (γ₂+1)/4·SR̂²</div></div>',1))])]),ka.value?(b(),t("div",D,v(ka.value),1)):n("",!0),ha.value?(b(),t(c,{key:1},[i("div",V,[i("div",{class:p(["kpi-card",La.value])},[l[13]||(l[13]=i("div",{class:"kpi-label"},"Годовой SR",-1)),i("div",j,v(ga(ha.value.sr_annual)),1),i("div",C,v(ha.value.is_significant_5pct?"значим на 5%":"не значим на 5%"),1)],2),i("div",I,[l[14]||(l[14]=i("div",{class:"kpi-label"},"t-статистика",-1)),i("div",N,v(ga(ha.value.t_stat)),1),i("div",U,"p = "+v(Pa(ha.value.p_value)),1)]),i("div",O,[l[15]||(l[15]=i("div",{class:"kpi-label"},"SE (ненорм.)",-1)),i("div",T,v(wa(ha.value.se_nonnormal)),1),i("div",G,"IID: "+v(wa(ha.value.se_iid)),1)]),i("div",{class:p(["kpi-card",Aa.value])},[l[16]||(l[16]=i("div",{class:"kpi-label"},"PSR",-1)),i("div",H,v(Fa(ha.value.psr)),1),i("div",q,"vs SR* = "+v(ga(ha.value.benchmark_sr)),1)],2),i("div",{class:p(["kpi-card",Ea.value])},[l[17]||(l[17]=i("div",{class:"kpi-label"},"DSR",-1)),i("div",z,v(Fa(ha.value.dsr)),1),i("div",J,"N = "+v(ha.value.n_trials)+" стратегий",1)],2),i("div",B,[l[18]||(l[18]=i("div",{class:"kpi-label"},"Наблюдений",-1)),i("div",K,v(ha.value.n_observations),1),i("div",M,"vol = "+v(Fa(ha.value.vol_annual)),1)])]),i("div",Q,[i("div",W,[l[31]||(l[31]=i("div",{class:"panel-header"},[i("h3",null,"Распределение доходностей")],-1)),i("table",X,[i("tbody",null,[i("tr",null,[l[19]||(l[19]=i("td",null,"Среднегодовая доходность",-1)),i("td",Y,v(Fa(ha.value.mean_annual)),1)]),i("tr",null,[l[20]||(l[20]=i("td",null,"Годовая волатильность",-1)),i("td",Z,v(Fa(ha.value.vol_annual)),1)]),i("tr",null,[l[21]||(l[21]=i("td",null,"Асимметрия (skewness)",-1)),i("td",{class:p(["mono",ha.value.skewness<0?"neg":"pos"])},v(wa(ha.value.skewness)),3)]),i("tr",null,[l[22]||(l[22]=i("td",null,"Избыточный эксцесс",-1)),i("td",{class:p(["mono",ha.value.excess_kurtosis>0?"neg":"pos"])},v(wa(ha.value.excess_kurtosis)),3)]),i("tr",aa,[l[23]||(l[23]=i("td",null,"SR (за период)",-1)),i("td",la,v((e=ha.value.sr_freq,e?.toFixed(4)??"—")),1)]),i("tr",null,[l[24]||(l[24]=i("td",null,"SR годовой",-1)),i("td",ea,v(ga(ha.value.sr_annual)),1)]),i("tr",null,[l[25]||(l[25]=i("td",null,"SE (IID нормальность)",-1)),i("td",sa,v(wa(ha.value.se_iid)),1)]),i("tr",null,[l[26]||(l[26]=i("td",null,"SE (с поправкой)",-1)),i("td",ta,v(wa(ha.value.se_nonnormal)),1)]),i("tr",ia,[l[27]||(l[27]=i("td",null,"t-статистика",-1)),i("td",na,v(ga(ha.value.t_stat)),1)]),i("tr",null,[l[28]||(l[28]=i("td",null,"p-value (двустор.)",-1)),i("td",{class:p(["mono",ha.value.p_value<.05?"pos":"neg"])},v(Pa(ha.value.p_value)),3)]),i("tr",null,[l[29]||(l[29]=i("td",null,"95% ДИ",-1)),i("td",ra,"["+v(ga(ha.value.ci_95[0]))+", "+v(ga(ha.value.ci_95[1]))+"]",1)]),i("tr",null,[l[30]||(l[30]=i("td",null,"99% ДИ",-1)),i("td",ua,"["+v(ga(ha.value.ci_99[0]))+", "+v(ga(ha.value.ci_99[1]))+"]",1)])])])]),i("div",da,[l[32]||(l[32]=i("div",{class:"panel-header"},[i("h3",null,"Распределение SR под H₀")],-1)),i("div",{ref_key:"nullChartEl",ref:_a,class:"chart-container"},null,512)])]),i("div",oa,[i("div",va,[l[33]||(l[33]=i("h3",null,"PSR-кривая — вероятность превышения SR*",-1)),i("span",ca,"Вертикальная линия — текущий SR*="+v(ga(ha.value.benchmark_sr))+", PSR="+v(Fa(ha.value.psr)),1)]),i("div",{ref_key:"psrChartEl",ref:ya,class:"chart-container chart-tall"},null,512)])],64)):n("",!0)]);var e}}}),[["__scopeId","data-v-ba8fd68f"]]);export{pa as default};
