import{d as l,r as a,v as e,G as s,c as t,e as i,f as o,x as n,j as r,M as c,L as d,y as u,n as v,t as p,F as m,i as h,A as _,q as f}from"./vendor-DLyKmMu8.js";import{i as b}from"./index-BjvaFruF.js";import{g as y,_ as k}from"./index-Ba4DjugF.js";const g={class:"har-page"},R={class:"page-header"},V={class:"header-right"},x={class:"toggle-label"},w=["disabled"],S={key:0},A={key:1},j={class:"input-grid"},E={class:"panel"},H={class:"panel"},L={class:"model-desc-row"},C={key:0,class:"error-banner"},F={class:"kpi-grid"},M={class:"kpi-card"},O={class:"kpi-sub"},q={class:"kpi-card"},I={class:"kpi-value"},J={class:"kpi-card"},z={class:"kpi-value mono"},N={class:"kpi-sub"},$={key:0,class:"kpi-card"},U={class:"kpi-value mono"},B={class:"kpi-sub"},K={class:"kpi-card accent-card"},Q={class:"kpi-value"},T={class:"kpi-card"},P={class:"kpi-value"},G={class:"results-grid"},W={class:"panel"},Z={class:"coef-table"},D={class:"mono"},X={class:"mono"},Y={class:"coef-table"},ll={class:"mono"},al={class:"mono"},el={class:"r2-row"},sl={class:"panel"},tl={class:"forecast-cards"},il={class:"fcast-h"},ol={class:"fcast-vol"},nl={class:"fcast-rv"},rl={key:0,class:"metrics-comparison"},cl={class:"stats-table"},dl={class:"mono"},ul={class:"mono"},vl={class:"mono"},pl={class:"mono"},ml={class:"panel"},hl=k(l({__name:"HARModel",setup(l){const k=a(""),hl=a(""),_l=a(!1),fl=a(.8),bl=a(!1),yl=a(""),kl=a(null),gl=a(null);let Rl=null;function Vl(l){return l.replace(/,/g," ").split(/\s+/).map(l=>l.trim()).filter(l=>l.length>0).map(l=>parseFloat(l)).filter(l=>!isNaN(l))}const xl=e(()=>Vl(hl.value)),wl=l=>null!=l?(100*l).toFixed(2)+"%":"—",Sl=l=>l?.toFixed(2)??"—",Al=l=>l?.toFixed(4)??"—",jl=l=>null==l?"—":l<.001?"<0.001":l.toFixed(3),El=l=>null==l?"—":0===l?"0":l.toExponential(3);async function Hl(){yl.value="";const l=Vl(k.value);if(l.length<50)return void(yl.value="Нужно минимум 50 наблюдений RV");const a=xl.value;if(a.length>0&&a.length!==l.length)yl.value="BV должен совпадать по длине с RV";else{bl.value=!0;try{const e=await fetch("   https://stochastic-dashbord-v1-production.up.railway.app/api/har/fit",{method:"POST",headers:y(),body:JSON.stringify({rv:l,bv:a.length>0?a:null,log_transform:_l.value,forecast_horizons:[1,5,22],train_ratio:fl.value})});if(!e.ok){const l=await e.json();throw new Error(l.detail||`HTTP ${e.status}`)}const s=await e.json();kl.value=s.result,await _(),Ll()}catch(e){yl.value=e.message||"Неизвестная ошибка"}finally{bl.value=!1}}}function Ll(){if(!gl.value||!kl.value)return;Rl||(Rl=b(gl.value,"dark"));const{actual_vol:l,fitted_vol:a,n:e,train_end:s}=kl.value.plot_data,t=Array.from({length:e},(l,a)=>a+1);Rl.setOption({backgroundColor:"transparent",tooltip:{trigger:"axis",formatter:l=>{const a=l[0]?.axisValue;return`t = ${a}<br/>${l.map(l=>`${l.seriesName}: ${parseFloat(l.value).toFixed(2)}%`).join("<br/>")}`}},legend:{data:["Факт. vol","HAR fitted"],top:4,textStyle:{color:"#aaa"}},xAxis:{type:"category",data:t,axisLabel:{show:!1},axisLine:{lineStyle:{color:"#444"}}},yAxis:{type:"value",name:"Vol % (годовая)",axisLabel:{formatter:l=>l.toFixed(1)+"%"},axisLine:{lineStyle:{color:"#444"}}},series:[{name:"Факт. vol",type:"line",data:l,lineStyle:{color:"#4e8ef7",width:1.5},showSymbol:!1,areaStyle:{color:"rgba(78,142,247,0.07)"}},{name:"HAR fitted",type:"line",data:a,lineStyle:{color:"#f5c518",width:1.5,type:"dashed"},showSymbol:!1}],markLine:{data:[{xAxis:s,lineStyle:{color:"#555",type:"solid",width:1},label:{formatter:"train|test",color:"#666"}}]},grid:{left:60,right:20,top:40,bottom:20},dataZoom:[{type:"inside"},{type:"slider",height:20,bottom:0}]})}return s(kl,()=>_(Ll)),(l,a)=>(f(),t("div",g,[i("div",R,[a[6]||(a[6]=i("div",{class:"header-left"},[i("h1",{class:"page-title"},"HAR Model — Прогнозирование волатильности"),i("p",{class:"page-subtitle"},"Heterogeneous AutoRegressive модель: β₀ + β_d·RV_t + β_w·RV̄_{t-5} + β_m·RV̄_{t-22}")],-1)),i("div",V,[i("label",x,[n(i("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=l=>_l.value=l)},null,512),[[c,_l.value]]),a[4]||(a[4]=r(" log(RV) ",-1))]),n(i("select",{"onUpdate:modelValue":a[1]||(a[1]=l=>fl.value=l),class:"control-select"},[...a[5]||(a[5]=[i("option",{value:.7},"70/30 split",-1),i("option",{value:.8},"80/20 split",-1),i("option",{value:.9},"90/10 split",-1)])],512),[[d,fl.value]]),i("button",{onClick:Hl,class:"btn-primary",disabled:bl.value},[bl.value?(f(),t("span",A,"↺ Считаю...")):(f(),t("span",S,"Оценить"))],8,w)])]),i("div",j,[i("div",E,[a[7]||(a[7]=i("div",{class:"panel-header"},[i("h3",null,"Ряд RV (Realized Variance)"),i("span",{class:"hint"},"Ежедневные значения через запятую/пробел/перенос строки (> 0)")],-1)),n(i("textarea",{"onUpdate:modelValue":a[2]||(a[2]=l=>k.value=l),class:"data-textarea",placeholder:"0.0001\n0.00015\n0.00012\n...",rows:"7"},null,512),[[u,k.value]])]),i("div",H,[a[8]||(a[8]=i("div",{class:"panel-header"},[i("h3",null,"BV (Bipower Variation) — необязательно"),i("span",{class:"hint"},"Для HAR-RV-CJ модели с компонентом скачков")],-1)),n(i("textarea",{"onUpdate:modelValue":a[3]||(a[3]=l=>hl.value=l),class:"data-textarea",placeholder:"0.00009\n0.00013\n0.00011\n...",rows:"7"},null,512),[[u,hl.value]])])]),i("div",L,[i("div",{class:v(["formula-card",{active:!_l.value}])},[...a[9]||(a[9]=[i("div",{class:"fc-title"},"HAR-RV",-1),i("div",{class:"fc-formula"},"RV_t = β₀ + β_d·RV_{t-1} + β_w·RV̄_{t-5} + β_m·RV̄_{t-22} + ε_t",-1)])],2),i("div",{class:v(["formula-card",{active:_l.value}])},[...a[10]||(a[10]=[i("div",{class:"fc-title"},"Log-HAR",-1),i("div",{class:"fc-formula"},"log(RV_t) = β₀ + β_d·log(RV_{t-1}) + β_w·log(RV̄_{t-5}) + β_m·log(RV̄_{t-22})",-1)])],2),i("div",{class:v(["formula-card",{active:xl.value.length>0}])},[...a[11]||(a[11]=[i("div",{class:"fc-title"},"HAR-RV-CJ",-1),i("div",{class:"fc-formula"},"RV_t = β₀ + β_C·C_{t-1} + β_J·J_{t-1} + β_w·C̄_{t-5} + β_m·C̄_{t-22}",-1)])],2)]),yl.value?(f(),t("div",C,p(yl.value),1)):o("",!0),kl.value?(f(),t(m,{key:1},[i("div",F,[i("div",M,[a[12]||(a[12]=i("div",{class:"kpi-label"},"R² (train)",-1)),i("div",{class:v(["kpi-value",kl.value.r2>.7?"val-green":kl.value.r2>.4?"val-yellow":"val-red"])},p(wl(kl.value.r2)),3),i("div",O,"скорр.: "+p(wl(kl.value.r2_adj)),1)]),i("div",q,[a[13]||(a[13]=i("div",{class:"kpi-label"},"R² (full)",-1)),i("div",I,p(wl(kl.value.r2_full)),1),a[14]||(a[14]=i("div",{class:"kpi-sub"},"вся выборка",-1))]),i("div",J,[a[15]||(a[15]=i("div",{class:"kpi-label"},"IS RMSE",-1)),i("div",z,p(El(kl.value.is_metrics?.rmse)),1),i("div",N,"QLIKE: "+p(Al(kl.value.is_metrics?.qlike)),1)]),null!=kl.value.oos_metrics?.rmse?(f(),t("div",$,[a[16]||(a[16]=i("div",{class:"kpi-label"},"OOS RMSE",-1)),i("div",U,p(El(kl.value.oos_metrics.rmse)),1),i("div",B,"QLIKE: "+p(Al(kl.value.oos_metrics.qlike)),1)])):o("",!0),i("div",K,[a[17]||(a[17]=i("div",{class:"kpi-label"},"Прогноз h=1",-1)),i("div",Q,p(wl(kl.value.forecasts?.h1?.vol_annual)),1),a[18]||(a[18]=i("div",{class:"kpi-sub"},"годовая vol",-1))]),i("div",T,[a[19]||(a[19]=i("div",{class:"kpi-label"},"Прогноз h=22",-1)),i("div",P,p(wl(kl.value.forecasts?.h22?.vol_annual)),1),a[20]||(a[20]=i("div",{class:"kpi-sub"},"месячный горизонт",-1))])]),i("div",G,[i("div",W,[a[24]||(a[24]=i("div",{class:"panel-header"},[i("h3",null,"Коэффициенты HAR-RV (Newey-West SE)")],-1)),i("table",Z,[a[21]||(a[21]=i("thead",null,[i("tr",null,[i("th",null,"Параметр"),i("th",null,"β"),i("th",null,"SE"),i("th",null,"t-стат"),i("th",null,"p-value"),i("th")])],-1)),i("tbody",null,[(f(!0),t(m,null,h(kl.value.coefficients,l=>(f(),t("tr",{key:l.name},[i("td",null,p(l.name),1),i("td",D,p(Al(l.beta)),1),i("td",X,p(Al(l.se)),1),i("td",{class:v(["mono",Math.abs(l.t_stat)>1.96?"pos":"muted"])},p(Sl(l.t_stat)),3),i("td",{class:v(["mono",l.p_value<.05?"pos":"muted"])},p(jl(l.p_value)),3),i("td",null,p(l.significant?"***":""),1)]))),128))])]),kl.value.cj_model?(f(),t(m,{key:0},[a[23]||(a[23]=i("div",{class:"panel-header",style:{"margin-top":"16px"}},[i("h3",null,"HAR-RV-CJ коэффициенты")],-1)),i("table",Y,[a[22]||(a[22]=i("thead",null,[i("tr",null,[i("th",null,"Параметр"),i("th",null,"β"),i("th",null,"SE"),i("th",null,"t-стат"),i("th",null,"p-value")])],-1)),i("tbody",null,[(f(!0),t(m,null,h(kl.value.cj_model.coefficients,l=>(f(),t("tr",{key:l.name},[i("td",null,p(l.name),1),i("td",ll,p(Al(l.beta)),1),i("td",al,p(Al(l.se)),1),i("td",{class:v(["mono",Math.abs(l.t_stat)>1.96?"pos":"muted"])},p(Sl(l.t_stat)),3),i("td",{class:v(["mono",l.p_value<.05?"pos":"muted"])},p(jl(l.p_value)),3)]))),128))])]),i("div",el,"R² = "+p(wl(kl.value.cj_model.r2))+"  |  R²_adj = "+p(wl(kl.value.cj_model.r2_adj)),1)],64)):o("",!0)]),i("div",sl,[a[30]||(a[30]=i("div",{class:"panel-header"},[i("h3",null,"Прогнозы волатильности")],-1)),i("div",tl,[(f(!0),t(m,null,h(kl.value.forecasts,(l,a)=>(f(),t("div",{key:a,class:"fcast-card"},[i("div",il,"h = "+p(l.horizon_days)+" "+p(1===l.horizon_days?"день":l.horizon_days<5?"дня":"дней"),1),i("div",ol,p(wl(l.vol_annual)),1),i("div",nl,"RV = "+p(El(l.rv)),1)]))),128))]),null!=kl.value.oos_metrics?.rmse?(f(),t("div",rl,[a[29]||(a[29]=i("div",{class:"panel-header",style:{"margin-top":"16px"}},[i("h3",null,"IS vs OOS сравнение")],-1)),i("table",cl,[a[28]||(a[28]=i("thead",null,[i("tr",null,[i("th",null,"Метрика"),i("th",null,"IS (train)"),i("th",null,"OOS (test)")])],-1)),i("tbody",null,[i("tr",null,[a[25]||(a[25]=i("td",null,"RMSE",-1)),i("td",dl,p(El(kl.value.is_metrics.rmse)),1),i("td",{class:v(["mono",kl.value.oos_metrics.rmse>1.5*kl.value.is_metrics.rmse?"neg":"pos"])},p(El(kl.value.oos_metrics.rmse)),3)]),i("tr",null,[a[26]||(a[26]=i("td",null,"MAE",-1)),i("td",ul,p(El(kl.value.is_metrics.mae)),1),i("td",vl,p(El(kl.value.oos_metrics.mae)),1)]),i("tr",null,[a[27]||(a[27]=i("td",null,"QLIKE",-1)),i("td",pl,p(Al(kl.value.is_metrics.qlike)),1),i("td",{class:v(["mono",kl.value.oos_metrics.qlike>1.5*kl.value.is_metrics.qlike?"neg":"pos"])},p(Al(kl.value.oos_metrics.qlike)),3)])])])])):o("",!0)])]),i("div",ml,[a[31]||(a[31]=i("div",{class:"panel-header"},[i("h3",null,"Фактическая vs подогнанная волатильность"),i("span",{class:"hint"},"Серая вертикаль — граница обучающей/тестовой выборки")],-1)),i("div",{ref_key:"chartEl",ref:gl,class:"chart-container"},null,512)])],64)):o("",!0)]))}}),[["__scopeId","data-v-3879bffb"]]);export{hl as default};
