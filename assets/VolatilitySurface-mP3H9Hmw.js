import{d as e,r as t,o as a,A as l,R as s,c as n,e as o,f as i,x as r,y as c,M as d,t as u,n as p,g as v,w as b,T as h,F as g,i as f,B as y,k as m,q as x}from"./vendor-DLyKmMu8.js";import{C as w}from"./auto-DlDBEVoY.js";import{S as k,C,P as M,W as S,A,D as z,G as F,B as V,g as T,j as _,M as I,v as R,b as E,L as B,h as P,q,m as D,i as L,d as Y,e as j,f as H,w as O}from"./three.module-7SAW-liO.js";import{r as U,u as X,w as G}from"./xlsx-Dmkey_AY.js";import{s as W}from"./optionService-BnVFjN1Q.js";import{_ as $}from"./index-Ba4DjugF.js";const N={class:"volatility-surface-page"},K={class:"page-header"},J={class:"header-right"},Q={class:"control-group"},Z={class:"control-group"},ee={class:"control-group checkbox"},te={class:"control-group checkbox"},ae={class:"control-group"},le={class:"select-selected"},se={class:"select-text"},ne={key:0,class:"select-options"},oe=["onClick"],ie={style:{flex:"1",display:"flex","flex-direction":"column",gap:"2px"}},re={class:"option-text"},ce={class:"option-subtext"},de={key:0,class:"option-badge"},ue={key:0,class:"card full-width",style:{"margin-bottom":"24px",background:"rgba(239, 68, 68, 0.1)","border-color":"rgba(239, 68, 68, 0.3)"}},pe={style:{padding:"12px",color:"rgba(239, 68, 68, 0.9)","font-size":"13px"}},ve={key:1,class:"card full-width",style:{"margin-bottom":"24px"}},be={class:"card-header",style:{display:"flex","justify-content":"space-between","align-items":"center"}},he={class:"card-subtitle"},ge={style:{display:"flex",gap:"8px"}},fe=["disabled"],ye={key:0},me={key:1},xe=["disabled"],we=["disabled"],ke={key:0},Ce={key:1},Me={class:"scenario-table-container"},Se={class:"scenario-table"},Ae=["onClick"],ze={class:"mono"},Fe={class:"mono"},Ve={class:"mono accent"},Te=["onClick"],_e={class:"three-d-container"},Ie={class:"grid-4"},Re={class:"stat-card"},Ee={class:"stat-value accent"},Be={class:"stat-detail"},Pe={class:"value"},qe={class:"stat-card"},De={class:"stat-detail"},Le={class:"value"},Ye={class:"stat-card"},je={class:"stat-value cyan"},He={class:"stat-detail"},Oe={class:"value"},Ue={class:"stat-card"},Xe={class:"stat-value green"},Ge={class:"stat-detail"},We={class:"value"},$e={class:"card full-width"},Ne={class:"surface-matrix-container"},Ke={class:"surface-matrix-table"},Je={class:"strike-label"},Qe={class:"vol-value"},Ze={class:"grid-2"},et={class:"card"},tt={class:"chart-container"},at={class:"card"},lt={class:"chart-container"},st={class:"card full-width"},nt={class:"chart-container tall"},ot={class:"grid-2"},it={class:"card"},rt={class:"chart-container"},ct={class:"card"},dt={class:"chart-container"},ut={class:"card full-width"},pt={class:"info-grid"},vt={class:"info-item"},bt={class:"value"},ht={class:"info-item"},gt={class:"value"},ft={class:"info-item"},yt={class:"value mono"},mt={class:"info-item"},xt={class:"value mono"},wt={class:"info-item"},kt={class:"value mono"},Ct={class:"info-item"},Mt={class:"value mono"},St={class:"info-item"},At={class:"value"},zt=$(e({__name:"VolatilitySurface",setup(e){const $=t("spy"),zt=t("sabr"),Ft=t(!1),Vt=t(!0),Tt=t(!1),_t=t(!1),It=t((new Date).toISOString().split("T")[0]),Rt=t(null),Et=t([]),Bt=t(null),Pt=t(!1),qt=t(!1),Dt=t(""),Lt=[{value:"bsm",label:"Black-Scholes",icon:"BS",iconClass:"icon-bsm",description:"ÐšÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ"},{value:"heston",label:"Heston",icon:"H",iconClass:"icon-heston",description:"Ð¡Ñ‚Ð¾Ñ…Ð°ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ"},{value:"merton",label:"Merton",icon:"M",iconClass:"icon-merton",description:"ÐœÐ¾Ð´ÐµÐ»ÑŒ ÑÐºÐ°Ñ‡ÐºÐ¾Ð²"},{value:"bates",label:"Bates",icon:"B",iconClass:"icon-bates",description:"Heston + Ð¡ÐºÐ°Ñ‡ÐºÐ¸"},{value:"sabr",label:"SABR",icon:"S",iconClass:"icon-sabr",description:"Stochastic Alpha Beta Rho"},{value:"vg",label:"Variance Gamma",icon:"VG",iconClass:"icon-vg",description:"VG Process"}],Yt=e=>{const t=Lt.find(t=>t.value===e);return t?.label||"SABR"},jt=e=>{const t=Lt.find(t=>t.value===e);return t?.icon||"S"},Ht=e=>{const t=Lt.find(t=>t.value===e);return t?.iconClass||"icon-sabr"},Ot=()=>{Ft.value=!Ft.value},Ut=e=>{e.target.closest(".custom-select-wrapper")||(Ft.value=!1)},Xt=t(null);let Gt=null,Wt=null,$t=null,Nt=null,Kt=null;const Jt=["1M","3M","6M","1Y","2Y","3Y"],Qt=[.7,.8,.9,.95,1,1.05,1.1,1.2,1.3],Zt=t("4850.25"),ea=t(.158),ta=t(.162),aa=t(-.035),la=t(-.025),sa=t(.008),na=t("Upward"),oa=t(.068),ia=t(.045),ra=t(.0425),ca=t(.018),da=t(.041),ua=t("14:35:22 UTC"),pa=t("LIVE"),va=t(null),ba=t(null),ha=t(null),ga=t(null),fa=t(null);let ya={};const ma=(e,t="sabr")=>{const a=[];let l=.15,s=.8,n=-.3,o=.04,i=-.05;"eur"===e?(l=.08,n=-.15,o=.02):"brent"===e?(l=.35,n=.1,o=.06):"rates"===e&&(l=.012,s=.5,n=-.5,o=.01);for(let r=0;r<Qt.length;r++){const e=[],c=Qt[r],d=Math.log(c);for(let a=0;a<Jt.length;a++){const r=[1/12,.25,.5,1,2,3][a],c=Math.sqrt(r),u=1;let p=.15;if("bsm"===t){p=l*(d<0?1+-.3*d:1+-.15*d)*(1+.03*(1-r))}else if("heston"===t){const e=o+(.04-o)*(1-Math.exp(-3*r)),t=d<0?1+-.4*d*(1+.5*n):1+-.2*d*(1+.5*n);p=Math.sqrt(e)*t}else if("merton"===t){const e=.1*(Math.exp(i+.01125)-1);p=Math.sqrt(l*l+.1*.025)*(d<0?1+-.5*d:1+-.25*d)*(1+e*r)}else if("bates"===t){const e=o+(.04-o)*(1-Math.exp(-3*r)),t=.1*(Math.exp(i+.01125)-1),a=d<0?1+-.45*d*(1+.5*n):1+-.25*d*(1+.5*n);p=Math.sqrt(e)*a*(1+t*r*.5)}else if("sabr"===t){p=l*Math.pow(u,s-1)*(d<0?1+-.4*d:1+-.2*d)*(1+.05*(1-r))*(1+.15*Math.abs(d))/c}else if("vg"===t){const e=-.08;p=Math.sqrt(l*l+.13333333333333336)*(d<0?1+-.35*d*1.3:1+-.18*d*1.3)*(1+.04*(1-r))*(1+e*r)}e.push(Math.max(.05,Math.min(1,p)))}a.push(e)}return a};let xa=ma("spy","sabr");const wa=(e,t)=>{const a=Qt.indexOf(e),l=Jt.indexOf(t);return a>=0&&l>=0?xa[a][l]:.15};let ka=null;const Ca=()=>{if(!Gt)return;ka&&Gt.remove(ka),ka=new F,ka.name="sceneContainer";const e=new V,t=[],a=[],l=[];for(let n=0;n<Qt.length;n++)for(let e=0;e<Jt.length;e++){const a=10*(n/Qt.length-.5),s=15*xa[n][e],o=8*(e/Jt.length-.5);t.push(a,s,o);const i=xa[n][e];i<.1?l.push(.29,.87,.5):i<.15?l.push(.38,.65,1):i<.2?l.push(.96,.62,.04):l.push(.97,.44,.44)}for(let n=0;n<Qt.length-1;n++)for(let e=0;e<Jt.length-1;e++){const t=n*Jt.length+e,l=t+1,s=(n+1)*Jt.length+e,o=s+1;a.push(t,l,s),a.push(l,o,s)}e.setAttribute("position",new T(new Float32Array(t),3)),e.setAttribute("color",new T(new Float32Array(l),3)),e.setIndex(new T(new Uint32Array(a),1)),e.computeVertexNormals();const s=new _({vertexColors:!0,wireframe:Tt.value,flatShading:!1,emissive:1710618,shininess:30});if(Nt=new I(e,s),ka.add(Nt),Vt.value){const e=new R(12,12,4473924,2236962);e.position.y=-.5,e.rotation.x=0,ka.add(e);const t=new R(12,12,4473924,2236962);t.position.z=-6,t.rotation.x=Math.PI/2,ka.add(t);const a=new R(12,12,4473924,2236962);a.position.x=-6,a.rotation.z=Math.PI/2,ka.add(a)}Ma(ka),Gt.add(ka)},Ma=e=>{const t=new F;t.name="axesGroup";const a=new E(-6,0,-6);t.position.copy(a);const l=12,s=.3,n=.2,o=16777215,i=new B({color:o,linewidth:3}),r=new B({color:o,linewidth:1}),c=(e,t)=>{const a=document.createElement("canvas");a.width=1024,a.height=512;const l=a.getContext("2d");l.fillStyle="#ffffff",l.font="bold 72px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText(e,512,256);const s=new Y(a),n=new j({map:s}),o=new H(n);return o.scale.set(5,2.5,1),o.position.copy(t),o},d=(e,t)=>{const a=document.createElement("canvas");a.width=1024,a.height=512;const l=a.getContext("2d");l.fillStyle="#ffffff",l.font="bold 96px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText(e,512,256);const s=new Y(a),n=new j({map:s}),o=new H(n);return o.scale.set(7,3.5,1),o.position.copy(t),o},u=new V;u.setAttribute("position",new T(new Float32Array([0,0,0,l,0,0]),3));const p=new P(u,i);t.add(p);const v=new q(.105,s,8),b=new D({color:o}),h=new I(v,b);h.position.set(12.15,0,0),h.rotation.z=-Math.PI/2,t.add(h);for(let F=0;F<=6;F++){const e=F/6*l,a=new V;a.setAttribute("position",new T(new Float32Array([e,-.2,0,e,n,0]),3));const s=new P(a,r);t.add(s);const o=c((100*(Qt[Math.floor(F/6*(Qt.length-1))]-1)).toFixed(0)+"%",new E(e,-.8,0));t.add(o)}const g=d("Strike (%)",new E(6,-2.5,0));t.add(g);const f=new V;f.setAttribute("position",new T(new Float32Array([0,0,0,0,l,0]),3));const y=new P(f,i);t.add(y);const m=new q(.105,s,8),x=new D({color:o}),w=new I(m,x);w.position.set(0,12.15,0),t.add(w);const k=100*Math.max(...xa.flat());for(let F=0;F<=6;F++){const e=F/6*l,a=new V;a.setAttribute("position",new T(new Float32Array([-.2,e,0,n,e,0]),3));const s=new P(a,r);t.add(s);const o=c((e/l*k).toFixed(1)+"%",new E(-.8,e,0));t.add(o)}const C=d("IV (%)",new E(-2.5,6,0));t.add(C);const M=new V;M.setAttribute("position",new T(new Float32Array([0,0,0,0,0,l]),3));const S=new P(M,i);t.add(S);const A=new q(.105,s,8),z=new D({color:o}),_=new I(A,z);_.position.set(0,0,11.85),_.rotation.x=Math.PI/2,t.add(_);for(let F=0;F<=6;F++){const e=F/6*l,a=new V;a.setAttribute("position",new T(new Float32Array([-.2,0,e,n,0,e]),3));const s=new P(a,r);t.add(s);const o=Math.floor(F/6*(Jt.length-1)),i=c(Jt[o],new E(0,-.8,e));t.add(i)}const R=d("Tenor",new E(0,-2.5,6));t.add(R);const O=new L(.12,12,12),U=new D({color:o}),X=new I(O,U);t.add(X),e.add(t)},Sa=()=>{if(!Xt.value||!Wt||!ka)return;let e=!1,t=!1,a={x:0,y:0};const l=new E(0,0,0);Xt.value.addEventListener("mousedown",l=>{0===l.button?(e=!0,a={x:l.clientX,y:l.clientY},Xt.value.style.cursor="grabbing"):2===l.button&&(t=!0,a={x:l.clientX,y:l.clientY},Xt.value.style.cursor="move")}),Xt.value.addEventListener("mousemove",s=>{if(e&&Wt){((e,t)=>{if(!Wt)return;const a=new O;a.setFromVector3(Wt.position.clone().sub(l)),a.theta-=.01*e,a.phi+=.01*t,a.phi=Math.max(.1,Math.min(Math.PI-.1,a.phi));const s=new E;s.setFromSpherical(a),s.add(l),Wt.position.copy(s),Wt.lookAt(l)})(s.clientX-a.x,s.clientY-a.y),a={x:s.clientX,y:s.clientY}}else if(t&&Wt){((e,t)=>{if(!Wt)return;const a=new E;Wt.getWorldDirection(a);const s=new E;s.crossVectors(a,Wt.up).normalize();const n=new E;n.crossVectors(s,a).normalize();const o=.01*Wt.position.distanceTo(l);l.add(s.multiplyScalar(-e*o)),l.add(n.multiplyScalar(t*o)),Wt.position.add(s.multiplyScalar(-e*o)),Wt.position.add(n.multiplyScalar(t*o)),Wt.lookAt(l)})(s.clientX-a.x,s.clientY-a.y),a={x:s.clientX,y:s.clientY}}}),Xt.value.addEventListener("mouseup",()=>{e=!1,t=!1,Xt.value.style.cursor="default"}),Xt.value.addEventListener("mouseleave",()=>{e=!1,t=!1,Xt.value.style.cursor="default"}),Xt.value.addEventListener("contextmenu",e=>{e.preventDefault()}),Xt.value.addEventListener("wheel",e=>{e.preventDefault();(e=>{if(!Wt)return;const t=new E;t.subVectors(Wt.position,l).normalize();const a=Wt.position.distanceTo(l),s=a+.1*e*a;s>=5&&s<=50&&(Wt.position.add(t.multiplyScalar(.1*e*a)),Wt.lookAt(l))})(e.deltaY>0?1:-1)})},Aa=()=>{xa=ma($.value,zt.value),Ca(),Ta()},za=()=>{Ca()},Fa=()=>{Wt&&ka&&(Wt.position.set(12,12,12),Wt.lookAt(0,0,0),ka&&ka.rotation.set(0,0,0))},Va=()=>{_t.value=!_t.value},Ta=()=>{_a(),Ia(),Ra(),Ea(),Ba()},_a=()=>{if(!va.value)return;const e=va.value.getContext("2d");if(!e)return;ya.smile?.destroy();const t=Qt.map(e=>(100*(e-1)).toFixed(0)+"%"),a=[{label:"1M",data:xa.map(e=>100*e[0]),borderColor:"#60a5fa",backgroundColor:"rgba(96,165,250,0.1)",tension:.4},{label:"6M",data:xa.map(e=>100*e[2]),borderColor:"#f59e0b",backgroundColor:"rgba(245,158,11,0.1)",tension:.4},{label:"2Y",data:xa.map(e=>100*e[4]),borderColor:"#ec4899",backgroundColor:"rgba(236,72,153,0.1)",tension:.4}];ya.smile=new w(e,{type:"line",data:{labels:t,datasets:a},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"rgba(255,255,255,0.6)"}},title:{display:!0,text:"Volatility Smile (by Tenor)",color:"rgba(255,255,255,0.6)",font:{size:12,weight:"bold"},padding:{bottom:10}}},scales:{x:{grid:{display:!1},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"Strike (%)",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}},y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"IV (%)",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}}}}})},Ia=()=>{if(!ba.value)return;const e=ba.value.getContext("2d");if(!e)return;ya.term?.destroy();const t=[{label:"ITM 80%",data:xa[1].map(e=>100*e),borderColor:"#4ade80",tension:.3},{label:"ATM",data:xa[4].map(e=>100*e),borderColor:"#fbbf24",tension:.3},{label:"OTM 120%",data:xa[7].map(e=>100*e),borderColor:"#f87171",tension:.3}];ya.term=new w(e,{type:"line",data:{labels:Jt,datasets:t},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"rgba(255,255,255,0.6)"}},title:{display:!0,text:"Term Structure (by Moneyness)",color:"rgba(255,255,255,0.6)",font:{size:12,weight:"bold"},padding:{bottom:10}}},scales:{x:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"Tenor",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}},y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"IV (%)",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}}}}})},Ra=()=>{if(!ha.value)return;const e=ha.value.getContext("2d");if(!e)return;ya.heatmap?.destroy();const t=[];for(let a=0;a<Qt.length;a++)for(let e=0;e<Jt.length;e++)t.push({x:e,y:a,v:100*xa[a][e]});ya.heatmap=new w(e,{type:"bubble",data:{datasets:[{label:"IV",data:t.map(e=>({x:e.x,y:e.y,r:e.v/2})),backgroundColor:t.map(e=>{const t=e.v;return t<10?"rgba(74,222,128,0.8)":t<15?"rgba(96,165,250,0.8)":t<20?"rgba(245,158,11,0.8)":"rgba(248,113,113,0.8)"})}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"2D Heatmap: Strike Ã— Tenor",color:"rgba(255,255,255,0.6)",font:{size:12,weight:"bold"},padding:{bottom:10}}},scales:{x:{min:-.5,max:5.5,grid:{display:!1},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10},callback:function(e){return Jt[e]||""}},title:{display:!0,text:"Tenor",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}},y:{min:-.5,max:8.5,grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10},callback:function(e){const t=Math.round(e);return t>=0&&t<Qt.length?(100*(Qt[t]-1)).toFixed(0)+"%":""}},title:{display:!0,text:"Strike (%)",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}}}}})},Ea=()=>{if(!ga.value)return;const e=ga.value.getContext("2d");if(!e)return;ya.vega?.destroy();const t=Qt.map(e=>(100*(e-1)).toFixed(0)+"%"),a=xa.map((e,t)=>{const a=Qt[t],l=e[2],s=(Math.log(1/a)+.5*l*l*.5)/(l*Math.sqrt(.5)),n=1/Math.sqrt(2*Math.PI)*Math.exp(-.5*s*s);return 1*Math.sqrt(.5)*n*100});ya.vega=new w(e,{type:"bar",data:{labels:t,datasets:[{label:"Vega (6M)",data:a,backgroundColor:"rgba(96,165,250,0.6)",borderColor:"#60a5fa",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Vega (by Strike & Tenor)",color:"rgba(255,255,255,0.6)",font:{size:12,weight:"bold"},padding:{bottom:10}}},scales:{x:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"Strike (%)",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}},y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"Vega",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}}}}})},Ba=()=>{if(!fa.value)return;const e=fa.value.getContext("2d");if(!e)return;ya.convexity?.destroy();const t=Qt.map(e=>(100*(e-1)).toFixed(0)+"%"),a=xa.map((e,t)=>{const a=t>0?xa[t-1][2]:e[2],l=t<Qt.length-1?xa[t+1][2]:e[2];return 1e4*(a-2*e[2]+l)});ya.convexity=new w(e,{type:"line",data:{labels:t,datasets:[{label:"Convexity",data:a,borderColor:"#ec4899",backgroundColor:"rgba(236,72,153,0.1)",tension:.3,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Volatility Convexity",color:"rgba(255,255,255,0.6)",font:{size:12,weight:"bold"},padding:{bottom:10}}},scales:{x:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"Strike (%)",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}},y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)",font:{size:10}},title:{display:!0,text:"Convexity",color:"rgba(255,255,255,0.6)",font:{size:11,weight:"bold"}}}}}})},Pa=async e=>{const t=e.target,a=t.files?.[0];if(a)try{const e=await a.arrayBuffer(),t=U(e,{type:"array"}),l=t.SheetNames[0],s=t.Sheets[l],n=X.sheet_to_json(s,{raw:!1}),o=[];for(const a of n){const e={instrument:a.Instrument||a.instrument||a["Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚"]||a.Symbol||a.symbol||"SPY",strike:parseFloat(a.Strike||a.strike||a["Ð¡Ñ‚Ñ€Ð°Ð¹Ðº"]||a.K||"1.0"),tenor:a.Tenor||a.tenor||a["Ð¡Ñ€Ð¾Ðº"]||a.Maturity||a.maturity||"1M",iv:parseFloat(a.IV||a.iv||a.Volatility||a.volatility||a["Ð’Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ"]||a["Ïƒ"]||"0.15")};e.instrument&&e.strike>0&&o.push(e)}Et.value=o,Bt.value=null}catch(l){console.error("Excel parsing error:",l),alert(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ñ„Ð°Ð¹Ð»Ð°: ${l.message}`)}},qa=async()=>{Pt.value=!0,setTimeout(()=>{Pt.value=!1},1e3)},Da=()=>{if(0===Et.value.length)return;const e=Et.value.map((e,t)=>({"â„–":t+1,"Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚":e.instrument||"",Strike:e.strike||0,"Ð¡Ñ€Ð¾Ðº":e.tenor||"","IV (%)":e.iv||0})),t=X.json_to_sheet(e),a=X.book_new();X.book_append_sheet(a,t,"Ð ÐµÐµÑÑ‚Ñ€ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ð¾Ð²");const l=(new Date).toISOString().split("T")[0];G(a,`Ñ€ÐµÐµÑÑ‚Ñ€_Ð¿Ð¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚Ð¸_Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸_${l}.xlsx`)},La=async()=>{if(0!==Et.value.length){qt.value=!0,Dt.value="";try{const e=await W(Et.value,"volatility_surface");e.success&&(Dt.value=`Ð ÐµÐµÑÑ‚Ñ€ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½: ${e.data.file_name}`,setTimeout(()=>{Dt.value=""},5e3))}catch(e){console.error("Error saving registry to parquet:",e),Dt.value=`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ð¸ Ñ€ÐµÐµÑÑ‚Ñ€Ð°: ${e.message}`}finally{qt.value=!1}}},Ya=()=>{Et.value=[],Bt.value=null,Rt.value&&(Rt.value.value="")};return a(async()=>{await l(),(()=>{if(!Xt.value)return;const e=Xt.value.clientWidth,t=Xt.value.clientHeight;Gt=new k,Gt.background=new C(988185),Wt=new M(75,e/t,.1,1e3),Wt.position.set(12,12,12),Wt.lookAt(0,0,0),$t=new S({canvas:Xt.value,antialias:!0,alpha:!0}),$t.setSize(e,t),$t.setPixelRatio(window.devicePixelRatio);const a=new A(16777215,.6);Gt.add(a);const l=new z(16777215,.8);l.position.set(10,15,10),Gt.add(l),Ca(),Sa();const s=()=>{Kt=requestAnimationFrame(s),_t.value&&Nt&&(Nt.rotation.y+=.003),$t?.render(Gt,Wt)};s()})(),Ta(),document.addEventListener("click",Ut)}),s(()=>{document.removeEventListener("click",Ut)}),s(()=>{Kt&&cancelAnimationFrame(Kt),Object.values(ya).forEach(e=>e?.destroy()),$t?.dispose()}),(e,t)=>(x(),n("div",N,[o("div",K,[t[10]||(t[10]=o("div",{class:"header-left"},[o("h1",{class:"page-title"},"ÐŸÐ¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚ÑŒ Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸"),o("p",{class:"page-subtitle"},"3D Ð¿Ð¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚ÑŒ Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸: Moneyness Ã— Ð¡Ñ€Ð¾Ðº Ã— IV")],-1)),o("div",J,[o("div",Q,[t[4]||(t[4]=o("label",{class:"control-label"},"Ð”Ð°Ñ‚Ð° Ð¾Ñ†ÐµÐ½ÐºÐ¸:",-1)),r(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>It.value=e),type:"date",class:"date-input",onChange:Aa},null,544),[[c,It.value]])]),o("div",Z,[t[5]||(t[5]=o("label",{class:"control-label"},"Ð ÐµÐµÑÑ‚Ñ€:",-1)),o("input",{type:"file",ref_key:"fileInputRef",ref:Rt,onChange:Pa,accept:".xlsx,.xls",style:{display:"none"},id:"excel-upload"},null,544),o("button",{onClick:t[1]||(t[1]=()=>{Rt.value&&Rt.value.click()}),class:"btn-secondary",title:"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ€ÐµÐµÑÑ‚Ñ€ Ð¸Ð· Excel"}," Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Excel ")]),o("div",ee,[r(o("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>Vt.value=e),onChange:za,id:"grid-check"},null,544),[[d,Vt.value]]),t[6]||(t[6]=o("label",{for:"grid-check"},"Ð¡ÐµÑ‚ÐºÐ°",-1))]),o("div",te,[r(o("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>Tt.value=e),onChange:za,id:"wire-check"},null,544),[[d,Tt.value]]),t[7]||(t[7]=o("label",{for:"wire-check"},"ÐšÐ°Ñ€ÐºÐ°Ñ",-1))]),o("button",{onClick:Va,class:"btn-primary"},u(_t.value?"â¸ Ð¡Ñ‚Ð¾Ð¿":"â–¶ Ð’Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ"),1),o("button",{onClick:Fa,class:"btn-secondary"},"â†º Ð¡Ð±Ñ€Ð¾Ñ"),o("div",ae,[t[9]||(t[9]=o("label",{class:"control-label"},"ÐœÐ¾Ð´ÐµÐ»ÑŒ:",-1)),o("div",{class:"custom-select-wrapper",onClick:Ot},[o("div",{class:p(["custom-select",{open:Ft.value}])},[o("div",le,[o("span",{class:p(["select-icon",Ht(zt.value)])},u(jt(zt.value)),3),o("span",se,u(Yt(zt.value)),1),t[8]||(t[8]=o("svg",{class:"select-arrow",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("polyline",{points:"6 9 12 15 18 9"})],-1))]),v(h,{name:"dropdown"},{default:b(()=>[Ft.value?(x(),n("div",ne,[(x(),n(g,null,f(Lt,e=>o("div",{key:e.value,class:p(["select-option",{selected:zt.value===e.value}]),onClick:y(t=>(e=>{zt.value=e,Ft.value=!1,Aa()})(e.value),["stop"])},[o("span",{class:p(["option-icon",e.iconClass])},u(e.icon),3),o("div",ie,[o("span",re,u(e.label),1),o("span",ce,u(e.description),1)]),zt.value===e.value?(x(),n("span",de,"âœ“")):i("",!0)],10,oe)),64))])):i("",!0)]),_:1})],2)])])])]),Dt.value?(x(),n("div",ue,[o("div",pe,u(Dt.value),1)])):i("",!0),Et.value.length>0?(x(),n("div",ve,[o("div",be,[o("div",null,[t[11]||(t[11]=o("h3",null,"Ð ÐµÐµÑÑ‚Ñ€ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ð¾Ð²",-1)),o("span",he,"Ð—Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ð¾Ð²: "+u(Et.value.length),1)]),o("div",ge,[o("button",{onClick:qa,class:"btn-secondary",disabled:Pt.value,style:{"font-size":"11px",padding:"6px 12px"}},[Pt.value?(x(),n("span",me,"â†º Ð¡Ñ‡Ð¸Ñ‚Ð°ÑŽ...")):(x(),n("span",ye,"Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð²ÑÐµ"))],8,fe),o("button",{onClick:Da,class:"btn-secondary",disabled:0===Et.value.length,style:{"font-size":"11px",padding:"6px 12px"},title:"Ð’Ñ‹Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ€ÐµÐµÑÑ‚Ñ€ Ð² Excel"}," ðŸ“¥ Ð’Ñ‹Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Excel ",8,xe),o("button",{onClick:La,class:"btn-secondary",disabled:0===Et.value.length||qt.value,style:{"font-size":"11px",padding:"6px 12px"},title:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ñ€ÐµÐµÑÑ‚Ñ€ Ð² Parquet"},[qt.value?(x(),n("span",Ce,"â†º Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...")):(x(),n("span",ke,"ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð² DB"))],8,we),o("button",{onClick:Ya,class:"btn-secondary",style:{"font-size":"11px",padding:"6px 12px",background:"rgba(239, 68, 68, 0.2)","border-color":"rgba(239, 68, 68, 0.3)"}}," âœ• ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ")])]),o("div",Me,[o("table",Se,[t[12]||(t[12]=o("thead",null,[o("tr",null,[o("th",null,"â„–"),o("th",null,"Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚"),o("th",null,"Strike"),o("th",null,"Ð¡Ñ€Ð¾Ðº"),o("th",null,"IV (%)"),o("th",null,"Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ")])],-1)),o("tbody",null,[(x(!0),n(g,null,f(Et.value,(e,t)=>(x(),n("tr",{key:t,class:p({selected:Bt.value===t}),onClick:e=>{return a=t,void(Bt.value=a);var a}},[o("td",null,u(t+1),1),o("td",null,u(e.instrument||"N/A"),1),o("td",ze,u(e.strike?e.strike.toFixed(2):"-"),1),o("td",Fe,u(e.tenor||"-"),1),o("td",Ve,u(e.iv?(100*e.iv).toFixed(2)+"%":"-"),1),o("td",null,[o("button",{onClick:y(e=>(e=>{const t=Et.value[e];t&&($.value=t.instrument.toLowerCase()||"spy",setTimeout(()=>{Aa()},100))})(t),["stop"]),class:"btn-small",title:"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð² Ñ„Ð¾Ñ€Ð¼Ñƒ"}," Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ",8,Te)])],10,Ae))),128))])])])])):i("",!0),o("div",_e,[o("canvas",{ref_key:"threeCanvas",ref:Xt,class:"three-canvas"},null,512),t[13]||(t[13]=o("div",{class:"controls-overlay"},[o("div",{class:"controls-hint"},[o("p",null,"ÐŸÐµÑ€ÐµÑ‚Ð°Ñ‰Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ | ÐŸÑ€Ð¾ÐºÑ€ÑƒÑ‚ÐºÐ° Ð´Ð»Ñ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð° | ÐŸÐšÐœ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ñ")])],-1))]),o("div",Ie,[o("div",Re,[t[15]||(t[15]=o("div",{class:"stat-header"},[o("h3",null,"ATM Volatility"),o("span",{class:"stat-unit"},"Ð’Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ATM")],-1)),o("div",Ee,u((100*ea.value).toFixed(2))+"%",1),o("div",Be,[t[14]||(t[14]=o("span",{class:"label"},"3M",-1)),o("span",Pe,u((100*ta.value).toFixed(2))+"%",1)])]),o("div",qe,[t[17]||(t[17]=o("div",{class:"stat-header"},[o("h3",null,"Skew (25 Delta)"),o("span",{class:"stat-unit"},"ÐÑÐ¸Ð¼Ð¼ÐµÑ‚Ñ€Ð¸Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ¸")],-1)),o("div",{class:p(["stat-value",aa.value>=0?"positive":"negative"])},u(aa.value>=0?"+":"")+u((100*aa.value).toFixed(2))+"% ",3),o("div",De,[t[16]||(t[16]=o("span",{class:"label"},"Put - Call",-1)),o("span",Le,u(la.value>=0?"+":"")+u((100*la.value).toFixed(1))+"%",1)])]),o("div",Ye,[t[19]||(t[19]=o("div",{class:"stat-header"},[o("h3",null,"Term Structure"),o("span",{class:"stat-unit"},"Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼")],-1)),o("div",je,u((100*sa.value).toFixed(2))+"% ",1),o("div",He,[t[18]||(t[18]=o("span",{class:"label"},"1M vs 12M",-1)),o("span",Oe,u(na.value),1)])]),o("div",Ue,[t[21]||(t[21]=o("div",{class:"stat-header"},[o("h3",null,"Vol of Vol"),o("span",{class:"stat-unit"},"Ð’Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸")],-1)),o("div",Xe,u((100*oa.value).toFixed(2))+"%",1),o("div",Ge,[t[20]||(t[20]=o("span",{class:"label"},"Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ",-1)),o("span",We,u((100*ia.value).toFixed(2))+"%",1)])])]),o("div",$e,[t[23]||(t[23]=o("div",{class:"card-header"},[o("h3",null,"Volatility Surface Matrix"),o("span",{class:"card-subtitle"},"Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° IV Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ð¹ÐºÐ°Ð¼ Ð¸ ÑÑ€Ð¾ÐºÐ°Ð¼")],-1)),o("div",Ne,[o("table",Ke,[o("thead",null,[o("tr",null,[t[22]||(t[22]=o("th",{class:"header-label"},"Strike / Ð¡Ñ€Ð¾Ðº",-1)),(x(),n(g,null,f(Jt,e=>o("th",{key:e},u(e),1)),64))])]),o("tbody",null,[(x(),n(g,null,f(Qt,e=>o("tr",{key:e},[o("td",Je,u((100*(e-1)).toFixed(0))+"%",1),(x(),n(g,null,f(Jt,t=>{return o("td",{key:t,class:"vol-cell",style:m({backgroundColor:(a=wa(e,t),a<.1?"rgba(74, 222, 128, 0.7)":a<.15?"rgba(96, 165, 250, 0.7)":a<.2?"rgba(245, 158, 11, 0.7)":a<.25?"rgba(248, 113, 113, 0.7)":"rgba(239, 68, 68, 0.7)")})},[o("span",Qe,u((100*wa(e,t)).toFixed(1))+"%",1)],4);var a}),64))])),64))])])])]),o("div",Ze,[o("div",et,[t[24]||(t[24]=o("div",{class:"chart-header"},[o("h3",null,"Volatility Smile (Ð¿Ð¾ ÑÑ€Ð¾ÐºÐ°Ð¼)"),o("span",{class:"chart-subtitle"},"ÐšÑ€Ð¸Ð²Ð°Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ¸ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÑ€Ð¾ÐºÐ¾Ð²")],-1)),o("div",tt,[o("canvas",{ref_key:"smileChartRef",ref:va},null,512)])]),o("div",at,[t[25]||(t[25]=o("div",{class:"chart-header"},[o("h3",null,"Term Structure (Ð¿Ð¾ Moneyness)"),o("span",{class:"chart-subtitle"},"Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÑ‚Ñ€Ð°Ð¹ÐºÐ¾Ð²")],-1)),o("div",lt,[o("canvas",{ref_key:"termChartRef",ref:ba},null,512)])])]),o("div",st,[t[26]||(t[26]=o("div",{class:"chart-header"},[o("h3",null,"2D Heatmap: Strike Ã— Ð¡Ñ€Ð¾Ðº"),o("span",{class:"chart-subtitle"},"Ð¢ÐµÐ¿Ð»Ð¾Ð²Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð° Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸")],-1)),o("div",nt,[o("canvas",{ref_key:"heatmapChartRef",ref:ha},null,512)])]),o("div",ot,[o("div",it,[t[27]||(t[27]=o("div",{class:"chart-header"},[o("h3",null,"Vega (Ð¿Ð¾ Strike Ð¸ ÑÑ€Ð¾ÐºÑƒ)"),o("span",{class:"chart-subtitle"},"Ð§ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ðº Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸")],-1)),o("div",rt,[o("canvas",{ref_key:"vegaChartRef",ref:ga},null,512)])]),o("div",ct,[t[28]||(t[28]=o("div",{class:"chart-header"},[o("h3",null,"Ð’Ñ‹Ð¿ÑƒÐºÐ»Ð¾ÑÑ‚ÑŒ Ð²Ð¾Ð»Ð°Ñ‚Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸"),o("span",{class:"chart-subtitle"},"ÐšÑ€Ð¸Ð²Ð¸Ð·Ð½Ð° Ð¿Ð¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚Ð¸")],-1)),o("div",dt,[o("canvas",{ref_key:"convexityChartRef",ref:fa},null,512)])])]),o("div",ut,[t[37]||(t[37]=o("div",{class:"card-header"},[o("h3",null,"Ð Ñ‹Ð½Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹"),o("span",{class:"card-subtitle"},"Ð¢ÐµÐºÑƒÑ‰Ð¸Ðµ Ñ€Ñ‹Ð½Ð¾Ñ‡Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ")],-1)),o("div",pt,[o("div",vt,[t[29]||(t[29]=o("span",{class:"label"},"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ",-1)),o("span",bt,u(ua.value),1)]),o("div",ht,[t[30]||(t[30]=o("span",{class:"label"},"Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ñ€Ñ‹Ð½ÐºÐ°",-1)),o("span",gt,u(pa.value),1)]),o("div",ft,[t[31]||(t[31]=o("span",{class:"label"},"Spot Price",-1)),o("span",yt,u(Zt.value),1)]),o("div",mt,[t[32]||(t[32]=o("span",{class:"label"},"Ð‘ÐµÐ·Ñ€Ð¸ÑÐºÐ¾Ð²Ð°Ñ ÑÑ‚Ð°Ð²ÐºÐ°",-1)),o("span",xt,u((100*ra.value).toFixed(2))+"%",1)]),o("div",wt,[t[33]||(t[33]=o("span",{class:"label"},"Ð”Ð¸Ð². Ð´Ð¾Ñ…Ð¾Ð´Ð½Ð¾ÑÑ‚ÑŒ",-1)),o("span",kt,u((100*ca.value).toFixed(2))+"%",1)]),o("div",Ct,[t[34]||(t[34]=o("span",{class:"label"},"Repo Rate",-1)),o("span",Mt,u((100*da.value).toFixed(2))+"%",1)]),o("div",St,[t[35]||(t[35]=o("span",{class:"label"},"ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð¿Ð¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚Ð¸",-1)),o("span",At,u(Yt(zt.value)),1)]),t[36]||(t[36]=o("div",{class:"info-item"},[o("span",{class:"label"},"ÐšÐ°Ð»Ð¸Ð±Ñ€Ð¾Ð²ÐºÐ°"),o("span",{class:"value"},"Least Squares + Regularization")],-1))])]),t[38]||(t[38]=o("div",{class:"page-footer"},[o("span",null,"â€¢ Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº: Bloomberg Terminal / Broker Data"),o("span",null,"â€¢ Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð°: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸"),o("span",null,"â€¢ ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ: 15Ñ Ð½Ð°Ð·Ð°Ð´")],-1))]))}}),[["__scopeId","data-v-de2ad5d5"]]);export{zt as default};
