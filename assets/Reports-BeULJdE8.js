const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/html2pdf-IR-in4O_.js","assets/index-Ba4DjugF.js","assets/vendor-DLyKmMu8.js","assets/index-DwGIjbya.css"])))=>i.map(i=>d[i]);
import{a,_ as e}from"./index-Ba4DjugF.js";import{r as l,d as s,v as t,c as i,e as n,P as o,j as c,t as r,n as v,f as u,F as d,i as p,C as m,q as b}from"./vendor-DLyKmMu8.js";import{u as h}from"./riskMetrics-CVOsIsgX.js";import{usePortfolioStore as f}from"./portfolio-t34lcnLk.js";const x={class:"page-container"},g={class:"section-header"},y={class:"header-actions"},w=["disabled"],k={key:0,class:"flex items-center gap-2"},R={key:1,class:"flex items-center gap-2"},C={class:"report-viewport custom-scroll"},V={id:"report-content",class:"a4-sheet"},F={class:"rep-header"},D={class:"rep-meta"},_={class:"rep-date"},M={class:"rep-hero"},P={class:"rep-tags"},j={class:"rep-tag"},E={class:"rep-tag"},$={class:"rep-section"},B={class:"sec-text"},T={class:"rep-meta-info"},A={class:"meta-row"},L={class:"meta-value"},S={class:"meta-row"},I={class:"meta-value"},z={class:"meta-row"},N={class:"meta-value"},O={class:"rep-section"},q={class:"metrics-grid"},Q={class:"metric-box"},U={class:"metric-box"},G={class:"m-value"},K={class:"metric-box"},Y={class:"m-value warning"},H={class:"metric-box"},J={class:"m-value"},W={class:"metric-box"},X={class:"m-value"},Z={class:"metric-box"},aa={class:"m-value warning"},ea={class:"metric-box"},la={class:"metric-box"},sa={class:"rep-section"},ta={class:"chart-container-print"},ia={viewBox:"0 0 600 200",class:"print-chart"},na=["x","y","height","fill"],oa=["x"],ca=["x","y"],ra={class:"rep-section"},va={class:"print-table"},ua={class:"text-red"},da={class:"text-red"},pa={key:0},ma={class:"rep-section"},ba={class:"portfolio-summary"},ha={class:"summary-stats"},fa={class:"stat-item"},xa={class:"stat-value"},ga={class:"stat-item"},ya={class:"stat-value"},wa={class:"stat-item"},ka={class:"stat-value"},Ra={class:"top-positions"},Ca={class:"positions-list"},Va={class:"pos-symbol"},Fa={class:"pos-weight"},Da={class:"pos-value"},_a=e(s({__name:"Reports",setup(e){const{exportToPdf:s,isExporting:_a}=function(){const e=l(!1);return{exportToPdf:async(l,s="report.pdf")=>{e.value=!0;try{const e=await a(()=>import("./html2pdf-IR-in4O_.js").then(a=>a.h),__vite__mapDeps([0,1,2,3])),t=e.default||e,i=document.getElementById(l);if(!i)throw new Error(`Element #${l} not found`);const n={margin:[10,10,10,10],filename:s,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,backgroundColor:"#0f172a"},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await t().set(n).from(i).save()}catch(t){console.error("PDF Export Error:",t),alert("Ошибка экспорта PDF. Убедитесь, что html2pdf.js установлен (npm install html2pdf.js)")}finally{e.value=!1}},isExporting:e}}(),Ma=h(),Pa=f(),ja=t(()=>(new Date).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})),Ea=t(()=>Ma.totalEquity),$a=t(()=>Ma.var95),Ba=t(()=>Ma.cvar95),Ta=t(()=>Ma.sharpeRatio),Aa=t(()=>Ma.portfolioBeta),La=t(()=>Ma.expectedReturn),Sa=t(()=>Ma.volatility),Ia=t(()=>Ma.maxDrawdown),za=t(()=>Ma.riskContributions),Na=t(()=>Pa.positions),Oa=t(()=>Pa.selectedBank),qa=a=>"₽"+Math.abs(a).toLocaleString("ru-RU",{maximumFractionDigits:0}),Qa=(a,e=2)=>(100*a).toFixed(e)+"%",Ua=t(()=>0===La.value?.125:.5*La.value),Ga=t(()=>{const a=za.value;return 0===a.length?[{symbol:"TSLA",name:"Tesla Inc",weight:5.2,volatility:45.2,varContribution:12.4},{symbol:"NVDA",name:"Nvidia Corp",weight:4.8,volatility:38.1,varContribution:10.1},{symbol:"BTC",name:"Bitcoin",weight:2.1,volatility:55,varContribution:8.5}]:a.slice(0,5).map(a=>{const e=Na.value.find(e=>e.symbol===a.symbol),l=a.contribution>0&&a.weight>0?a.contribution/(Ea.value*a.weight/100)*100:20+30*Math.random();return{symbol:a.symbol,name:e?.name||a.symbol,weight:a.weight,volatility:l,varContribution:a.percentRisk}})}),Ka=t(()=>{const a=za.value.slice(0,5),e=a.length>0?Math.max(...a.map(a=>a.percentRisk)):50;return 0===a.length?[{label:"Tech",value:40,maxValue:50,color:"#3b82f6"},{label:"Fin",value:30,maxValue:50,color:"#8b5cf6"},{label:"Gold",value:15,maxValue:50,color:"#fbbf24"},{label:"Bonds",value:10,maxValue:50,color:"#ef4444"},{label:"Energy",value:5,maxValue:50,color:"#10b981"}]:a.map((a,l)=>{const s=["#3b82f6","#8b5cf6","#fbbf24","#ef4444","#10b981"];return{label:a.symbol,value:a.percentRisk,maxValue:e,color:a.color||s[l%s.length]}})}),Ya=t(()=>{const a=Math.abs($a.value)/Ea.value*100,e=100*Sa.value,l=Ta.value;let s="умеренную";return e>20&&(s="повышенную"),e>30&&(s="высокую"),e<10&&(s="низкую"),`Портфель демонстрирует ${s} волатильность (${e.toFixed(1)}%) в текущем рыночном режиме. Показатель Value-at-Risk (95%) составляет ${Qa(Math.abs($a.value)/Ea.value)}, что ${a<2.5?"остается в пределах установленных лимитов":"превышает рекомендуемые пороги"}. Коэффициент Шарпа ${l.toFixed(2)} ${l>1.5?"указывает на эффективное управление рисками":l>1?"свидетельствует о приемлемом соотношении доходности и риска":"требует внимания к структуре портфеля"}. Максимальная просадка ${Qa(Ia.value)} ${Ia.value<.15?"находится в допустимых пределах":"превышает рекомендуемые значения"}.`}),Ha=()=>{s("report-content",`PortfolioReport_${Oa.value.name.replace(/\s+/g,"_")}_${(new Date).toISOString().slice(0,10)}.pdf`)};return(a,e)=>(b(),i("div",x,[n("div",g,[e[2]||(e[2]=n("div",{class:"header-left"},[n("h1",{class:"section-title"},"Аналитические отчеты"),n("p",{class:"section-subtitle"},"Генерация PDF-сводки по состоянию портфеля")],-1)),n("div",y,[n("button",{class:"btn-glass primary",onClick:Ha,disabled:o(_a)},[o(_a)?(b(),i("span",k,[...e[0]||(e[0]=[n("span",{class:"spinner-mini"},null,-1),c(" Генерация... ",-1)])])):(b(),i("span",R,[...e[1]||(e[1]=[n("span",null,"Скачать PDF",-1),n("svg",{width:"14",height:"14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]))],8,w)])]),n("div",C,[n("div",V,[n("div",F,[e[4]||(e[4]=n("div",{class:"rep-logo"},[n("div",{class:"logo-icon"},"RK"),n("span",null,[c("Quant"),n("span",{class:"text-accent"},"Risk")])],-1)),n("div",D,[e[3]||(e[3]=n("div",{class:"rep-label"},"ДАТА ОТЧЕТА",-1)),n("div",_,r(ja.value),1)])]),e[33]||(e[33]=n("div",{class:"rep-divider"},null,-1)),n("div",M,[e[6]||(e[6]=n("h2",{class:"rep-main-title"},"Отчет по оптимизации портфеля",-1)),n("div",P,[n("span",j,r(Oa.value.name),1),e[5]||(e[5]=n("span",{class:"rep-tag"},"Risk Analysis",-1)),n("span",E,r(Na.value.length)+" Assets",1)])]),n("section",$,[e[10]||(e[10]=n("h3",{class:"sec-title"},"1. Краткое резюме",-1)),n("p",B,r(Ya.value),1),n("div",T,[n("div",A,[e[7]||(e[7]=n("span",{class:"meta-label"},"Банк:",-1)),n("span",L,r(Oa.value.name),1)]),n("div",S,[e[8]||(e[8]=n("span",{class:"meta-label"},"Активов в портфеле:",-1)),n("span",I,r(Na.value.length),1)]),n("div",z,[e[9]||(e[9]=n("span",{class:"meta-label"},"Стоимость портфеля:",-1)),n("span",N,r(qa(Ea.value)),1)])])]),n("section",O,[e[19]||(e[19]=n("h3",{class:"sec-title"},"2. Ключевые метрики",-1)),n("div",q,[n("div",Q,[e[11]||(e[11]=n("span",{class:"m-label"},"Ожидаемая доходность (годовая)",-1)),n("span",{class:v(["m-value",La.value>=0?"positive":"negative"])},r(La.value>=0?"+":"")+r(Qa(La.value)),3)]),n("div",U,[e[12]||(e[12]=n("span",{class:"m-label"},"Коэффициент Шарпа",-1)),n("span",G,r(Ta.value.toFixed(2)),1)]),n("div",K,[e[13]||(e[13]=n("span",{class:"m-label"},"VaR (95%, 1d)",-1)),n("span",Y,r(Ea.value>0?Qa(Math.abs($a.value)/Ea.value):"0.00%"),1)]),n("div",H,[e[14]||(e[14]=n("span",{class:"m-label"},"Beta (β)",-1)),n("span",J,r(Aa.value.toFixed(2)),1)]),n("div",W,[e[15]||(e[15]=n("span",{class:"m-label"},"Волатильность (годовая)",-1)),n("span",X,r(Qa(Sa.value)),1)]),n("div",Z,[e[16]||(e[16]=n("span",{class:"m-label"},"CVaR (95%, 1d)",-1)),n("span",aa,r(Ea.value>0?Qa(Math.abs(Ba.value)/Ea.value):"0.00%"),1)]),n("div",ea,[e[17]||(e[17]=n("span",{class:"m-label"},"Макс. просадка",-1)),n("span",{class:v(["m-value",Ia.value<.15?"positive":"warning"])},r(Qa(Ia.value)),3)]),n("div",la,[e[18]||(e[18]=n("span",{class:"m-label"},"P&L (YTD, оценка)",-1)),n("span",{class:v(["m-value",Ua.value>=0?"positive":"negative"])},r(Ua.value>=0?"+":"")+r(Qa(Ua.value)),3)])])]),n("section",sa,[e[24]||(e[24]=n("h3",{class:"sec-title"},"3. Структура риска (Risk Contribution)",-1)),n("div",ta,[(b(),i("svg",ia,[e[21]||(e[21]=n("line",{x1:"0",y1:"150",x2:"600",y2:"150",stroke:"rgba(255,255,255,0.1)","stroke-width":"1"},null,-1)),e[22]||(e[22]=n("line",{x1:"0",y1:"100",x2:"600",y2:"100",stroke:"rgba(255,255,255,0.1)","stroke-width":"1"},null,-1)),e[23]||(e[23]=n("line",{x1:"0",y1:"50",x2:"600",y2:"50",stroke:"rgba(255,255,255,0.1)","stroke-width":"1"},null,-1)),(b(!0),i(d,null,p(Ka.value,(a,e)=>(b(),i(d,{key:e},[n("rect",{x:50+100*e,y:150-a.value/a.maxValue*100,width:"60",height:a.value/a.maxValue*100,fill:a.color,rx:"2"},null,8,na),n("text",{x:80+100*e,y:"170",fill:"#94a3b8","font-size":"9","text-anchor":"middle"},r(a.label),9,oa),n("text",{x:80+100*e,y:145-a.value/a.maxValue*100,fill:"#fff","font-size":"8","text-anchor":"middle","font-weight":"600"},r(a.value.toFixed(1))+"% ",9,ca)],64))),128)),0===Ka.value.length?(b(),i(d,{key:0},[e[20]||(e[20]=m('<rect x="50" y="80" width="60" height="70" fill="#3b82f6" rx="2" data-v-9b1fcf34></rect><rect x="150" y="40" width="60" height="110" fill="#8b5cf6" rx="2" data-v-9b1fcf34></rect><rect x="250" y="100" width="60" height="50" fill="#fbbf24" rx="2" data-v-9b1fcf34></rect><rect x="350" y="60" width="60" height="90" fill="#ef4444" rx="2" data-v-9b1fcf34></rect><rect x="450" y="90" width="60" height="60" fill="#10b981" rx="2" data-v-9b1fcf34></rect><text x="80" y="170" fill="#94a3b8" font-size="10" text-anchor="middle" data-v-9b1fcf34>N/A</text>',6))],64)):u("",!0)]))])]),n("section",ra,[e[27]||(e[27]=n("h3",{class:"sec-title"},"4. Топ-5 активов по вкладу в риск (Marginal VaR)",-1)),n("table",va,[e[26]||(e[26]=n("thead",null,[n("tr",null,[n("th",null,"Актив"),n("th",null,"Вес"),n("th",null,"Вклад в VaR"),n("th",null,"% от общего риска")])],-1)),n("tbody",null,[(b(!0),i(d,null,p(Ga.value,(a,e)=>(b(),i("tr",{key:e},[n("td",null,r(a.symbol)+" ("+r(a.name)+")",1),n("td",null,r(a.weight.toFixed(1))+"%",1),n("td",ua,r(qa(za.value.find(e=>e.symbol===a.symbol)?.contribution||0)),1),n("td",da,r(a.varContribution.toFixed(1))+"%",1)]))),128)),0===Ga.value.length?(b(),i("tr",pa,[...e[25]||(e[25]=[n("td",{colspan:"4",style:{"text-align":"center",color:"rgba(255,255,255,0.5)"}}," Данные оптимизации недоступны. Выполните оптимизацию в разделе CCMV Optimization. ",-1)])])):u("",!0)])])]),n("section",ma,[e[32]||(e[32]=n("h3",{class:"sec-title"},"5. Состав портфеля",-1)),n("div",ba,[n("div",ha,[n("div",fa,[e[28]||(e[28]=n("span",{class:"stat-label"},"Всего активов:",-1)),n("span",xa,r(Na.value.length),1)]),n("div",ga,[e[29]||(e[29]=n("span",{class:"stat-label"},"Стоимость портфеля:",-1)),n("span",ya,r(qa(Ea.value)),1)]),n("div",wa,[e[30]||(e[30]=n("span",{class:"stat-label"},"Средний вес актива:",-1)),n("span",ka,r(Na.value.length>0?(100/Na.value.length).toFixed(1):0)+"%",1)])]),n("div",Ra,[e[31]||(e[31]=n("div",{class:"positions-label"},"Топ-5 позиций по весу:",-1)),n("div",Ca,[(b(!0),i(d,null,p(Na.value.slice(0,5),(a,e)=>(b(),i("div",{key:a.symbol,class:"position-item"},[n("span",Va,r(a.symbol),1),n("span",Fa,r(a.allocation)+"%",1),n("span",Da,r(qa(a.notional)),1)]))),128))])])])]),e[34]||(e[34]=n("div",{class:"rep-footer"},[n("div",{class:"footer-line"}),n("div",{class:"footer-info"},[n("span",null,"© 2026 QuantRisk Analytics. Confidential."),n("span",null,"Page 1 of 1")])],-1))])])]))}}),[["__scopeId","data-v-9b1fcf34"]]);export{_a as default};
