import{d as a,v as s,r as e,c as l,e as t,t as i,x as c,y as n,L as d,f as r,j as o,P as v,F as p,i as u,k as b,n as m,C as g,q as h}from"./vendor-DLyKmMu8.js";import{u as x,_ as k}from"./index-BaahR4yN.js";import{u as f}from"./riskMetrics-CVOsIsgX.js";import{usePortfolioStore as w}from"./portfolio-t34lcnLk.js";const y={class:"page-container"},R={class:"section-header"},M={class:"header-actions"},F={class:"glass-pill control-pill"},P={class:"text-white font-bold"},T={class:"glass-pill control-pill"},V={class:"scrub-wrapper"},B={class:"glass-pill control-pill"},S=["disabled"],C={key:0,width:"14",height:"14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},L={key:1,class:"spinner-mini"},j={key:2},I={class:"kpi-cards-grid"},$={class:"glass-card kpi-card"},D={class:"kpi-label"},E={class:"kpi-value text-red"},U={class:"kpi-sub"},_={class:"text-white font-bold"},X={class:"glass-card kpi-card"},A={class:"kpi-value text-orange"},O={class:"glass-card kpi-card"},Q={class:"kpi-value text-gradient-blue"},q={class:"glass-card kpi-card"},G={class:"kpi-value text-gradient-green"},H={class:"kpi-sub"},Y={class:"text-white"},N={class:"dashboard-grid"},z={class:"col-left"},J={class:"glass-card panel"},K={class:"risk-table-wrapper"},W={class:"glass-table risk-decomposition-table"},Z={class:"text-left"},aa={class:"asset-row"},sa={class:"sym"},ea={class:"text-right mono"},la={class:"text-right mono text-red"},ta={class:"text-right"},ia={class:"bar-cell"},ca={class:"progress-bar"},na={class:"mono bar-val"},da={class:"glass-card panel"},ra={class:"panel-header"},oa=["disabled"],va={class:"stress-list"},pa={class:"stress-info"},ua={class:"stress-name"},ba={class:"stress-desc"},ma={class:"stress-result"},ga={class:"glass-card panel"},ha={class:"correlation-matrix-wrapper"},xa={class:"correlation-matrix-grid"},ka=["title"],fa=["title"],wa=["title"],ya={class:"col-right"},Ra={class:"glass-card panel"},Ma={class:"factor-list"},Fa={class:"lbl-group"},Pa={class:"lbl"},Ta={class:"sub-lbl"},Va={class:"val-group"},Ba={class:"glass-card panel"},Sa={class:"metrics-kv-list"},Ca={class:"kv-row"},La={class:"v text-red font-bold"},ja=k(a({__name:"GreekParameters",setup(a){x();const k=f(),ja=w(),Ia=s(()=>ja.selectedBank),$a=e("1d"),Da=e(!1),Ea=e(!1),Ua=e((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),_a=e(99),Xa=s(()=>{const a=k.var99,s=k.var95;if(0===a&&0===s){return-67500*((1.645+(_a.value-95)/4*.685)/2.33)}if(_a.value<=95)return s;if(_a.value>=99)return a;return s+(a-s)*((_a.value-95)/4)}),Aa=s(()=>{const a=k.riskContributions;return a.length>0?a:[{symbol:"SPY",weight:40,contribution:27e3,percentRisk:45,color:"#3b82f6"},{symbol:"QQQ",weight:30,contribution:21e3,percentRisk:35,color:"#8b5cf6"},{symbol:"GLD",weight:15,contribution:4500,percentRisk:7.5,color:"#fbbf24"},{symbol:"TLT",weight:15,contribution:7500,percentRisk:12.5,color:"#ef4444"}]}),Oa=e([{id:1,name:"Финансовый Кризис 2008",description:"Рыночный крах (повтор)",impact:-452e3,impactPct:-.25},{id:2,name:"Скачок Инфляции",description:"Рост ставок +200 б.п.",impact:-125e3,impactPct:-.07},{id:3,name:"Падение Нефти",description:"Нефть Brent < ₽40",impact:-35e3,impactPct:-.02},{id:4,name:"Рост Волатильности",description:"VIX > 40",impact:-85e3,impactPct:-.045}]),Qa=s(()=>[{name:"Рыночный риск",index:"IMOEX",beta:k.portfolioBeta},{name:"Процентные ставки",index:"RU 10Y",beta:-.42},{name:"Momentum",index:"MTUM ETF",beta:.25},{name:"Волатильность",index:"RTSVIX",beta:-.65},{name:"Сырье",index:"BCOM Index",beta:.12}]),qa=a=>{const s=[];for(let e=0;e<a;e++){const l=[];for(let s=0;s<a;s++)if(e===s)l.push(1);else{const t=(e*a+s)%100/100*2-1,i=Math.max(-.8,Math.min(.95,t));l.push(parseFloat(i.toFixed(2)))}s.push(l)}for(let e=0;e<a;e++)for(let l=e+1;l<a;l++)s[l][e]=s[e][l];return s},Ga=s(()=>{const a=ja.positions.map(a=>a.symbol).slice(0,10);for(;a.length<10;)a.push(`Asset${a.length+1}`);return a}),Ha=s(()=>{const a=ja.correlationMatrix;if(!a||0===a.length)return qa(10);const s=a.slice(0,10).map(a=>a.values.slice(0,10));if(s.length<10){const a=qa(10);for(let e=s.length;e<10;e++)s.push(a[e])}return s.map(a=>{const s=[...a];for(;s.length<10;)s.push(0);return s.slice(0,10)})}),Ya=a=>"₽"+Math.abs(a).toLocaleString("ru-RU",{maximumFractionDigits:0}),Na=a=>{let s="rgba(255,255,255,0.02)",e="rgba(255,255,255,0.6)";if(1===a)s="rgba(255,255,255,0.1)",e="#fff";else if(a>0){s=`rgba(59, 130, 246, ${.6*a})`,e="#fff"}else if(a<0){s=`rgba(239, 68, 68, ${.6*Math.abs(a)})`,e="#fff"}return{background:s,color:e}},za=async()=>{if(!Da.value){Da.value=!0;try{await new Promise(a=>setTimeout(a,800)),Ua.value=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}finally{Da.value=!1}}},Ja=async()=>{if(!Ea.value){Ea.value=!0;try{await new Promise(a=>setTimeout(a,1200))}finally{Ea.value=!1}}};return(a,s)=>(h(),l("div",y,[t("div",R,[s[8]||(s[8]=t("div",{class:"header-left"},[t("h1",{class:"section-title"},"Риск-метрики"),t("p",{class:"section-subtitle"},"VaR, Стресс-тесты и Факторный анализ")],-1)),t("div",M,[t("div",F,[s[2]||(s[2]=t("span",{class:"lbl-mini"},"Банк:",-1)),t("span",P,i(Ia.value.name),1)]),t("div",T,[s[4]||(s[4]=t("span",{class:"lbl-mini"},"Доверие:",-1)),t("div",V,[c(t("input",{type:"number","onUpdate:modelValue":s[0]||(s[0]=a=>_a.value=a),class:"scrub-input text-accent",step:"0.1",min:"90",max:"99.9"},null,512),[[n,_a.value,void 0,{number:!0}]]),s[3]||(s[3]=t("span",{class:"text-accent"},"%",-1))])]),t("div",B,[s[6]||(s[6]=t("span",{class:"lbl-mini"},"Горизонт:",-1)),c(t("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>$a.value=a),class:"glass-select-clean"},[...s[5]||(s[5]=[t("option",{value:"1d"},"1 день",-1),t("option",{value:"10d"},"10 дней",-1),t("option",{value:"1m"},"1 месяц",-1)])],512),[[d,$a.value]])]),t("button",{class:"btn-glass primary",onClick:za,disabled:Da.value},[Da.value?(h(),l("span",L)):(h(),l("svg",C,[...s[7]||(s[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])),Da.value?r("",!0):(h(),l("span",j,"Обновить"))],8,S)])]),t("div",I,[t("div",$,[t("div",D,"VaR "+i(_a.value)+"% (Value at Risk)",1),t("div",E,i(Ya(Xa.value)),1),t("div",U,[s[9]||(s[9]=t("span",{class:"text-muted"},"Риск/Капитал:",-1)),s[10]||(s[10]=o()),t("span",_,i((Math.abs(Xa.value)/v(k).totalEquity*100).toFixed(2))+"%",1)])]),t("div",X,[s[11]||(s[11]=t("div",{class:"kpi-label"},"Expected Shortfall (CVaR)",-1)),t("div",A,i(Ya(_a.value>=99?v(k).cvar99:v(k).cvar95)),1),s[12]||(s[12]=t("div",{class:"kpi-sub"},[t("span",{class:"text-muted"},"Средний убыток в хвосте")],-1))]),t("div",O,[s[13]||(s[13]=t("div",{class:"kpi-label"},"Бэта портфеля (β)",-1)),t("div",Q,i(v(k).portfolioBeta.toFixed(2)),1),s[14]||(s[14]=t("div",{class:"kpi-sub"},[t("span",{class:"text-muted"},"vs IMOEX")],-1))]),t("div",q,[s[17]||(s[17]=t("div",{class:"kpi-label"},"Коэффициент Шарпа",-1)),t("div",G,i(v(k).sharpeRatio.toFixed(2)),1),t("div",H,[s[15]||(s[15]=t("span",{class:"text-muted"},"Sortino:",-1)),s[16]||(s[16]=o()),t("span",Y,i(v(k).calculateSortinoRatio(v(k).expectedReturn,v(k).volatility).toFixed(2)),1)])])]),t("div",N,[t("div",z,[t("div",J,[s[19]||(s[19]=t("div",{class:"panel-header"},[t("h3",null,"Декомпозиция рисков"),t("div",{class:"badge-glass"},"Marginal VaR")],-1)),t("div",K,[t("table",W,[s[18]||(s[18]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Актив"),t("th",{class:"text-right"},"Вес"),t("th",{class:"text-right"},"Вклад в риск"),t("th",{class:"text-right"},"% Риска")])],-1)),t("tbody",null,[(h(!0),l(p,null,u(Aa.value,a=>(h(),l("tr",{key:a.symbol},[t("td",Z,[t("div",aa,[t("span",{class:"dot",style:b({background:a.color})},null,4),t("span",sa,i(a.symbol),1)])]),t("td",ea,i(a.weight)+"%",1),t("td",la,"₽"+i((a.contribution/1e3).toFixed(1))+"k",1),t("td",ta,[t("div",ia,[t("div",ca,[t("div",{class:"progress-fill",style:b({width:a.percentRisk+"%"})},null,4)]),t("span",na,i(a.percentRisk)+"%",1)])])]))),128))])])])]),t("div",da,[t("div",ra,[s[20]||(s[20]=t("h3",null,"Стресс-тестирование",-1)),t("button",{onClick:Ja,class:"btn-xs-glass",disabled:Ea.value},i(Ea.value?"Выполняется...":"Запустить"),9,oa)]),t("div",va,[(h(!0),l(p,null,u(Oa.value,a=>(h(),l("div",{key:a.id,class:"stress-item"},[t("div",pa,[t("span",ua,i(a.name),1),t("span",ba,i(a.description),1)]),t("div",ma,[t("span",{class:m(["stress-val",a.impact>0?"text-green":"text-red"])},i(a.impact>0?"+":"")+i(Ya(a.impact)),3),t("span",{class:m(["stress-pct",a.impactPct>0?"text-green":"text-red"])},i(a.impactPct>0?"+":"")+i((100*a.impactPct).toFixed(2))+"% ",3)])]))),128))])]),t("div",ga,[s[22]||(s[22]=t("div",{class:"panel-header"},[t("h3",null,"Матрица корреляций"),t("div",{class:"legend"},[t("span",{class:"dot-legend bg-blue"}),o(" Поз "),t("span",{class:"dot-legend bg-red"}),o(" Нег ")])],-1)),t("div",ha,[t("div",xa,[s[21]||(s[21]=t("div",{class:"matrix-cell empty"},null,-1)),(h(!0),l(p,null,u(Ga.value.slice(0,10),a=>(h(),l("div",{key:a,class:"matrix-cell header",title:a},i(a.length>6?a.substring(0,6)+"...":a),9,ka))),128)),(h(!0),l(p,null,u(Ha.value.slice(0,10),(a,s)=>(h(),l(p,{key:"row-"+s},[t("div",{class:"matrix-cell header",title:Ga.value[s]},i(Ga.value[s]&&Ga.value[s].length>6?Ga.value[s].substring(0,6)+"...":Ga.value[s]||""),9,fa),(h(!0),l(p,null,u(a.slice(0,10),(a,e)=>(h(),l("div",{key:s+"-"+e,class:"matrix-cell value",style:b(Na(a)),title:`${Ga.value[s]} vs ${Ga.value[e]}: ${a.toFixed(3)}`},i(a.toFixed(2)),13,wa))),128))],64))),128))])])])]),t("div",ya,[t("div",Ra,[s[23]||(s[23]=t("div",{class:"panel-header"},[t("h3",null,"Факторный Анализ (Beta)")],-1)),t("div",Ma,[(h(!0),l(p,null,u(Qa.value,a=>{return h(),l("div",{class:"list-row",key:a.name},[t("div",Fa,[t("span",Pa,i(a.name),1),t("span",Ta,i(a.index),1)]),t("div",Va,[t("span",{class:m(["val",(s=a.beta,Math.abs(s)>.5?"font-bold text-white":"text-muted")])},i(a.beta>0?"+":"")+i(a.beta.toFixed(2)),3)])]);var s}),128))])]),t("div",Ba,[s[27]||(s[27]=t("div",{class:"panel-header"},[t("h3",null,"Анализ Просадок")],-1)),t("div",Sa,[s[25]||(s[25]=t("div",{class:"kv-row"},[t("span",{class:"k"},"Текущая просадка"),t("span",{class:"v text-red"},"-3.45%")],-1)),t("div",Ca,[s[24]||(s[24]=t("span",{class:"k"},"Макс. просадка",-1)),t("span",La,i((100*v(k).maxDrawdown).toFixed(2))+"%",1)]),s[26]||(s[26]=g('<div class="kv-row" data-v-a5cb61d3><span class="k" data-v-a5cb61d3>Дней в просадке</span><span class="v" data-v-a5cb61d3>14 дней</span></div><div class="kv-row" data-v-a5cb61d3><span class="k" data-v-a5cb61d3>Фактор восстановления</span><span class="v text-green" data-v-a5cb61d3>3.2x</span></div>',2))])]),s[28]||(s[28]=g('<div class="glass-card panel" data-v-a5cb61d3><div class="panel-header" data-v-a5cb61d3><h3 data-v-a5cb61d3>Ликвидность</h3></div><div class="metrics-kv-list" data-v-a5cb61d3><div class="kv-row" data-v-a5cb61d3><span class="k" data-v-a5cb61d3>Дней до ликвидации (95%)</span><span class="v" data-v-a5cb61d3>1.2 дня</span></div><div class="kv-row" data-v-a5cb61d3><span class="k" data-v-a5cb61d3>Стоимость спреда Bid-Ask</span><span class="v text-orange" data-v-a5cb61d3>0.08%</span></div></div></div>',1))])])]))}}),[["__scopeId","data-v-a5cb61d3"]]);export{ja as default};
