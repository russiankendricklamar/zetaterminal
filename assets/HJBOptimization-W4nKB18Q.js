import{v as a,r as e,a as t,b as l,G as s,d as n,o,A as r,c as i,q as c,e as d,f as u,j as m,t as p,P as h,x as v,y as g,F as y,i as f,k as b,n as x,C as w,a2 as k}from"./vendor-DLyKmMu8.js";import{usePortfolioStore as M}from"./portfolio-t34lcnLk.js";import{u as P}from"./riskMetrics-CVOsIsgX.js";import{g as j}from"./apiHeaders-DCeXWvJ_.js";import{e as F,L as C,b as R,B as D,h as z,S as _,P as A,W as T,A as H,M as S,O as V,G as q,d as Y,f as B}from"./three.module-7SAW-liO.js";import{O as E}from"./OrbitControls-CXwf_Mcn.js";import{_ as I}from"./index-AoYxWDki.js";function O(){const t=M(),l=P(),s=a(()=>t.positions),n=a(()=>t.correlationMatrix),o=e(!1),r=e(null),i=e({gamma:2,horizon:1,riskFreeRate:.045,marketVol:.18,expectedReturn:.1,monteCarloTrajectories:1e4}),c=a(()=>{const{expectedReturn:a,riskFreeRate:e,gamma:t,marketVol:l}=i.value,s=(a-e)/(t*l*l);return Math.max(0,Math.min(s,2))}),d=a(()=>{const a=c.value,{expectedReturn:e,riskFreeRate:t}=i.value;return t+a*(e-t)}),u=a(()=>c.value*i.value.marketVol),m=a(()=>{const{expectedReturn:a,riskFreeRate:e,marketVol:t}=i.value;return(a-e)/t}),p=a(()=>{const{gamma:a}=i.value,e=d.value-i.value.riskFreeRate,t=u.value*u.value;return i.value.riskFreeRate+e-.5*a*t}),h=a(()=>Math.round(252*i.value.horizon)),v=a(()=>s.value.map(a=>({symbol:a.symbol,name:a.name,garchVol:15+20*Math.random(),passed:!0})).filter(a=>a.garchVol<=30).sort((a,e)=>a.garchVol-e.garchVol)),g=a(()=>v.value.length),y=a(()=>s.value.map(a=>{const e=.05+.15*Math.random(),t=.02+.08*Math.random();return{symbol:a.symbol,name:a.name,color:a.color,historicalYield:e,dividendYield:t,totalYield:e+t}}).sort((a,e)=>e.totalYield-a.totalYield)),f=a(()=>0===y.value.length?0:y.value.reduce((a,e)=>a+e.historicalYield,0)/y.value.length),b=a(()=>0===y.value.length?0:y.value.reduce((a,e)=>a+e.dividendYield,0)/y.value.length),x=a(()=>0===y.value.length?0:y.value.reduce((a,e)=>a+e.totalYield,0)/y.value.length);return{hjbParams:i,hjbOptimalAllocation:c,hjbExpectedPortfolioReturn:d,hjbPortfolioVol:u,hjbSharpeRatio:m,hjbCertaintyEquivalent:p,hjbOptimizationResult:r,isComputing:o,trajectoriesDays:h,runHJBOptimization:async(a,e)=>{o.value=!0;try{const t=s.value,o=t.length,c=t.map(a=>{const e=252*(a.dayChange/100);return Math.max(.01,.05+e)}),d=n.value,u=t.map(()=>.2),m=[];for(let a=0;a<o;a++){const e=[];for(let t=0;t<o;t++){const l=(d[a]?.values[t]||(a===t?1:0))*u[a]*u[t];e.push(l)}m.push(e)}const p={initial_capital:1e6,horizon_years:i.value.horizon,n_paths:i.value.monteCarloTrajectories,n_steps:h.value,random_seed:42},v=await(async a=>{try{const e=await fetch("   https://stochastic-dashbord-v1-production.up.railway.app/api/hjb/optimize",{method:"POST",headers:j(),body:JSON.stringify(a)});if(!e.ok){const a=await e.json().catch(()=>({detail:"Unknown error"}));throw new Error(a.detail||`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){throw console.error("HJB Optimization Failed:",e),e}})({mu:c,cov_matrix:m,risk_free_rate:i.value.riskFreeRate,gamma:i.value.gamma,asset_names:t.map(a=>a.symbol),monte_carlo:p});r.value=v,v.monte_carlo&&e&&e(v.monte_carlo);const g=24e5,y=v.portfolio_stats,f=l.calculateVaR(g,y.volatility,.95,1),b=l.calculateVaR(g,y.volatility,.99,1),x=l.calculateRiskContributions(t.map(a=>({symbol:a.symbol,allocation:a.allocation,notional:a.notional,color:a.color})),y.volatility,n.value,g);l.updateMetrics({var95:f.var,var99:b.var,cvar95:f.cvar,cvar99:b.cvar,expectedReturn:y.expected_return,volatility:y.volatility,sharpeRatio:y.sharpe_ratio,portfolioBeta:.85,riskContributions:x,maxDrawdown:v.monte_carlo?.stats?.mean_max_drawdown||.124}),a(`HJB оптимизация завершена: Sharpe = ${v.portfolio_stats.sharpe_ratio.toFixed(2)}`,"success")}catch(t){console.error("HJB Optimization Error:",t),a(`Ошибка оптимизации: ${t instanceof Error?t.message:"Unknown error"}`,"error")}finally{o.value=!1}},garchFilteredAssets:v,garchFilteredCount:g,yieldReportData:y,avgHistoricalYield:f,avgDividendYield:b,avgTotalYield:x,portfolioPositions:s,correlationMatrix:n}}function U(t,n,o){const r=e(null);let i=null,c=null,d=null,u=null,m=null;const p=e(0);let h=!1;const v=e(null),g=[];let y=null;const f=e(!1),b=e(0);let x=null,w=[],k=[];const M=a(()=>v.value&&v.value.paths.length?v.value.paths[0].length-1:0),P=()=>{if(!v.value||!v.value.paths.length)return[];const a=v.value.paths,e=[],t=a[0]?.[0]?.y||1e6;for(const l of a)if(l.length>0){const a=l[l.length-1].y;e.push(a/t-1)}return e},j=a(()=>{const a=P();return 0===a.length?0:a.reduce((a,e)=>a+e,0)/a.length}),I=a(()=>{const a=P();if(0===a.length)return 0;const e=[...a].sort((a,e)=>a-e),t=Math.floor(e.length/2);return e.length%2==0?(e[t-1]+e[t])/2:e[t]}),O=a(()=>{const a=P();if(0===a.length)return 0;const e=j.value,t=a.reduce((a,t)=>a+Math.pow(t-e,2),0)/a.length,l=Math.sqrt(t),s=(n.value||252)/252,o=e/s,r=l/Math.sqrt(s);return 0===r?0:o/r}),U=a(()=>{const a=P();if(0===a.length)return 0;const e=[...a].sort((a,e)=>a-e);return e[Math.floor(.05*e.length)]||0}),G=a(()=>{const a=P();if(0===a.length)return 0;const e=[...a].sort((a,e)=>a-e),t=Math.floor(.05*e.length),l=e.slice(0,t+1);return 0===l.length?0:l.reduce((a,e)=>a+e,0)/l.length}),J=a(()=>{if(!v.value||!v.value.paths.length)return 0;const a=v.value.paths,e=[];for(const t of a){if(0===t.length)continue;let a=t[0].y,l=0;for(const e of t){e.y>a&&(a=e.y);const t=(a-e.y)/a;t>l&&(l=t)}e.push(l)}return 0===e.length?0:e.reduce((a,e)=>a+e,0)/e.length}),L=a=>{const{initialPrice:e,drift:t,volatility:l,timeSteps:s,numPaths:n,dt:o,jumpIntensity:r,jumpMean:i,jumpSd:c}=a,d=[],u=[];let m=0,p=-1/0,h=1/0;const v=[];for(let f=0;f<n;f++){const a=[];let n=e;a.push({x:0,y:n,z:f});for(let e=1;e<=s;e++){const s=Math.random(),d=Math.random(),m=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*d);let v=(t-.5*l*l)*o+l*Math.sqrt(o)*m,g=1,y=!1;if(Math.random()<r*o){y=!0;const a=Math.random(),e=Math.random(),t=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*e);g=Math.exp(i+c*t)}n=n*Math.exp(v)*g;const b={x:e,y:n,z:f,isJump:y};a.push(b),y&&u.push(b),p=Math.max(p,n),h=Math.min(h,n)}d.push(a),m+=n,v.push(n)}const g=m/n,y=v.reduce((a,e)=>a+Math.pow(e-g,2),0)/n;return{paths:d,jumps:u,stats:{meanFinalPrice:g,maxPrice:p,minPrice:h,stdDev:Math.sqrt(y)}}},N=(a,e,t=8)=>{const l=document.createElement("canvas");l.width=6144,l.height=3072;const s=l.getContext("2d");s.fillStyle="#ffffff",s.strokeStyle="#000000",s.lineWidth=24,s.font="bold 600px Arial",s.textAlign="center",s.textBaseline="middle",s.strokeText(a,3072,1536),s.fillText(a,3072,1536);const n=new Y(l),o=new F({map:n}),r=new B(o);return r.scale.set(t,t/2,1),r.position.copy(e),r},W=()=>{if(!i||!v.value)return;g.forEach(a=>{i?.remove(a),a.geometry.dispose(),a.material.dispose&&a.material.dispose()}),g.length=0;const{paths:a,stats:e}=v.value;if(!y||y.stats!==e){const t=3,l=8,s=300,n=e.maxPrice-e.minPrice,o=Math.max(n,.05*e.meanFinalPrice,1);y={scaleX:t,scaleY:s/o,scaleZ:l,stats:e,boxWidth:a[0].length*t,boxDepth:a.length*l}}const{scaleX:t,scaleY:l,scaleZ:s,boxWidth:n,boxDepth:o}=y,r=(e.maxPrice-e.minPrice)*l,m=r/2,f=n/2,b=o/2;if(c&&u&&!h){const a=.8*Math.max(n,o,r);c.position.set(a,m+.5*a,a),u.target.set(f,m,b),u.update(),h=!0}const x=new C({color:61695,transparent:!0,opacity:.6,linewidth:1.5}),M=new C({color:16777215,transparent:!0,opacity:1,linewidth:2.5});a.forEach((n,o)=>{const r=n[n.length-1].y,c=Math.abs(r-a[0][0].y)>1.5*e.stdDev?M:x,d=Math.max(2,Math.min(n.length,p.value)),u=n.slice(0,d);if(u.length<2)return;const m=u.map(a=>new R(a.x*t,(a.y-e.minPrice)*l,a.z*s)),h=(new D).setFromPoints(m),v=new z(h,c);i&&(i.add(v),g[o]=v)}),((a,e,t,l,s,n)=>{if(!i)return;w.forEach(a=>{i&&i.remove(a),a.traverse(a=>{a instanceof S&&(a.geometry.dispose(),a.material instanceof V&&a.material.dispose())})}),w.length=0,k.forEach(a=>{i&&i.remove(a),a.material instanceof F&&(a.material.map?.dispose(),a.material.dispose())}),k.length=0;const o=(a.maxPrice-a.minPrice)*t*1.2,r=new q,c=(a,e,t)=>{const l=new q,s=new C({color:34986,opacity:.3,transparent:!0}),n=new C({color:13124,opacity:.5,transparent:!0});for(let o=0;o<=a;o+=50){const a=o%250==0?n:s,r="xz"===t?[new R(o,0,0),new R(o,0,e)]:"xy"===t?[new R(o,0,0),new R(o,e,0)]:[new R(0,0,o),new R(0,e,o)];l.add(new z((new D).setFromPoints(r),a))}for(let o=0;o<=e;o+=50){const e=o%250==0?n:s,r="xz"===t?[new R(0,0,o),new R(a,0,o)]:"xy"===t?[new R(0,o,0),new R(a,o,0)]:[new R(0,o,0),new R(0,o,a)];l.add(new z((new D).setFromPoints(r),e))}return l};r.add(c(s,n,"xz")),r.add(c(s,o,"xy")),r.add(c(n,o,"yz"));const d=new C({color:16777215,linewidth:3}),u=new C({color:11184810,opacity:.8,transparent:!0}),m=.03*Math.max(s,n,o);r.add(new z((new D).setFromPoints([new R(0,0,0),new R(s,0,0)]),d));for(let i=0;i<=s;i+=50){const a=i%250==0,e=a?1.5*m:m;r.add(new z((new D).setFromPoints([new R(i,-e,0),new R(i,e,0)]),a?d:u))}r.add(new z((new D).setFromPoints([new R(0,0,0),new R(0,o,0)]),d));for(let i=0;i<=o;i+=50){const a=i%250==0,e=a?1.5*m:m;r.add(new z((new D).setFromPoints([new R(-e,i,0),new R(e,i,0)]),a?d:u))}r.add(new z((new D).setFromPoints([new R(0,0,0),new R(0,0,n)]),d));for(let i=0;i<=n;i+=50){const a=i%250==0,e=a?1.5*m:m;r.add(new z((new D).setFromPoints([new R(-e,0,i),new R(e,0,i)]),a?d:u))}const p=N("ВРЕМЯ (t)",new R(s/2,-120,0),150);k.push(p),i.add(p);const h=N("Капитал",new R(-150,o/2,0),150);k.push(h),i.add(h);const v=N("ТРАЕКТОРИИ (N)",new R(-120,-120,n/2),150);k.push(v),i.add(v),i.add(r),w.push(r)})(e,0,l,0,n,o),d&&i&&c&&d.render(i,c)},$=async()=>{if(!r.value)return;d&&(d.dispose(),d=null),m&&(cancelAnimationFrame(m),m=null),h=!1,y=null;const a=r.value.parentElement;if(!a)return;const e=a.clientWidth||800,s=a.clientHeight||600;if(0===e||0===s)return void setTimeout(()=>{r.value&&$()},500);i=new _,i.background=null,c=new A(45,e/s,.1,5e4),d=new T({canvas:r.value,antialias:!0,alpha:!0}),d.setSize(e,s),d.setPixelRatio(window.devicePixelRatio),u=new E(c,d.domElement),u.enableDamping=!0,u.dampingFactor=.1,u.rotateSpeed=.5,i.add(new H(16777215,3));const g={initialPrice:1e4*o.value,drift:t.value.expectedReturn,volatility:t.value.marketVol,timeSteps:n.value,numPaths:t.value.monteCarloTrajectories,dt:1/252,jumpIntensity:2,jumpMean:.05,jumpSd:.15};v.value=L(g);const f=v.value.paths[0]?.length||0;p.value=f,b.value=f,W();const x=()=>{m=requestAnimationFrame(x),u&&u.update(),d&&i&&c&&d.render(i,c)};x();const w=()=>{a&&c&&d&&(c.aspect=a.clientWidth/(a.clientHeight||500),c.updateProjectionMatrix(),d.setSize(a.clientWidth,a.clientHeight||500))};window.addEventListener("resize",w),l(()=>{window.removeEventListener("resize",w),m&&cancelAnimationFrame(m),d&&d.dispose()})},X=()=>{f.value=!1,x&&(cancelAnimationFrame(x),x=null)},Z=()=>{if(!f.value)return;const a=M.value,e=b.value+Math.max(1,Math.floor(a/100));e>=a?(b.value=a,p.value=a,X(),W()):(b.value=e,p.value=e,W(),x=requestAnimationFrame(Z))};s(b,a=>{f.value||(p.value=a,W())});return{trajectories3DCanvas:r,simulationResult3D:v,isPlaying3D:f,playbackStep3D:b,maxStep3D:M,formatPercent:a=>(100*a).toFixed(2)+"%",averageReturn:j,medianReturn:I,sharpeRatio:O,var95:U,cvar95:G,averageMDD:J,runMonteCarlo3D:L,init3DTrajectories:$,update3DTrajectories:W,update3DVisualizationFromBackend:a=>{if(!a||!a.paths.length)return;const e=[],l=a.t_grid||a.paths[0].map((a,e)=>e),s=Math.min(t.value.monteCarloTrajectories,a.paths.length);for(let t=0;t<s;t++){const s=a.paths[t],n=[];for(let a=0;a<s.length;a++)n.push({x:l[a]||a,y:s[a],z:t});e.push(n)}const n=a.paths.map(a=>a[a.length-1]);if(v.value={paths:e,jumps:[],stats:{meanFinalPrice:a.stats.mean_final||n.reduce((a,e)=>a+e,0)/n.length,maxPrice:a.stats.max_final||Math.max(...n),minPrice:a.stats.min_final||Math.min(...n),stdDev:a.stats.std_final||0}},e.length>0&&e[0].length>0){const a=e[0].length-1;p.value=a,b.value=a,h=!1,X(),r.value&&(d?W():$())}},togglePlay3D:()=>{f.value?X():(b.value>=M.value&&(b.value=0),f.value=!0,Z())},stopPlay3D:X,resetPlayback3D:()=>{X(),b.value=0,p.value=0,W()},cleanup3D:()=>{m&&(cancelAnimationFrame(m),m=null),d&&(d.dispose(),d=null),i=null,c=null,u=null,g.length=0,w.length=0,k.forEach(a=>{a.material instanceof F&&(a.material.map?.dispose(),a.material.dispose())}),k.length=0}}}let G=null,J=null;function L(a,t){const l=e(null);return{hoveredAsset:l,initCorrelation3DHeatmap:async()=>{try{if(await(async()=>{if("undefined"!=typeof window){const a=window;return a.Plotly?(G=a.Plotly,G):J||(document.querySelector('script[src*="plotly"]')?(J=new Promise(e=>{const t=setInterval(()=>{a.Plotly&&(clearInterval(t),G=a.Plotly,e(G))},100);setTimeout(()=>{clearInterval(t),e(null)},1e4)}),J):(J=new Promise(e=>{const t=document.createElement("script");t.src="https://cdn.plot.ly/plotly-2.27.0.min.js",t.async=!0,t.onload=()=>{G=a.Plotly,e(G)},t.onerror=()=>{e(null)},document.head.appendChild(t)}),J))}return null})(),!G)return;const e=document.getElementById("correlation-3d-heatmap");if(!e)return;const s=[...a.value];if(0===s.length)return;const n=t.value,o=((a,e)=>a.map(a=>{const t=a.symbol.includes("SU")||a.symbol.includes("RU000"),l=t?"#3b82f6":"#10b981",s=t?3+4*Math.random():15+20*Math.random(),n=e.findIndex(e=>e.label===a.symbol);let o=0;if(-1!==n){const a=e[n].values;o=a.reduce((a,e)=>a+e,0)/a.length}return{x:s,y:o,z:a.allocation,asset:{...a,color:l,volatility:s,avgCorrelation:o}}}))(s,n);if(0===o.length)return;const r=o.map(a=>a.x),i=o.map(a=>a.y),c=o.map(a=>a.z),d=Math.min(...r),u=Math.max(...r),m=Math.min(...i),p=Math.max(...i),h=Math.min(...c),v=Math.max(...c),g=(a,e,t)=>t===e?5:(a-e)/(t-e)*10,y=o.map(a=>({...a,nx:g(a.x,d,u),ny:g(a.y,m,p),nz:g(a.z,h,v)})),f=(a,e,t,l,s,n)=>{const o=[],r=[],i=[];for(let c=0;c<16;c++){const s=c/15*Math.PI;for(let n=0;n<16;n++){const c=n/15*2*Math.PI;o.push(a+l*Math.sin(s)*Math.cos(c)),r.push(e+l*Math.sin(s)*Math.sin(c)),i.push(t+l*Math.cos(s))}}return{type:"mesh3d",x:o,y:r,z:i,color:s,alphahull:0,opacity:1,flatshading:!1,lighting:{ambient:.6,diffuse:.9,specular:1,roughness:.1,fresnel:.8},lightposition:{x:10,y:10,z:20},hoverinfo:"none",customdata:n,name:n.symbol}},b=[];y.forEach(a=>{const e=.3+a.asset.allocation/25;b.push(f(a.nx,a.ny,a.nz,e,a.asset.color,a.asset))}),b.push({x:y.map(a=>a.nx),y:y.map(a=>a.ny),z:y.map(a=>a.nz),mode:"markers",type:"scatter3d",marker:{size:y.map(a=>Math.max(40,40*(.3+a.asset.allocation/25))),color:"rgba(255,255,255,0)",opacity:0,line:{width:0}},hoverinfo:"skip",customdata:y.map(a=>a.asset)});const x=(a,e,t,l=0)=>[0,2.5,5,7.5,10].map(s=>(a+s/10*(e-a)).toFixed(l)+t),w={showlegend:!1,hovermode:"closest",scene:{xaxis:{title:"РИСК (Волатильность %)",backgroundcolor:"rgba(20, 22, 28, 0.8)",gridcolor:"rgba(255,255,255,0.08)",zeroline:!1,showbackground:!0,titlefont:{color:"#ffffff",size:12,weight:"bold"},tickfont:{size:9,color:"rgba(255,255,255,0.6)"},tickvals:[0,2.5,5,7.5,10],ticktext:x(d,u,"%"),showspikes:!1},yaxis:{title:"СВЯЗЬ (Корреляция)",backgroundcolor:"rgba(30, 32, 38, 0.6)",gridcolor:"rgba(255,255,255,0.08)",zeroline:!1,showbackground:!0,titlefont:{color:"#ffffff",size:12,weight:"bold"},tickfont:{size:9,color:"rgba(255,255,255,0.6)"},tickvals:[0,2.5,5,7.5,10],ticktext:x(m,p,"",2),showspikes:!1},zaxis:{title:"ДОЛЯ (Вес %)",backgroundcolor:"rgba(20, 22, 28, 0.8)",gridcolor:"rgba(255,255,255,0.08)",zeroline:!1,showbackground:!0,titlefont:{color:"#ffffff",size:12,weight:"bold"},tickfont:{size:9,color:"rgba(255,255,255,0.6)"},tickvals:[0,2.5,5,7.5,10],ticktext:x(h,v,"%",1),showspikes:!1},bgcolor:"rgba(0,0,0,0)",camera:{eye:{x:1.8,y:1.8,z:1.2},center:{x:0,y:0,z:0},up:{x:0,y:0,z:1}},aspectmode:"cube"},paper_bgcolor:"transparent",plot_bgcolor:"transparent",font:{color:"#fff",family:"system-ui"},margin:{l:0,r:0,b:0,t:0},autosize:!0};G.newPlot(e,b,w,{responsive:!0,displayModeBar:!1,staticPlot:!1,displaylogo:!1});const k=e;k.on("plotly_hover",a=>{if(a?.points?.length>0)for(const e of a.points){if(e.customdata){const a=Array.isArray(e.customdata)?e.customdata[0]:e.customdata;if(a)return void(l.value=a)}const a=b.length-1;if(e.curveNumber===a&&void 0!==e.pointNumber){const a=e.pointNumber;if(a>=0&&a<y.length&&y[a])return void(l.value=y[a].asset)}if(e.curveNumber<a&&e.curveNumber<y.length&&y[e.curveNumber])return void(l.value=y[e.curveNumber].asset)}}),k.on("plotly_unhover",()=>{l.value=null})}catch(e){console.error("Error initializing 3D Correlation Heatmap:",e)}}}}function N(a){const t=e(null),s=e(null),n=e(null),o=e(0),r=e(!1),i=()=>{const e=a.value;if(0===e.length)return[];const t=[];for(let a=0;a<500;a++){const a=e.reduce((a,e)=>a+e.dayChange/100/252*(e.allocation||0),0),l=.02*(Math.random()-.5);t.push(a+l)}return t},c=async()=>{try{const a=i();if(0===a.length)return;const e=await(async a=>{try{const e=await fetch("   https://stochastic-dashbord-v1-production.up.railway.app/api/compute/garch",{method:"POST",headers:j(),body:JSON.stringify(a)});if(!e.ok){const a=await e.json().catch(()=>({detail:"Unknown error"}));throw new Error(a.detail||`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){throw console.error("GARCH Calculation Failed:",e),e}})({returns:a,omega:25e-6,alpha:.082,beta:.893});s.value=e,o.value=0,d()}catch(a){console.error("Failed to load GARCH data:",a),(()=>{if(0===i().length){const a=500,e=[];let t=.18;for(let l=0;l<a;l++){const a=.05*(Math.random()-.5);t=Math.max(.05,Math.min(.5,.95*t+a)),e.push(t)}s.value={result:{variances:e.map(a=>a*a),volatilities:e,residuals:Array(a).fill(0).map(()=>.3*(Math.random()-.5)),parameters:{omega:25e-6,alpha:.082,beta:.893},long_term_volatility:.182,mean_variance:.033,mean_volatility:.18},status:"success",timestamp:(new Date).toISOString()},o.value=0,d()}})()}},d=()=>{r.value||(r.value=!0,o.value=0,m())},u=()=>{r.value=!1,n.value&&(cancelAnimationFrame(n.value),n.value=null)},m=()=>{if(!r.value||!s.value)return;const a=document.getElementById("garch-chart");if(!a)return void u();const e=a.getContext("2d");if(!e)return void u();const t=a.offsetWidth||1200,l=200;a.width=t,a.height=l;const i=s.value.result.volatilities,c=i.length;o.value+=2;const d=Math.min(o.value,c);if(e.fillStyle="rgba(20, 22, 28, 0.5)",e.fillRect(0,0,t,l),e.strokeStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=1,e.setLineDash([5,5]),e.beginPath(),e.moveTo(0,100),e.lineTo(t,100),e.stroke(),e.setLineDash([]),d>0){const a=s.value.result.mean_volatility,n=2*(1.2*Math.max(...i.slice(0,d).map(e=>Math.abs(e-a))))||.1;e.strokeStyle="#60a5fa",e.lineWidth=2,e.beginPath();for(let l=0;l<d;l++){const s=l/(c-1)*t,o=100-160*((i[l]-a)/n);0===l?e.moveTo(s,o):e.lineTo(s,o)}if(e.stroke(),e.fillStyle="rgba(96, 165, 250, 0.15)",d>0){const a=(d-1)/(c-1)*t;e.lineTo(a,100),e.lineTo(0,100),e.closePath(),e.fill()}e.fillStyle="#60a5fa";for(let l=0;l<d;l+=10){const s=l/(c-1)*t,o=100-160*((i[l]-a)/n);e.beginPath(),e.arc(s,o,2,0,2*Math.PI),e.fill()}if(d<c){const a=(d-1)/(c-1)*t;e.strokeStyle="#fbbf24",e.lineWidth=2,e.beginPath(),e.moveTo(a,0),e.lineTo(a,l),e.stroke()}}d<c?n.value=requestAnimationFrame(m):setTimeout(()=>{o.value=0,n.value=requestAnimationFrame(m)},2e3)};return l(()=>{u()}),{garchChart:t,garchData:s,isGARCHAnimating:r,initGARCHChart:()=>{document.getElementById("garch-chart")&&c()},loadGARCHData:c,stopGARCHAnimation:u,animateGARCHChart:m}}const W={class:"hero-section"},$={class:"hero-left"},X={class:"hero-meta"},Z={class:"glass-pill"},Q={class:"glass-pill"},K={class:"glass-pill"},aa={class:"hero-actions"},ea=["disabled"],ta={key:0,width:"16",height:"16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},la={key:1,class:"spinner"},sa={class:"glass-panel hjb-params-row"},na={class:"panel-body params-row-body"},oa={class:"param-group-horizontal"},ra={class:"param-input-group"},ia={class:"param-group-horizontal"},ca={class:"param-input-group"},da={class:"param-group-horizontal"},ua={class:"param-input-group"},ma={class:"param-group-horizontal"},pa={class:"param-input-group"},ha={class:"param-group-horizontal"},va={class:"param-input-group"},ga={class:"param-group-horizontal"},ya={class:"param-input-group"},fa={class:"dashboard-grid hjb-grid"},ba={class:"col-portfolio-wide"},xa={class:"glass-panel portfolio-composition-panel"},wa={class:"panel-body weights-body"},ka={class:"weights-comparison"},Ma={class:"weights-table-container"},Pa={class:"weights-table"},ja={class:"asset-cell"},Fa={class:"asset-info"},Ca={class:"symbol"},Ra={class:"name"},Da={class:"text-right mono"},za={class:"text-right mono"},_a={class:"text-right mono opacity-80"},Aa={class:"text-right mono font-bold"},Ta={class:"col-3d-right"},Ha={class:"glass-panel correlation-3d-panel"},Sa={class:"panel-body correlation-3d-body"},Va={key:0,class:"asset-tooltip-3d"},qa={class:"tooltip-header"},Ya={class:"tooltip-symbol"},Ba={class:"tooltip-name"},Ea={class:"tooltip-details"},Ia={class:"tooltip-row"},Oa={key:0,class:"tooltip-row"},Ua={key:1,class:"tooltip-row"},Ga={class:"tooltip-row"},Ja={class:"tooltip-row"},La={class:"tooltip-row"},Na={key:2,class:"tooltip-row"},Wa={class:"garch-full-width"},$a={class:"glass-panel"},Xa={class:"panel-body"},Za={class:"garch-container-full"},Qa={class:"garch-chart-placeholder-full"},Ka={ref:"garchChartRef",id:"garch-chart"},ae={class:"garch-params-full"},ee={class:"garch-stats"},te={class:"garch-stat"},le={class:"stat-val"},se={class:"garch-stat"},ne={class:"stat-val"},oe={class:"garch-stat"},re={class:"stat-val"},ie={class:"garch-stat"},ce={class:"stat-val"},de={class:"dashboard-grid hjb-reports-grid"},ue={class:"col-report-left"},me={class:"glass-panel report-panel"},pe={class:"panel-body"},he={class:"filtering-report"},ve={class:"report-summary"},ge={class:"summary-item"},ye={class:"summary-value"},fe={class:"summary-item"},be={class:"summary-value text-green"},xe={class:"summary-item"},we={class:"summary-value text-red"},ke={class:"filtered-assets"},Me={class:"filtered-list"},Pe={class:"asset-symbol"},je={class:"asset-garch"},Fe={class:"col-report-right"},Ce={class:"glass-panel report-panel"},Re={class:"panel-body weights-body"},De={class:"weights-comparison"},ze={class:"weights-table-container"},_e={class:"weights-table"},Ae={class:"asset-cell"},Te={class:"asset-info"},He={class:"symbol"},Se={class:"name"},Ve={class:"text-right mono"},qe={class:"text-right mono"},Ye={class:"text-right mono font-bold text-green"},Be={class:"yield-summary"},Ee={class:"yield-summary-item"},Ie={class:"summary-value"},Oe={class:"yield-summary-item"},Ue={class:"summary-value"},Ge={class:"yield-summary-item"},Je={class:"summary-value text-green font-bold"},Le={class:"glass-panel trajectories-panel"},Ne={class:"panel-header"},We={class:"trajectories-header-left"},$e={key:0,class:"live-badge"},Xe={key:0,class:"playback-controls"},Ze={key:0},Qe={key:1},Ke={class:"timeline-wrapper"},at=["max"],et={class:"playback-day-info"},tt={class:"mono"},lt={class:"mono"},st={class:"panel-body"},nt={key:0,viewBox:"0 0 1000 400",preserveAspectRatio:"none",class:"trajectories-svg"},ot=["y1","y2"],rt=["d"],it=["d"],ct=["d"],dt=["d"],ut=["d"],mt=["x1","x2"],pt={key:1,class:"trajectories-empty-state"},ht={class:"glass-panel trajectories-3d-panel"},vt={class:"panel-header"},gt={class:"trajectories-3d-header-left"},yt={key:0,class:"live-badge"},ft={key:0,class:"playback-controls"},bt={key:0},xt={key:1},wt={class:"timeline-wrapper"},kt=["max"],Mt={class:"playback-day-info"},Pt={class:"mono"},jt={class:"mono"},Ft={class:"panel-body"},Ct={class:"trajectories-3d-container"},Rt={key:0,class:"glass-panel metrics-summary-panel"},Dt={class:"panel-body"},zt={class:"metrics-grid"},_t={class:"metric-card"},At={class:"metric-card"},Tt={class:"metric-card"},Ht={class:"metric-card"},St={class:"metric-value text-red"},Vt={class:"metric-card"},qt={class:"metric-value text-red"},Yt={class:"metric-card"},Bt={class:"metric-value text-red"},Et=I(n({__name:"HJBOptimization",emits:["toast"],setup(n,{emit:P}){const j=P,F=M(),C=a(()=>F.selectedBank),R=a(()=>F.correlationMatrix),{hjbParams:D,hjbOptimizationResult:z,isComputing:_,trajectoriesDays:A,runHJBOptimization:T,garchFilteredAssets:H,garchFilteredCount:S,yieldReportData:V,avgHistoricalYield:q,avgDividendYield:Y,avgTotalYield:B,portfolioPositions:E}=O(),{playbackStepTrajectories:I,isPlayingTrajectories:G,trajectoriesChartContainer:J,initialPrice:Et,trajectoriesData:It,scaleX:Ot,scaleY:Ut,generatePathD:Gt,generateAreaD:Jt,updateDisplayPaths:Lt,generateTrajectories:Nt,togglePlayTrajectories:Wt,stopPlayTrajectories:$t,resetPlaybackTrajectories:Xt,updateFromBackend:Zt}=function(a,s){const n=e(0),o=e(!1);let r=null;const i=e(null),c=e(0),d=t({paths:[],displayPaths:[],medianPath:[],q05:[],q95:[],minY:0,maxY:200}),u=()=>{let a=0,e=0;for(;0===a;)a=Math.random();for(;0===e;)e=Math.random();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*e)},m=a=>a/s.value*1e3,p=a=>{const e=d.maxY-d.minY;return 400-(a-d.minY)/e*400},h=()=>{if(!d.paths.length)return;const e=Math.min(a.value.monteCarloTrajectories,d.paths.length);d.displayPaths=d.paths.slice(0,e)},v=()=>{if(!o.value)return;const a=s.value,e=n.value+Math.max(1,Math.floor(a/100));e>=a?(n.value=a,g()):(n.value=e,r=requestAnimationFrame(v))},g=()=>{o.value=!1,r&&cancelAnimationFrame(r)};return l(()=>{r&&cancelAnimationFrame(r)}),{playbackStepTrajectories:n,isPlayingTrajectories:o,trajectoriesChartContainer:i,initialPrice:c,trajectoriesData:d,scaleX:m,scaleY:p,generatePathD:(a,e)=>a.length?"M "+a.slice(0,e+1).map((a,e)=>`${m(e).toFixed(1)},${p(a).toFixed(1)}`).join(" L "):"",generateAreaD:(a,e,t)=>{if(!a.length)return"";const l=a.slice(0,t+1),s=e.slice(0,t+1);let n="M "+l.map((a,e)=>`${m(e).toFixed(1)},${p(a).toFixed(1)}`).join(" L ");for(let o=s.length-1;o>=0;o--)n+=` L ${m(o).toFixed(1)},${p(s[o]).toFixed(1)}`;return n+=" Z",n},updateDisplayPaths:h,generateTrajectories:()=>{const{expectedReturn:e,marketVol:t,monteCarloTrajectories:l}=a.value,r=s.value,i=1/252,m=e,p=t,v=[];for(let a=0;a<l;a++){const a=[c.value];let e=c.value;for(let t=1;t<=r;t++){const t=u(),l=(m-.5*p*p)*i,s=p*Math.sqrt(i)*t;e*=Math.exp(l+s),a.push(e)}v.push(a)}const g=r+1,y=[],f=[],b=[];let x=c.value,w=c.value;for(let a=0;a<g;a++){const e=v.map(e=>e[a]).sort((a,e)=>a-e),t=e[Math.floor(.5*l)],s=e[Math.floor(.05*l)],n=e[Math.floor(.95*l)];y.push(t),f.push(s),b.push(n),s<x&&(x=s),n>w&&(w=n)}d.paths=v,h(),d.medianPath=y,d.q05=f,d.q95=b,d.minY=.9*x,d.maxY=1.1*w,o.value||(n.value=r)},togglePlayTrajectories:()=>{o.value?g():(n.value>=s.value&&(n.value=0),o.value=!0,v())},stopPlayTrajectories:g,resetPlaybackTrajectories:()=>{g(),n.value=0},updateFromBackend:a=>{d.paths=a.paths,h(),d.medianPath=a.median_path,d.q05=a.q05_path,d.q95=a.q95_path;const e=[...a.q05_path,...a.q95_path];d.minY=.9*Math.min(...e),d.maxY=1.1*Math.max(...e),n.value=s.value}}}(D,A),{trajectories3DCanvas:Qt,simulationResult3D:Kt,playbackStep3D:al,isPlaying3D:el,maxStep3D:tl,averageReturn:ll,medianReturn:sl,sharpeRatio:nl,var95:ol,cvar95:rl,averageMDD:il,init3DTrajectories:cl,togglePlay3D:dl,stopPlay3D:ul,resetPlayback3D:ml,update3DVisualizationFromBackend:pl}=U(D,A,Et),{hoveredAsset:hl,initCorrelation3DHeatmap:vl}=L(E,R),{garchData:gl,initGARCHChart:yl}=N(E),fl=a=>(100*a).toFixed(2)+"%",bl=(a,e)=>{j("toast",{message:a,type:e})},xl=async()=>{await T(bl,a=>{Zt(a),pl(a)})};return s(()=>D.value.monteCarloTrajectories,()=>{z.value?.monte_carlo?(It.paths.length>0&&Lt(),pl(z.value.monte_carlo)):Nt()}),s(()=>[D.value.horizon,D.value.expectedReturn,D.value.marketVol,D.value.riskFreeRate],()=>{z.value?.monte_carlo||Nt()},{deep:!0}),o(async()=>{const a=E.value;a.length>0?Et.value=a.reduce((a,e)=>a+e.allocation,0):Et.value=100,Nt(),await r(),cl(),vl(),yl()}),(a,e)=>(c(),i("div",null,[d("div",W,[d("div",$,[e[18]||(e[18]=d("h1",null,"Стохастическое оптимизирование (HJB)",-1)),d("div",X,[e[17]||(e[17]=d("span",{class:"glass-pill"},[m("Стратегия: "),d("strong",null,"Hamilton-Jacobi-Bellman")],-1)),d("span",Z,[e[14]||(e[14]=m("Горизонт: ",-1)),d("strong",null,p(h(D).horizon)+" мес.",1)]),d("span",Q,[e[15]||(e[15]=m("Банк: ",-1)),d("strong",null,p(C.value.name),1)]),d("span",K,[e[16]||(e[16]=m("Активов: ",-1)),d("strong",null,p(h(E).length),1)])])]),d("div",aa,[d("button",{class:"btn-glass primary",onClick:xl,disabled:h(_)},[h(_)?(c(),i("span",la)):(c(),i("svg",ta,[...e[19]||(e[19]=[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])),m(" "+p(h(_)?"Расчёт...":"Запустить оптимизацию"),1)],8,ea)])]),d("div",sa,[e[26]||(e[26]=d("div",{class:"panel-header"},[d("h3",null,"Параметры HJB модели")],-1)),d("div",na,[d("div",oa,[e[20]||(e[20]=d("label",null,"Коэффициент неприятия риска (γ)",-1)),d("div",ra,[v(d("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=a=>h(D).gamma=a),min:"0.1",max:"20",step:"0.1"},null,512),[[g,h(D).gamma,void 0,{number:!0}]])])]),d("div",ia,[e[21]||(e[21]=d("label",null,"Инвестиционный горизонт (T), лет",-1)),d("div",ca,[v(d("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=a=>h(D).horizon=a),min:"0.1",max:"50",step:"0.1"},null,512),[[g,h(D).horizon,void 0,{number:!0}]])])]),d("div",da,[e[22]||(e[22]=d("label",null,"Безрисковая ставка (r)",-1)),d("div",ua,[v(d("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=a=>h(D).riskFreeRate=a),min:"0",max:"0.2",step:"0.001"},null,512),[[g,h(D).riskFreeRate,void 0,{number:!0}]])])]),d("div",ma,[e[23]||(e[23]=d("label",null,"Волатильность рынка (σ)",-1)),d("div",pa,[v(d("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=a=>h(D).marketVol=a),min:"0.05",max:"0.8",step:"0.01"},null,512),[[g,h(D).marketVol,void 0,{number:!0}]])])]),d("div",ha,[e[24]||(e[24]=d("label",null,"Ожидаемая доходность (μ)",-1)),d("div",va,[v(d("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=a=>h(D).expectedReturn=a),min:"0",max:"0.5",step:"0.01"},null,512),[[g,h(D).expectedReturn,void 0,{number:!0}]])])]),d("div",ga,[e[25]||(e[25]=d("label",null,"Количество траекторий Монте-Карло",-1)),d("div",ya,[v(d("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=a=>h(D).monteCarloTrajectories=a),min:"100",max:"100000",step:"100"},null,512),[[g,h(D).monteCarloTrajectories,void 0,{number:!0}]])])])])]),d("div",fa,[d("div",ba,[d("div",xa,[e[28]||(e[28]=d("div",{class:"panel-header"},[d("h3",null,"Состав портфеля")],-1)),d("div",wa,[d("div",ka,[d("div",Ma,[d("table",Pa,[e[27]||(e[27]=d("thead",null,[d("tr",null,[d("th",null,"Инструмент"),d("th",{class:"text-right"},"Цена"),d("th",{class:"text-right"},"День %"),d("th",{class:"text-right"},"Позиция"),d("th",{class:"text-right"},"Вес")])],-1)),d("tbody",null,[(c(!0),i(y,null,f(h(E),a=>(c(),i("tr",{key:a.symbol},[d("td",null,[d("div",ja,[d("div",{class:"asset-icon",style:b({background:a.color})},p(a.symbol[0]),5),d("div",Fa,[d("span",Ca,p(a.symbol),1),d("span",Ra,p(a.name),1)])])]),d("td",Da,"₽"+p(a.price),1),d("td",za,[d("span",{class:x(["change-pill",a.dayChange>0?"text-green":"text-red"])},p(a.dayChange>0?"+":"")+p(a.dayChange)+"% ",3)]),d("td",_a,"₽"+p((a.notional/1e3).toFixed(1))+"k",1),d("td",Aa,p(a.allocation)+"%",1)]))),128))])])])])])])]),d("div",Ta,[d("div",Ha,[e[37]||(e[37]=d("div",{class:"panel-header"},[d("h3",null,"3D Тепловая карта активов")],-1)),d("div",Sa,[e[36]||(e[36]=d("div",{id:"correlation-3d-heatmap",class:"static-3d-plot",style:{width:"100%",height:"500px",position:"relative","min-height":"500px",background:"transparent","border-radius":"8px"}},null,-1)),h(hl)?(c(),i("div",Va,[d("div",qa,[d("div",{class:"asset-icon",style:b({background:h(hl).color})},p(h(hl).symbol[0]),5),d("div",null,[d("div",Ya,p(h(hl).symbol),1),d("div",Ba,p(h(hl).name),1)])]),d("div",Ea,[d("div",Ia,[e[29]||(e[29]=d("span",null,"Тип:",-1)),d("strong",null,p(h(hl).symbol.includes("SU")||h(hl).symbol.includes("RU000")?"Облигация":"Акция"),1)]),void 0!==h(hl).volatility?(c(),i("div",Oa,[e[30]||(e[30]=d("span",null,"Волатильность:",-1)),d("strong",null,p(h(hl).volatility?.toFixed(1)||"N/A")+"%",1)])):u("",!0),void 0!==h(hl).avgCorrelation?(c(),i("div",Ua,[e[31]||(e[31]=d("span",null,"Ср. корреляция:",-1)),d("strong",null,p(h(hl).avgCorrelation?.toFixed(2)||"N/A"),1)])):u("",!0),d("div",Ga,[e[32]||(e[32]=d("span",null,"Вес в портфеле:",-1)),d("strong",null,p(h(hl).allocation?.toFixed(2)||h(hl).allocation)+"%",1)]),d("div",Ja,[e[33]||(e[33]=d("span",null,"Цена:",-1)),d("strong",null,p(h(hl).price?.toLocaleString("ru-RU")||h(hl).price)+" ₽",1)]),d("div",La,[e[34]||(e[34]=d("span",null,"Дневное изм.:",-1)),d("strong",{class:x(h(hl).dayChange>=0?"text-green":"text-red")},p(h(hl).dayChange>=0?"+":"")+p(h(hl).dayChange?.toFixed(2)||h(hl).dayChange)+"% ",3)]),h(hl).notional?(c(),i("div",Na,[e[35]||(e[35]=d("span",null,"Позиция:",-1)),d("strong",null,"₽"+p((h(hl).notional/1e3).toFixed(1))+"k",1)])):u("",!0)])])):u("",!0)])])])]),d("div",Wa,[d("div",$a,[e[43]||(e[43]=d("div",{class:"panel-header"},[d("h3",null,"Моделирование волатильности (GARCH)")],-1)),d("div",Xa,[d("div",Za,[d("div",Qa,[d("canvas",Ka,null,512)]),d("div",ae,[e[42]||(e[42]=d("div",{class:"garch-param-row"},[d("span",{class:"param-name"},"GARCH(1,1):"),d("span",{class:"param-value"},[m("σ²"),d("sub",null,"t"),m(" = ω + αε²"),d("sub",null,"t-1"),m(" + βσ²"),d("sub",null,"t-1")])],-1)),d("div",ee,[d("div",te,[e[38]||(e[38]=d("span",{class:"stat-label"},"α (ARCH)",-1)),d("span",le,p(h(gl)?.result?.parameters?.alpha?.toFixed(3)||"0.082"),1)]),d("div",se,[e[39]||(e[39]=d("span",{class:"stat-label"},"β (GARCH)",-1)),d("span",ne,p(h(gl)?.result?.parameters?.beta?.toFixed(3)||"0.893"),1)]),d("div",oe,[e[40]||(e[40]=d("span",{class:"stat-label"},"ω",-1)),d("span",re,p(h(gl)?.result?.parameters?.omega?.toFixed(6)||"0.000025"),1)]),d("div",ie,[e[41]||(e[41]=d("span",{class:"stat-label"},"Long-term Vol",-1)),d("span",ce,p(h(gl)?.result?.long_term_volatility?(100*h(gl).result.long_term_volatility).toFixed(1)+"%":"18.2%"),1)])])])])])])]),d("div",de,[d("div",ue,[d("div",me,[e[49]||(e[49]=d("div",{class:"panel-header"},[d("h3",null,"Фильтрация активов по GARCH")],-1)),d("div",pe,[d("div",he,[d("div",ve,[d("div",ge,[e[44]||(e[44]=d("span",{class:"summary-label"},"Всего активов",-1)),d("span",ye,p(h(E).length),1)]),d("div",fe,[e[45]||(e[45]=d("span",{class:"summary-label"},"Прошли фильтр",-1)),d("span",be,p(h(S)),1)]),d("div",xe,[e[46]||(e[46]=d("span",{class:"summary-label"},"Отклонены",-1)),d("span",we,p(h(E).length-h(S)),1)])]),e[48]||(e[48]=w('<div class="filtering-criteria" data-v-e15fa5f8><div class="criteria-title" data-v-e15fa5f8>Критерии фильтрации:</div><div class="criteria-list" data-v-e15fa5f8><div class="criteria-item" data-v-e15fa5f8><span class="criteria-check" data-v-e15fa5f8>✓</span><span data-v-e15fa5f8>GARCH волатильность ≤ 30%</span></div><div class="criteria-item" data-v-e15fa5f8><span class="criteria-check" data-v-e15fa5f8>✓</span><span data-v-e15fa5f8>Стабильность параметров (α + β &lt; 1)</span></div><div class="criteria-item" data-v-e15fa5f8><span class="criteria-check" data-v-e15fa5f8>✓</span><span data-v-e15fa5f8>Достаточная ликвидность</span></div></div></div>',1)),d("div",ke,[e[47]||(e[47]=d("div",{class:"filtered-title"},"Прошедшие фильтр (топ-10):",-1)),d("div",Me,[(c(!0),i(y,null,f(h(H).slice(0,10),(a,e)=>(c(),i("div",{key:e,class:"filtered-asset"},[d("span",Pe,p(a.symbol),1),d("span",je,p(a.garchVol)+"%",1)]))),128))])])])])])]),d("div",Fe,[d("div",Ce,[e[54]||(e[54]=d("div",{class:"panel-header"},[d("h3",null,"Историческая и дивидендная доходность")],-1)),d("div",Re,[d("div",De,[d("div",ze,[d("table",_e,[e[50]||(e[50]=d("thead",null,[d("tr",null,[d("th",null,"Актив"),d("th",{class:"text-right"},"Историческая"),d("th",{class:"text-right"},"Дивидендная"),d("th",{class:"text-right"},"Итого")])],-1)),d("tbody",null,[(c(!0),i(y,null,f(h(V).slice(0,10),(a,e)=>(c(),i("tr",{key:e},[d("td",null,[d("div",Ae,[d("div",{class:"asset-icon",style:b({background:a.color})},p(a.symbol[0]),5),d("div",Te,[d("span",He,p(a.symbol),1),d("span",Se,p(a.name),1)])])]),d("td",Ve,p((100*a.historicalYield).toFixed(2))+"%",1),d("td",qe,p((100*a.dividendYield).toFixed(2))+"%",1),d("td",Ye,p((100*a.totalYield).toFixed(2))+"%",1)]))),128))])])])]),d("div",Be,[d("div",Ee,[e[51]||(e[51]=d("span",{class:"summary-label"},"Средняя историческая доходность",-1)),d("span",Ie,p((100*h(q)).toFixed(2))+"%",1)]),d("div",Oe,[e[52]||(e[52]=d("span",{class:"summary-label"},"Средняя дивидендная доходность",-1)),d("span",Ue,p((100*h(Y)).toFixed(2))+"%",1)]),d("div",Ge,[e[53]||(e[53]=d("span",{class:"summary-label"},"Средняя общая доходность",-1)),d("span",Je,p((100*h(B)).toFixed(2))+"%",1)])])])])])]),d("div",Le,[d("div",Ne,[d("div",We,[e[55]||(e[55]=d("h3",null,"Траектории симуляции методом Монте-Карло",-1)),h(G)?(c(),i("span",$e,"● LIVE")):u("",!0)]),h(It).paths.length?(c(),i("div",Xe,[d("button",{class:"icon-btn",onClick:e[6]||(e[6]=(...a)=>h(Wt)&&h(Wt)(...a)),title:"Play/Pause"},[h(G)?(c(),i("span",Ze,"⏸")):(c(),i("span",Qe,"▶"))]),d("div",Ke,[v(d("input",{type:"range",min:"0",max:h(A),"onUpdate:modelValue":e[7]||(e[7]=a=>k(I)?I.value=a:null),onInput:e[8]||(e[8]=(...a)=>h($t)&&h($t)(...a)),class:"timeline-slider"},null,40,at),[[g,h(I),void 0,{number:!0}]]),d("div",{class:"timeline-track",style:b({width:h(I)/h(A)*100+"%"})},null,4)]),d("div",et,[e[56]||(e[56]=m(" День: ",-1)),d("span",tt,p(h(I)),1),e[57]||(e[57]=m(" / ",-1)),d("span",lt,p(h(A)),1)]),d("button",{class:"icon-btn",onClick:e[9]||(e[9]=(...a)=>h(Xt)&&h(Xt)(...a)),title:"Reset"},"↺")])):u("",!0)]),d("div",st,[d("div",{class:"trajectories-chart-container",ref_key:"trajectoriesChartContainer",ref:J},[h(It).paths.length>0?(c(),i("svg",nt,[e[58]||(e[58]=d("line",{x1:"0",y1:"350",x2:"1000",y2:"350",stroke:"rgba(255,255,255,0.05)"},null,-1)),e[59]||(e[59]=d("line",{x1:"0",y1:"200",x2:"1000",y2:"200",stroke:"rgba(255,255,255,0.05)"},null,-1)),e[60]||(e[60]=d("line",{x1:"0",y1:"50",x2:"1000",y2:"50",stroke:"rgba(255,255,255,0.05)"},null,-1)),d("line",{x1:"0",y1:h(Ut)(h(Et)),x2:"1000",y2:h(Ut)(h(Et)),stroke:"rgba(255,255,255,0.2)","stroke-dasharray":"4"},null,8,ot),(c(!0),i(y,null,f(h(It).displayPaths,(a,e)=>(c(),i("path",{key:`trajectory-path-${e}`,d:h(Gt)(a,h(I)),fill:"none",stroke:"rgba(59, 130, 246, 0.2)","stroke-width":"1"},null,8,rt))),128)),d("path",{d:h(Jt)(h(It).q05,h(It).q95,h(I)),fill:"rgba(59, 130, 246, 0.1)",stroke:"none"},null,8,it),d("path",{d:h(Gt)(h(It).medianPath,h(I)),fill:"none",stroke:"#3b82f6","stroke-width":"2.5"},null,8,ct),d("path",{d:h(Gt)(h(It).q05,h(I)),fill:"none",stroke:"#f87171","stroke-width":"1.5","stroke-dasharray":"4"},null,8,dt),d("path",{d:h(Gt)(h(It).q95,h(I)),fill:"none",stroke:"#34d399","stroke-width":"1.5","stroke-dasharray":"4"},null,8,ut),h(I)>0?(c(),i("line",{key:0,x1:h(Ot)(h(I)),y1:"0",x2:h(Ot)(h(I)),y2:"400",stroke:"rgba(255,255,255,0.4)","stroke-dasharray":"2"},null,8,mt)):u("",!0)])):(c(),i("div",pt,[...e[61]||(e[61]=[d("span",null,"Генерация траекторий на основе параметров HJB модели",-1)])]))],512)])]),d("div",ht,[d("div",vt,[d("div",gt,[e[62]||(e[62]=d("h3",null,"3D визуализация траекторий",-1)),h(el)?(c(),i("span",yt,"● LIVE")):u("",!0)]),h(Kt)&&h(Kt).paths.length?(c(),i("div",ft,[d("button",{class:"icon-btn",onClick:e[10]||(e[10]=(...a)=>h(dl)&&h(dl)(...a)),title:"Play/Pause"},[h(el)?(c(),i("span",bt,"⏸")):(c(),i("span",xt,"▶"))]),d("div",wt,[v(d("input",{type:"range",min:"0",max:h(tl),"onUpdate:modelValue":e[11]||(e[11]=a=>k(al)?al.value=a:null),onInput:e[12]||(e[12]=(...a)=>h(ul)&&h(ul)(...a)),class:"timeline-slider"},null,40,kt),[[g,h(al),void 0,{number:!0}]]),d("div",{class:"timeline-track",style:b({width:(h(tl)>0?h(al)/h(tl)*100:0)+"%"})},null,4)]),d("div",Mt,[e[63]||(e[63]=m(" Шаг: ",-1)),d("span",Pt,p(h(al)),1),e[64]||(e[64]=m(" / ",-1)),d("span",jt,p(h(tl)),1)]),d("button",{class:"icon-btn",onClick:e[13]||(e[13]=(...a)=>h(ml)&&h(ml)(...a)),title:"Reset"},"↺")])):u("",!0)]),d("div",Ft,[d("div",Ct,[d("canvas",{ref_key:"trajectories3DCanvas",ref:Qt,class:"trajectories-3d-canvas"},null,512)])])]),h(Kt)&&h(Kt).paths.length?(c(),i("div",Rt,[e[71]||(e[71]=d("div",{class:"panel-header"},[d("h3",null,"Итоги симуляций")],-1)),d("div",Dt,[d("div",zt,[d("div",_t,[e[65]||(e[65]=d("div",{class:"metric-label"},"Средняя доходность портфеля",-1)),d("div",{class:x(["metric-value",h(ll)>=0?"text-green":"text-red"])},p(fl(h(ll))),3)]),d("div",At,[e[66]||(e[66]=d("div",{class:"metric-label"},"Медианная доходность портфеля",-1)),d("div",{class:x(["metric-value",h(sl)>=0?"text-green":"text-red"])},p(fl(h(sl))),3)]),d("div",Tt,[e[67]||(e[67]=d("div",{class:"metric-label"},"Sharpe Ratio",-1)),d("div",{class:x(["metric-value",h(nl)>=0?"text-green":"text-red"])},p(h(nl).toFixed(2)),3)]),d("div",Ht,[e[68]||(e[68]=d("div",{class:"metric-label"},"VaR (95%)",-1)),d("div",St,p(fl(h(ol))),1)]),d("div",Vt,[e[69]||(e[69]=d("div",{class:"metric-label"},"CVaR (95%)",-1)),d("div",qt,p(fl(h(rl))),1)]),d("div",Yt,[e[70]||(e[70]=d("div",{class:"metric-label"},"Средний MDD",-1)),d("div",Bt,p(fl(h(il))),1)])])])])):u("",!0)]))}}),[["__scopeId","data-v-e15fa5f8"]]);export{Et as default};
