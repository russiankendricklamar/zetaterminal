import{usePortfolioStore as a}from"./portfolio-t34lcnLk.js";import{getRegimeStatistics as t,getTransitionMatrix as e,getChartData as l}from"./multivariateHmmService-Dguhgabg.js";import{d as s,r,o as i,v as d,c as n,C as v,e as c,F as o,i as u,n as h,t as b,f as g,k as x,j as f,q as p}from"./vendor-DLyKmMu8.js";import{_ as y}from"./index-AoYxWDki.js";import"./apiHeaders-DCeXWvJ_.js";const m={class:"page-container custom-scroll"},k={key:0,class:"loading-container"},w={key:1,class:"grid-3 mb-6"},_={class:"card-head"},F={class:"card-body"},z={class:"desc"},$={key:0,class:"metrics-table"},j={class:"m-row"},M={class:"m-row"},q={class:"m-row"},Q={class:"m-row"},R={class:"m-row"},A={class:"m-row"},B={class:"grid-2 mb-6"},P={class:"glass-card panel"},H={class:"heatmap-container"},T={key:0,class:"heatmap-grid"},C={class:"glass-card panel flex-col"},D={class:"table-wrapper"},I={class:"glass-table"},L={key:0},S={key:1},E={class:"pl-2"},G={class:"stationary"},J=y(s({__name:"RegimeDetails",setup(s){a();const y=r([]),J=r(null),K=r([]),N=r(!0);i(async()=>{try{const[a,s,r]=await Promise.all([t(),e(),l()]);y.value=a.statistics,J.value=s.transition_matrix,K.value=r.data,N.value=!1}catch(a){console.error("Ошибка загрузки данных режимов:",a),N.value=!1}});const O=d(()=>{if(!J.value)return[];let a=Array(J.value.length).fill(1/J.value.length);for(let t=0;t<100;t++){const t=J.value[0].map((t,e)=>a.reduce((a,t,l)=>a+t*J.value[l][e],0)),e=t.reduce((a,t)=>a+t,0);a=t.map(a=>a/e)}return a});d(()=>J.value?J.value.map((a,t)=>{const e=a[t];return e>=1?null:1/(1-e)}):[]);const U=a=>{if(!y.value[a])return null;const t=y.value[a],e=K.value.filter(t=>t.regime===a).length;return{days:e,frequency:e/K.value.length,meanReturn:t.mean.reduce((a,t)=>a+t,0)/t.mean.length,volatility:t.volatility_per_asset.reduce((a,t)=>a+t,0)/t.volatility_per_asset.length,persistence:t.persistence,duration:t.duration_days}},V=a=>["Стабильность","Падение","Рост","Коррекция","Восстановление"][a]||`Режим ${a}`,W=a=>{const t=["blue","red","green","orange","purple"];return t[a%t.length]},X=a=>{const t=["59, 130, 246","248, 113, 113","74, 222, 128","251, 191, 36","168, 85, 247"];return t[a%t.length]},Y=a=>{if(!J.value||!J.value.length)return[];const t=K.value.length>0?K.value[K.value.length-1].regime:0;let e=Array(J.value.length).fill(0);e[t]=1;for(let l=0;l<a;l++){const a=Array(J.value.length).fill(0);for(let t=0;t<J.value.length;t++)for(let l=0;l<J.value.length;l++)a[t]+=e[l]*J.value[l][t];e=a}return e};return(a,t)=>(p(),n("div",m,[t[14]||(t[14]=v('<div class="section-header" data-v-6751b809><div class="header-left" data-v-6751b809><h1 class="section-title" data-v-6751b809>Детальный анализ режимов</h1><p class="section-subtitle" data-v-6751b809>Метрики устойчивости, матрицы переходов и сценарное прогнозирование</p></div><div class="header-actions" data-v-6751b809><div class="glass-pill status-pill" data-v-6751b809><span class="status-label text-muted" data-v-6751b809>Данные: <b class="text-white" data-v-6751b809>01.11.2025</b></span></div></div></div>',1)),N.value?(p(),n("div",k,[...t[0]||(t[0]=[c("div",{class:"spinner-large"},null,-1),c("p",null,"Загрузка данных режимов...",-1)])])):(p(),n("div",w,[(p(!0),n(o,null,u(y.value,(a,e)=>{return p(),n("div",{key:e,class:h(["glass-card regime-card",`border-${W(e)}`])},[c("div",_,[c("span",{class:h(["dot",`bg-${W(e)}`])},null,2),c("h3",null,"Состояние "+b(e)+": "+b(V(e)),1)]),c("div",F,[c("p",z,b((l=e,["Динамическое равновесие без ярко выраженного направления. Рынок стабилизируется, волатильность минимальна.",'Фаза понижательного тренда с высокой волатильностью. "Липкое" состояние с короткими отскоками.',"Периоды возрастающего тренда. Систематический рост стоимости активов с умеренными колебаниями.","Коррекционная фаза после роста. Умеренное снижение с сохранением общей тенденции.","Фаза восстановления после падения. Постепенный возврат к равновесию."][l]||"Режим рыночной активности")),1),U(e)?(p(),n("div",$,[c("div",j,[t[1]||(t[1]=c("span",null,"Количество дней",-1)),c("strong",null,b(U(e).days),1)]),c("div",M,[t[2]||(t[2]=c("span",null,"Доля периода",-1)),c("strong",null,b((100*U(e).frequency).toFixed(1))+"%",1)]),c("div",q,[t[3]||(t[3]=c("span",null,"Ср. доходность",-1)),c("strong",{class:h(U(e).meanReturn>=0?"text-green":"text-red")},b((100*U(e).meanReturn).toFixed(3))+"% ",3)]),c("div",Q,[t[4]||(t[4]=c("span",null,"Волатильность",-1)),c("strong",null,b((100*U(e).volatility).toFixed(3))+"%",1)]),c("div",R,[t[5]||(t[5]=c("span",null,"Устойчивость",-1)),c("strong",null,b(U(e).persistence.toFixed(4)),1)]),c("div",A,[t[6]||(t[6]=c("span",null,"Ожид. длительность",-1)),c("strong",null,b(U(e).duration?U(e).duration.toFixed(1)+" дня":"∞"),1)])])):g("",!0)])],2);var l}),128))])),c("div",B,[c("div",P,[t[9]||(t[9]=c("div",{class:"panel-header"},[c("h3",null,"Матрица переходов")],-1)),c("div",H,[J.value?(p(),n("div",T,[t[7]||(t[7]=c("div",{class:"h-label"},"От \\ К",-1)),(p(!0),n(o,null,u(J.value.length,a=>(p(),n("div",{key:a,class:h(["h-col-header",`text-${W(a-1)}`])},b(V(a-1).substring(0,6)),3))),128)),(p(!0),n(o,null,u(J.value,(a,t)=>(p(),n(o,{key:t},[c("div",{class:h(["h-row-header",`text-${W(t)}`])},b(V(t).substring(0,6)),3),(p(!0),n(o,null,u(a,(a,t)=>(p(),n("div",{key:t,class:"h-cell",style:x({background:`rgba(${X(t)}, ${.8*a})`})},b(a.toFixed(2)),5))),128))],64))),128))])):g("",!0),t[8]||(t[8]=c("div",{class:"analysis-note mt-4"},[c("p",null,[f("• "),c("strong",null,"Стабильность"),f(" имеет наивысшую инерцию (0.96)."),c("br"),f("• Из "),c("strong",null,"Падения"),f(" выход в Рост (25%) вероятнее, чем в Стабильность (8%).")])],-1))])]),c("div",C,[t[12]||(t[12]=c("div",{class:"panel-header"},[c("h3",null,"Прогноз вероятностей"),c("span",{class:"sub-label"},[f("Начальное состояние: "),c("b",null,"Рост")])],-1)),c("div",D,[c("table",I,[J.value?(p(),n("thead",L,[c("tr",null,[t[10]||(t[10]=c("th",{class:"text-left pl-2"},"Горизонт",-1)),(p(!0),n(o,null,u(y.value,(a,t)=>(p(),n("th",{key:t,class:h([`text-${W(t)}`,"text-right"])}," P("+b(V(t).substring(0,4))+") ",3))),128))])])):g("",!0),J.value&&O.value.length>0?(p(),n("tbody",S,[(p(),n(o,null,u([1,5,10],a=>c("tr",{key:a},[c("td",E,b(a)+" "+b(1===a?"день":"дней"),1),(p(!0),n(o,null,u(Y(a),(a,t)=>(p(),n("td",{key:t,class:"text-right"},b((100*a).toFixed(1))+"% ",1))),128))])),64)),c("tr",G,[t[11]||(t[11]=c("td",{class:"pl-2 text-orange font-bold"},"∞ (Долгосрочный)",-1)),(p(!0),n(o,null,u(O.value,(a,t)=>(p(),n("td",{key:t,class:"text-right font-bold text-orange"},b((100*a).toFixed(1))+"% ",1))),128))])])):g("",!0)])]),t[13]||(t[13]=v('<div class="chart-mini mt-4" data-v-6751b809><div class="chart-label-sm" data-v-6751b809>Сходимость к стационарному состоянию</div><svg viewBox="0 0 400 60" class="svg-curves" data-v-6751b809><path d="M0,50 Q100,45 200,30 T400,10" fill="none" stroke="#3b82f6" stroke-width="2" data-v-6751b809></path><path d="M0,10 Q100,20 200,30 T400,45" fill="none" stroke="#4ade80" stroke-width="2" data-v-6751b809></path><line x1="0" y1="10" x2="400" y2="10" stroke="rgba(255,255,255,0.1)" stroke-dasharray="4" data-v-6751b809></line><line x1="0" y1="50" x2="400" y2="50" stroke="rgba(255,255,255,0.1)" stroke-dasharray="4" data-v-6751b809></line></svg></div>',1))])]),t[15]||(t[15]=v('<div class="grid-2 mb-6" data-v-6751b809><div class="glass-card panel" data-v-6751b809><div class="panel-header" data-v-6751b809><h3 data-v-6751b809>Распределение доходностей по режимам</h3></div><div class="chart-container-rect" data-v-6751b809><svg viewBox="0 0 600 250" class="svg-chart" data-v-6751b809><line x1="50" y1="220" x2="550" y2="220" stroke="rgba(255,255,255,0.1)" data-v-6751b809></line><line x1="300" y1="20" x2="300" y2="220" stroke="rgba(255,255,255,0.1)" stroke-dasharray="4" data-v-6751b809></line><path d="M150,220 Q300,-100 450,220" fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="2" data-v-6751b809></path><path d="M50,220 Q200,50 400,220" fill="rgba(248, 113, 113, 0.1)" stroke="#f87171" stroke-width="2" data-v-6751b809></path><path d="M200,220 Q380,50 500,220" fill="rgba(74, 222, 128, 0.1)" stroke="#4ade80" stroke-width="2" data-v-6751b809></path><text x="310" y="30" fill="#3b82f6" font-size="10" font-weight="600" data-v-6751b809>Стабильность (Низкая σ)</text><text x="100" y="100" fill="#f87171" font-size="10" font-weight="600" data-v-6751b809>Падение (Отрицательная μ)</text><text x="450" y="100" fill="#4ade80" font-size="10" font-weight="600" data-v-6751b809>Рост (Положительная μ)</text></svg></div><p class="chart-caption" data-v-6751b809>Распределение изменений доходностей. Режим «Падение» имеет &quot;толстый хвост&quot; слева.</p></div><div class="glass-card panel" data-v-6751b809><div class="panel-header" data-v-6751b809><h3 data-v-6751b809>Характеристики режимов (Волатильность vs Доходность)</h3></div><div class="chart-container-rect" data-v-6751b809><svg viewBox="0 0 500 250" class="svg-chart" data-v-6751b809><rect x="50" y="150" width="40" height="50" fill="#3b82f6" opacity="0.8" rx="4" data-v-6751b809></rect><rect x="100" y="195" width="40" height="5" fill="#3b82f6" opacity="0.3" rx="4" data-v-6751b809></rect><rect x="200" y="50" width="40" height="150" fill="#f87171" opacity="0.8" rx="4" data-v-6751b809></rect><rect x="250" y="200" width="40" height="40" fill="#f87171" opacity="0.3" rx="4" data-v-6751b809></rect><rect x="350" y="100" width="40" height="100" fill="#4ade80" opacity="0.8" rx="4" data-v-6751b809></rect><rect x="400" y="160" width="40" height="40" fill="#4ade80" opacity="0.3" rx="4" data-v-6751b809></rect><text x="95" y="240" fill="rgba(255,255,255,0.6)" text-anchor="middle" font-size="12" data-v-6751b809>Стабильность</text><text x="245" y="240" fill="rgba(255,255,255,0.6)" text-anchor="middle" font-size="12" data-v-6751b809>Падение</text><text x="395" y="240" fill="rgba(255,255,255,0.6)" text-anchor="middle" font-size="12" data-v-6751b809>Рост</text><rect x="340" y="20" width="10" height="10" fill="#fff" opacity="0.8" rx="2" data-v-6751b809></rect> <text x="360" y="30" fill="#fff" font-size="10" data-v-6751b809>Волатильность (σ)</text><rect x="340" y="40" width="10" height="10" fill="#fff" opacity="0.3" rx="2" data-v-6751b809></rect> <text x="360" y="50" fill="#fff" font-size="10" data-v-6751b809>Доходность (|μ|)</text></svg></div></div></div>',1))]))}}),[["__scopeId","data-v-6751b809"]]);export{J as default};
