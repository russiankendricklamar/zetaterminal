import{d as a,v as s,r as l,G as e,o as t,b as n,c,e as o,g as d,t as i,B as v,n as r,j as u,w as p,T as b,C as h,f as m,F as g,i as y,k,q as f,x as w,y as x,M as C}from"./vendor-DLyKmMu8.js";import{usePortfolioStore as M}from"./portfolio-t34lcnLk.js";import{_ as L}from"./index-Ba4DjugF.js";const U={class:"page-container custom-scroll"},_={class:"section-header"},j={class:"header-actions"},A={class:"glass-pill control-pill"},B={class:"text-white font-bold"},R={class:"text-white font-bold"},S={class:"dropdown-header"},$={class:"asset-list"},E=["value"],q={class:"asset-checkbox-content"},F={class:"asset-info"},Y={class:"asset-symbol"},N={class:"asset-name"},T={class:"asset-allocation"},V={class:"analysis-grid"},D={class:"charts-column"},G={class:"glass-card chart-container"},I={class:"chart-area big-chart"},K={viewBox:"0 0 1000 320",preserveAspectRatio:"none",class:"svg-chart"},P=["y1","y2"],z=["d","stroke"],H=["d"],J={class:"glass-card chart-container"},O={class:"panel-header"},Q={class:"legend"},W={class:"chart-area big-chart"},X={viewBox:"0 0 1000 320",preserveAspectRatio:"none",class:"svg-chart"},Z=["y1","y2"],aa=["d"],sa=["d","stroke","filter"],la=L(a({__name:"YieldAnalysis",setup(a){const L=M(),la=s(()=>L.selectedBank),ea=s(()=>L.positions),ta=l(!1),na=l(""),ca=l([]),oa=s(()=>{if(!na.value.trim())return ea.value;const a=na.value.toLowerCase();return ea.value.filter(s=>s.symbol.toLowerCase().includes(a)||s.name.toLowerCase().includes(a))}),da=s(()=>ea.value.filter(a=>ca.value.includes(a.symbol))),ia=l([]),va=l([]),ra=l({}),ua=()=>{if(0===ca.value.length)return void console.warn("No assets selected");const a=[],s=[];for(let e=0;e<50;e++){const l=[],t=[0];let n=0;for(let a=0;a<250;a++){let s=1;a>0&&Math.abs(l[a-1])>2&&(s=2.5);let c=2*(Math.random()-.5)*s;a>220&&Math.random()>.95&&48===e&&(c*=6),l.push(c),n+=c,t.push(n)}a.push(l),s.push(t)}ia.value=a,va.value=s;const l={};ca.value.forEach(a=>{const s=ea.value.find(s=>s.symbol===a);if(s){const e=a.includes("SU")||a.includes("RU000")||a.includes("обл"),t=s.allocation||0,n=s.dayChange||0,c=(e?.8:1.5)*(1+t/100),o=(e?.08:n/100*.5)*(1+Math.abs(n)/50);l[a]=pa(o,c)}}),ra.value=l},pa=(a,s)=>{const l=[0];let e=0;for(let t=0;t<250;t++)e+=(Math.random()-.5)*s+a,l.push(e);return l},ba=a=>`hsla(${137*a%360}, 70%, 75%, 0.6)`,ha=a=>{const s=ea.value.find(s=>s.symbol===a);return s?.color||"#3b82f6"},ma=()=>{ta.value=!ta.value,ta.value&&(na.value="")},ga=()=>{ca.value=oa.value.map(a=>a.symbol),ua()},ya=()=>{ca.value=[],ra.value={}},ka=()=>{ua()},fa=a=>{const s=a.target;s.closest(".asset-selector-pill")||s.closest(".asset-dropdown")||(ta.value=!1)},wa=()=>{if(ea.value.length>0){const a=[...ea.value].sort((a,s)=>s.allocation-a.allocation).slice(0,Math.min(5,ea.value.length)).map(a=>a.symbol);ca.value=a,ua()}};e(()=>L.positions,a=>{a.length>0&&(ca.value=ca.value.filter(s=>a.some(a=>a.symbol===s)),0===ca.value.length?wa():ua())},{deep:!0});const xa=(a,s,l)=>{if(!a||0===a.length)return"";return"M "+a.map((e,t)=>{return`${(s=>s/(a.length-1)*1e3)(t).toFixed(1)},${(n=e,320-(n-l)/(s-l)*320).toFixed(1)}`;var n}).join(" L ")};return t(()=>{document.addEventListener("click",fa),wa()}),n(()=>{document.removeEventListener("click",fa)}),(a,s)=>(f(),c("div",U,[o("div",_,[s[7]||(s[7]=o("div",{class:"header-left"},[o("h1",{class:"section-title"},"Анализ кривых доходности"),o("p",{class:"section-subtitle"},"Сценарное моделирование и стресс-тестирование (Monte Carlo)")],-1)),o("div",j,[o("div",A,[s[3]||(s[3]=o("span",{class:"lbl-mini"},"Банк:",-1)),o("span",B,i(la.value.name),1)]),o("div",{class:r(["glass-pill control-pill asset-selector-pill",{"is-open":ta.value}]),onClick:v(ma,["stop"])},[s[4]||(s[4]=o("span",{class:"lbl-mini"},"Активы:",-1)),o("span",R,i(ca.value.length>0?`${ca.value.length} выбрано`:"Не выбрано"),1),s[5]||(s[5]=o("svg",{class:"chevron",width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("path",{d:"M1 1L6 6L11 1"})],-1))],2),o("button",{class:"btn-glass",onClick:ua},[...s[6]||(s[6]=[o("span",{class:"icon"},"↻",-1),u(" Обновить симуляцию ",-1)])])]),d(b,{name:"dropdown-fade"},{default:p(()=>[ta.value?(f(),c("div",{key:0,class:"asset-dropdown",onClick:s[2]||(s[2]=v(()=>{},["stop"]))},[o("div",S,[w(o("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>na.value=a),placeholder:"Поиск активов...",class:"asset-search-input"},null,512),[[x,na.value]]),o("div",{class:"dropdown-actions"},[o("button",{onClick:ga,class:"btn-link-sm"},"Выбрать все"),o("button",{onClick:ya,class:"btn-link-sm"},"Снять все")])]),o("div",$,[(f(!0),c(g,null,y(oa.value,a=>(f(),c("label",{key:a.symbol,class:r(["asset-checkbox-item",{"is-selected":ca.value.includes(a.symbol)}])},[w(o("input",{type:"checkbox",value:a.symbol,"onUpdate:modelValue":s[1]||(s[1]=a=>ca.value=a),onChange:ka},null,40,E),[[C,ca.value]]),o("div",q,[o("span",{class:"asset-dot",style:k({background:a.color})},null,4),o("div",F,[o("span",Y,i(a.symbol),1),o("span",N,i(a.name),1)]),o("span",T,i(a.allocation)+"%",1)])],2))),128))])])):m("",!0)]),_:1})]),o("div",V,[o("div",D,[o("div",G,[s[10]||(s[10]=h('<div class="panel-header" data-v-3024ebc7><h3 data-v-3024ebc7>Ежедневные изменения</h3><div class="legend" data-v-3024ebc7><span class="l-item faded" data-v-3024ebc7><span class="dot bg-gray" data-v-3024ebc7></span> Сценарии</span><span class="l-item" data-v-3024ebc7><span class="dot bg-green" data-v-3024ebc7></span> Выбросы</span></div></div>',1)),o("div",I,[(f(),c("svg",K,[(f(),c(g,null,y(6,a=>o("line",{key:"g1-"+a,x1:"0",y1:50*a,x2:"1000",y2:50*a,stroke:"rgba(255,255,255,0.05)"},null,8,P)),64)),s[8]||(s[8]=o("line",{x1:"0",y1:"160",x2:"1000",y2:"160",stroke:"rgba(255,255,255,0.2)","stroke-dasharray":"4"},null,-1)),(f(!0),c(g,null,y(ia.value,(a,s)=>(f(),c("path",{key:"d-"+s,d:xa(a,12,-12),fill:"none",stroke:ba(s),"stroke-width":"0.8",opacity:"0.5",style:{"mix-blend-mode":"screen"}},null,8,z))),128)),ia.value.length?(f(),c("path",{key:0,d:xa(ia.value[48],12,-12),fill:"none",stroke:"#4ade80","stroke-width":"2",filter:"drop-shadow(0 0 4px rgba(74,222,128,0.5))"},null,8,H)):m("",!0)])),s[9]||(s[9]=o("div",{class:"chart-label"},"Симуляция волатильности (250 шагов)",-1))])]),o("div",J,[o("div",O,[s[11]||(s[11]=o("h3",null,"Накопленная доходность",-1)),o("div",Q,[(f(!0),c(g,null,y(da.value,a=>(f(),c("span",{key:a.symbol,class:"l-item"},[o("span",{class:"dot",style:k({background:a.color})},null,4),u(" "+i(a.symbol),1)]))),128))])]),o("div",W,[(f(),c("svg",X,[(f(),c(g,null,y(6,a=>o("line",{key:"g2-"+a,x1:"0",y1:50*a,x2:"1000",y2:50*a,stroke:"rgba(255,255,255,0.05)"},null,8,Z)),64)),s[12]||(s[12]=o("line",{x1:"0",y1:"160",x2:"1000",y2:"160",stroke:"rgba(255,255,255,0.2)","stroke-dasharray":"4"},null,-1)),(f(!0),c(g,null,y(va.value,(a,s)=>(f(),c("path",{key:"c-"+s,d:xa(a,50,-50),fill:"none",stroke:"rgba(255,255,255,0.05)","stroke-width":"1"},null,8,aa))),128)),(f(!0),c(g,null,y(ra.value,(a,s)=>(f(),c("path",{key:s,d:xa(a,50,-50),fill:"none",stroke:ha(s),"stroke-width":"3",filter:`drop-shadow(0 0 6px ${ha(s)}40)`},null,8,sa))),128))])),s[13]||(s[13]=o("div",{class:"chart-label"},"Долгосрочные тренды",-1))])])]),s[14]||(s[14]=h('<aside class="stats-column" data-v-3024ebc7><div class="glass-card sticky-panel" data-v-3024ebc7><div class="panel-header-sm" data-v-3024ebc7><h3 data-v-3024ebc7>Статистика волатильности</h3></div><div class="stat-list" data-v-3024ebc7><div class="stat-row" data-v-3024ebc7><span class="lbl" data-v-3024ebc7>Макс. дневное изменение</span><span class="val text-red font-mono" data-v-3024ebc7>+8.4%</span></div><div class="stat-row" data-v-3024ebc7><span class="lbl" data-v-3024ebc7>Возврат к среднему</span><span class="val font-mono" data-v-3024ebc7>0.45</span></div><div class="stat-row" data-v-3024ebc7><span class="lbl" data-v-3024ebc7>Kurtosis (Эксцесс)</span><span class="val text-orange font-mono" data-v-3024ebc7>5.2</span></div></div><div class="divider" data-v-3024ebc7></div><div class="panel-header-sm" data-v-3024ebc7><h3 data-v-3024ebc7>Параметры симуляции</h3></div><div class="stat-list" data-v-3024ebc7><div class="stat-row" data-v-3024ebc7><span class="lbl" data-v-3024ebc7>Количество сценариев</span><span class="val font-mono" data-v-3024ebc7>50</span></div><div class="stat-row" data-v-3024ebc7><span class="lbl" data-v-3024ebc7>Горизонт</span><span class="val font-mono" data-v-3024ebc7>250 дней</span></div><div class="stat-row" data-v-3024ebc7><span class="lbl" data-v-3024ebc7>Модель</span><span class="val font-mono text-blue" data-v-3024ebc7>—</span></div></div><div class="divider" data-v-3024ebc7></div><div class="info-block" data-v-3024ebc7><div class="info-item" data-v-3024ebc7><span class="icon" data-v-3024ebc7>PARAMS</span><p data-v-3024ebc7><strong data-v-3024ebc7>График 1</strong> визуализирует &quot;шум&quot; и кластеризацию волатильности. Зеленая линия выделяет экстремальный сценарий (tail risk).</p></div><div class="info-item mt-4" data-v-3024ebc7><span class="icon" data-v-3024ebc7>TRENDS</span><p data-v-3024ebc7><strong data-v-3024ebc7>График 2</strong> показывает интегральные траектории (накопленный итог), формирующие долгосрочные тренды US10Y и US02Y.</p></div></div></div></aside>',1))])]))}}),[["__scopeId","data-v-3024ebc7"]]);export{la as default};
