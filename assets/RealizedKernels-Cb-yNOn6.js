import{d as a,r as l,G as e,c as s,e as t,f as d,x as n,L as v,C as o,y as i,t as u,F as r,n as p,A as c,q as m}from"./vendor-DLyKmMu8.js";import{i as h}from"./index-BjvaFruF.js";import{g as b,_}from"./index-Ba4DjugF.js";const k={class:"rk-page"},g={class:"page-header"},y={class:"header-right"},V=["disabled"],f={key:0},x={key:1},R={class:"input-grid"},w={class:"panel"},j={class:"input-row"},S={class:"input-row"},K={key:0,class:"error-banner"},B={class:"kpi-grid"},T={class:"kpi-card"},z={class:"kpi-value"},F={class:"kpi-card"},H={class:"kpi-value"},M={class:"kpi-card"},L={class:"kpi-value"},N={class:"kpi-sub"},A={class:"kpi-card"},E={class:"kpi-value"},U={class:"kpi-card accent-card"},$={class:"kpi-value"},C={class:"kpi-sub"},O={class:"kpi-value"},J={class:"kpi-sub"},P={class:"results-grid"},q={class:"panel"},G={class:"stats-table"},Z={class:"mono"},I={class:"mono"},D={class:"mono"},Q={class:"mono"},W={class:"mono"},X={class:"mono"},Y={class:"mono"},aa={class:"mono"},la={class:"highlight-row"},ea={class:"mono"},sa={class:"mono accent"},ta={class:"stats-table"},da={class:"mono"},na={class:"mono"},va={class:"mono"},oa={class:"noise-info"},ia={class:"mono"},ua={class:"mono accent"},ra={class:"panel"},pa=_(a({__name:"RealizedKernels",setup(a){const _=l(""),pa=l("parzen"),ca=l(390),ma=l(null),ha=l(5),ba=l(!1),_a=l(""),ka=l(null),ga=l(null);let ya=null;const Va=a=>null!=a?(100*a).toFixed(2)+"%":"—",fa=a=>null==a?"—":a<.001?"<0.001":a.toFixed(3),xa=a=>null==a?"—":0===a?"0":a.toExponential(3),Ra=(a,l)=>a&&l?((a-l)/l*100).toFixed(1)+"%":"—",wa=(a,l)=>{if(!a||!l)return"";const e=(a-l)/l;return e>.02?"neg":e<-.02?"pos":""};async function ja(){_a.value="";const a=_.value.replace(/,/g," ").split(/\s+/).map(a=>a.trim()).filter(a=>a.length>0).map(a=>parseFloat(a)).filter(a=>!isNaN(a)&&a>0);if(a.length<10)_a.value="Нужно минимум 10 положительных значений цен";else{ba.value=!0;try{const l=await fetch("   https://stochastic-dashbord-v1-production.up.railway.app/api/realized-kernels/estimate",{method:"POST",headers:b(),body:JSON.stringify({prices:a,kernel:pa.value,bandwidth:ma.value||null,tsrv_scales:ha.value,annualize:!0,periods_per_day:ca.value})});if(!l.ok){const a=await l.json();throw new Error(a.detail||`HTTP ${l.status}`)}const e=await l.json();ka.value=e.result,await c(),Sa()}catch(l){_a.value=l.message||"Неизвестная ошибка"}finally{ba.value=!1}}}function Sa(){if(!ga.value||!ka.value)return;ya||(ya=h(ga.value,"dark"));const{steps:a,rv:l}=ka.value.signature_plot,e=ka.value.optimal_sampling_step;ka.value.rv_vol;const s=ka.value.rk_vol,t=ka.value.ann_factor,d=l.map(e=>Math.sqrt(Math.max(e/a[l.indexOf(e)],0)*t));ya.setOption({backgroundColor:"transparent",tooltip:{trigger:"axis",formatter:a=>`Шаг Δ = ${a[0].axisValue}<br/>RK Vol ≈ ${(100*a[0].value[1]).toFixed(2)}%`},xAxis:{type:"value",name:"Шаг дискретизации Δ",nameLocation:"middle",nameGap:28,axisLine:{lineStyle:{color:"#555"}}},yAxis:{type:"value",name:"Годовая vol",axisLabel:{formatter:a=>(100*a).toFixed(1)+"%"},axisLine:{lineStyle:{color:"#555"}}},series:[{type:"line",data:a.map((a,l)=>[a,d[l]]),lineStyle:{color:"#4e8ef7",width:2},showSymbol:!1,name:"RV(Δ)",markLine:{silent:!0,data:[{xAxis:e,lineStyle:{color:"#f5c518",type:"dashed",width:1.5},label:{formatter:`Δ*=${e}`,position:"insideEndTop"}},{yAxis:s,lineStyle:{color:"#2ecc71",type:"dashed",width:1.5},label:{formatter:`RK=${(100*s).toFixed(1)}%`,position:"insideEndBottom"}}]}}],grid:{left:65,right:20,top:20,bottom:45}})}return e(ka,()=>c(Sa)),(a,l)=>{return m(),s("div",k,[t("div",g,[l[7]||(l[7]=t("div",{class:"header-left"},[t("h1",{class:"page-title"},"Realized Kernels — Измерение волатильности"),t("p",{class:"page-subtitle"},"Оценщики RV, BV, TSRV, MSRV, RK с поправкой на рыночный микроструктурный шум")],-1)),t("div",y,[n(t("select",{"onUpdate:modelValue":l[0]||(l[0]=a=>pa.value=a),class:"control-select"},[...l[5]||(l[5]=[t("option",{value:"parzen"},"Parzen kernel",-1),t("option",{value:"tukey-hanning"},"Tukey-Hanning kernel",-1),t("option",{value:"bartlett"},"Bartlett kernel",-1)])],512),[[v,pa.value]]),n(t("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>ca.value=a),class:"control-select"},[...l[6]||(l[6]=[t("option",{value:390},"Минуты (390/день)",-1),t("option",{value:78},"5-мин (78/день)",-1),t("option",{value:26},"15-мин (26/день)",-1),t("option",{value:1},"Дневные",-1)])],512),[[v,ca.value]]),t("button",{onClick:ja,class:"btn-primary",disabled:ba.value},[ba.value?(m(),s("span",x,"↺ Считаю...")):(m(),s("span",f,"Рассчитать"))],8,V)])]),t("div",R,[t("div",w,[l[10]||(l[10]=t("div",{class:"panel-header"},[t("h3",null,"Ряд цен"),t("span",{class:"hint"},"Цены через запятую, пробел или перенос строки (обязательно > 0)")],-1)),n(t("textarea",{"onUpdate:modelValue":l[2]||(l[2]=a=>_.value=a),class:"data-textarea",placeholder:"100.00\n100.02\n99.98\n100.05\n...",rows:"8"},null,512),[[i,_.value]]),t("div",j,[l[8]||(l[8]=t("label",null,"Bandwidth H (RK):",-1)),n(t("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>ma.value=a),type:"number",min:"1",placeholder:"авто (n^3/5)",class:"param-input"},null,512),[[i,ma.value,void 0,{number:!0}]])]),t("div",S,[l[9]||(l[9]=t("label",null,"Масштабы K (TSRV):",-1)),n(t("input",{"onUpdate:modelValue":l[4]||(l[4]=a=>ha.value=a),type:"number",min:"2",max:"50",class:"param-input"},null,512),[[i,ha.value,void 0,{number:!0}]])])]),l[11]||(l[11]=o('<div class="panel" data-v-dd02b9de><div class="panel-header" data-v-dd02b9de><h3 data-v-dd02b9de>О методах</h3></div><div class="methods-desc" data-v-dd02b9de><div class="method-item" data-v-dd02b9de><span class="method-tag rv" data-v-dd02b9de>RV</span><span data-v-dd02b9de>Σ rᵢ² — наивный, смещён вверх при наличии шума</span></div><div class="method-item" data-v-dd02b9de><span class="method-tag bv" data-v-dd02b9de>BV</span><span data-v-dd02b9de>(π/2)·Σ|rᵢ||rᵢ₊₁| — устойчив к скачкам (BN-Shephard 2004)</span></div><div class="method-item" data-v-dd02b9de><span class="method-tag tsrv" data-v-dd02b9de>TSRV</span><span data-v-dd02b9de>Двухмасштабный RV — поправка на шум (Zhang et al. 2005)</span></div><div class="method-item" data-v-dd02b9de><span class="method-tag msrv" data-v-dd02b9de>MSRV</span><span data-v-dd02b9de>Многомасштабный RV — оптимальные веса (Zhang 2006)</span></div><div class="method-item" data-v-dd02b9de><span class="method-tag rk" data-v-dd02b9de>RK</span><span data-v-dd02b9de>γ₀ + 2Σ k(h/H)·γₕ — ядерный оценщик (BN et al. 2008)</span></div><div class="formula-box" data-v-dd02b9de><div class="formula" data-v-dd02b9de>RK = γ₀ + 2 Σ<sub data-v-dd02b9de>h=1</sub><sup data-v-dd02b9de>H</sup> k(h/(H+1)) · γₕ</div><div class="formula small" data-v-dd02b9de>γₕ = Σᵢ rᵢ · rᵢ₊ₕ  |  H ≈ n<sup data-v-dd02b9de>3/5</sup></div></div></div></div>',1))]),_a.value?(m(),s("div",K,u(_a.value),1)):d("",!0),ka.value?(m(),s(r,{key:1},[t("div",B,[t("div",T,[l[12]||(l[12]=t("div",{class:"kpi-label kpi-tag rv-tag"},"RV Vol",-1)),t("div",z,u(Va(ka.value.rv_vol)),1),l[13]||(l[13]=t("div",{class:"kpi-sub"},"Наивный (смещён)",-1))]),t("div",F,[l[14]||(l[14]=t("div",{class:"kpi-label kpi-tag bv-tag"},"BV Vol",-1)),t("div",H,u(Va(ka.value.bv_vol)),1),l[15]||(l[15]=t("div",{class:"kpi-sub"},"Jump-robust",-1))]),t("div",M,[l[16]||(l[16]=t("div",{class:"kpi-label kpi-tag tsrv-tag"},"TSRV Vol",-1)),t("div",L,u(Va(ka.value.tsrv_vol)),1),t("div",N,"K="+u(ka.value.tsrv_scales??ha.value),1)]),t("div",A,[l[17]||(l[17]=t("div",{class:"kpi-label kpi-tag msrv-tag"},"MSRV Vol",-1)),t("div",E,u(Va(ka.value.msrv_vol)),1),l[18]||(l[18]=t("div",{class:"kpi-sub"},"Multi-scale",-1))]),t("div",U,[l[19]||(l[19]=t("div",{class:"kpi-label kpi-tag rk-tag"},"RK Vol",-1)),t("div",$,u(Va(ka.value.rk_vol)),1),t("div",C,u(ka.value.kernel)+" H="+u(ka.value.bandwidth_used),1)]),t("div",{class:p(["kpi-card",ka.value.jump_test.has_jumps?"kpi-red":"kpi-green"])},[l[20]||(l[20]=t("div",{class:"kpi-label"},"Скачки",-1)),t("div",O,u(ka.value.jump_test.has_jumps?"Есть":"Нет"),1),t("div",J,"p = "+u(fa(ka.value.jump_test.p_value)),1)],2)]),t("div",P,[t("div",q,[l[36]||(l[36]=t("div",{class:"panel-header"},[t("h3",null,"Сравнение оценщиков")],-1)),t("table",G,[l[27]||(l[27]=t("thead",null,[t("tr",null,[t("th",null,"Оценщик"),t("th",null,"Σrᵢ² (raw)"),t("th",null,"Годовая vol"),t("th",null,"Отклонение от RK")])],-1)),t("tbody",null,[t("tr",null,[l[21]||(l[21]=t("td",null,[t("span",{class:"method-tag rv"},"RV")],-1)),t("td",Z,u(xa(ka.value.rv_raw)),1),t("td",I,u(Va(ka.value.rv_vol)),1),t("td",{class:p(["mono",wa(ka.value.rv_vol,ka.value.rk_vol)])},u(Ra(ka.value.rv_vol,ka.value.rk_vol)),3)]),t("tr",null,[l[22]||(l[22]=t("td",null,[t("span",{class:"method-tag bv"},"BV")],-1)),t("td",D,u(xa(ka.value.bv_raw)),1),t("td",Q,u(Va(ka.value.bv_vol)),1),t("td",{class:p(["mono",wa(ka.value.bv_vol,ka.value.rk_vol)])},u(Ra(ka.value.bv_vol,ka.value.rk_vol)),3)]),t("tr",null,[l[23]||(l[23]=t("td",null,[t("span",{class:"method-tag tsrv"},"TSRV")],-1)),t("td",W,u(xa(ka.value.tsrv_raw)),1),t("td",X,u(Va(ka.value.tsrv_vol)),1),t("td",{class:p(["mono",wa(ka.value.tsrv_vol,ka.value.rk_vol)])},u(Ra(ka.value.tsrv_vol,ka.value.rk_vol)),3)]),t("tr",null,[l[24]||(l[24]=t("td",null,[t("span",{class:"method-tag msrv"},"MSRV")],-1)),t("td",Y,u(xa(ka.value.msrv_raw)),1),t("td",aa,u(Va(ka.value.msrv_vol)),1),t("td",{class:p(["mono",wa(ka.value.msrv_vol,ka.value.rk_vol)])},u(Ra(ka.value.msrv_vol,ka.value.rk_vol)),3)]),t("tr",la,[l[25]||(l[25]=t("td",null,[t("span",{class:"method-tag rk"},"RK")],-1)),t("td",ea,u(xa(ka.value.rk_raw)),1),t("td",sa,u(Va(ka.value.rk_vol)),1),l[26]||(l[26]=t("td",{class:"mono"},"—",-1))])])]),l[37]||(l[37]=t("div",{class:"panel-header",style:{"margin-top":"16px"}},[t("h3",null,"Тест на скачки (BN-Shephard)")],-1)),t("table",ta,[t("tbody",null,[t("tr",null,[l[28]||(l[28]=t("td",null,"Компонент скачков",-1)),t("td",da,u(xa(ka.value.jump_test.jump_component)),1)]),t("tr",null,[l[29]||(l[29]=t("td",null,"Непрерывный компонент (BV)",-1)),t("td",na,u(xa(ka.value.jump_test.continuous_component)),1)]),t("tr",null,[l[30]||(l[30]=t("td",null,"Доля скачков (J/RV)",-1)),t("td",{class:p(["mono",ka.value.jump_test.ratio>.1?"neg":"pos"])},u(Va(ka.value.jump_test.ratio)),3)]),t("tr",null,[l[31]||(l[31]=t("td",null,"z-статистика",-1)),t("td",va,u((e=ka.value.jump_test.z_stat,e?.toFixed(2)??"—")),1)]),t("tr",null,[l[32]||(l[32]=t("td",null,"p-value",-1)),t("td",{class:p(["mono",ka.value.jump_test.has_jumps?"neg":"pos"])},u(fa(ka.value.jump_test.p_value)),3)]),t("tr",null,[l[33]||(l[33]=t("td",null,"Вывод",-1)),t("td",{class:p(ka.value.jump_test.has_jumps?"neg":"pos")},u(ka.value.jump_test.has_jumps?"Значимые скачки обнаружены":"Скачков не обнаружено"),3)])])]),t("div",oa,[l[34]||(l[34]=t("span",{class:"noise-label"},"Дисперсия шума ω²:",-1)),t("span",ia,u(xa(ka.value.noise_variance)),1),l[35]||(l[35]=t("span",{class:"noise-label",style:{"margin-left":"16px"}},"Оптимальный шаг дискретизации Δ*:",-1)),t("span",ua,u(ka.value.optimal_sampling_step),1)])]),t("div",ra,[l[38]||(l[38]=t("div",{class:"panel-header"},[t("h3",null,"Сигнатурный график"),t("span",{class:"hint"},"RV(Δ) vs шаг дискретизации — рост при малых Δ свидетельствует о микроструктурном шуме")],-1)),t("div",{ref_key:"sigChartEl",ref:ga,class:"chart-container"},null,512)])])],64)):d("",!0)]);var e}}}),[["__scopeId","data-v-dd02b9de"]]);export{pa as default};
