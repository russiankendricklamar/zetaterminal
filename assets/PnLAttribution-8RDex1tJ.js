import{d as a,r as e,v as l,o as s,R as t,c as i,e as o,x as n,L as c,C as r,n as d,t as v,F as u,i as m,q as p}from"./vendor-DLyKmMu8.js";import{C as g}from"./auto-DlDBEVoY.js";import{_ as b}from"./index-AoYxWDki.js";const h={class:"pnl-attribution-page"},y={class:"page-header"},k={class:"header-right"},x={class:"control-group"},L={class:"control-group"},P={class:"pnl-summary"},w={class:"summary-card total"},f={class:"summary-change"},C={class:"summary-card"},F={class:"summary-value accent"},R={class:"summary-change"},T={class:"summary-card"},V={class:"summary-change"},D={class:"summary-card"},S={class:"summary-change"},O={class:"summary-card"},U={class:"summary-change"},A={class:"grid-2"},G={class:"card"},M={class:"chart-container"},I={class:"card"},B={class:"chart-container"},_={class:"card full-width"},j={class:"table-container"},Y={class:"attribution-table"},E={class:"col-component"},X={class:"col-percent mono"},W={class:"col-description"},q={class:"col-bucket"},N={class:"total-row"},$={class:"grid-3"},K={class:"card"},z={class:"greek-breakdown"},H={class:"breakdown-item"},J={class:"breakdown-item"},Q={class:"breakdown-item"},Z={class:"breakdown-item total"},aa={class:"value accent"},ea={class:"card"},la={class:"greek-breakdown"},sa={class:"breakdown-item"},ta={class:"breakdown-item"},ia={class:"breakdown-item"},oa={class:"breakdown-item total"},na={class:"value blue"},ca={class:"card"},ra={class:"greek-breakdown"},da={class:"breakdown-item"},va={class:"breakdown-item"},ua={class:"breakdown-item"},ma={class:"breakdown-item total"},pa={class:"value cyan"},ga={class:"card full-width"},ba={class:"chart-container tall"},ha={class:"card full-width"},ya={class:"table-container"},ka={class:"risk-factor-table"},xa={class:"factor-name"},La={class:"exposure mono"},Pa={class:"explained mono"},wa={class:"grid-2"},fa={class:"card"},Ca={class:"unexplained-metrics"},Fa={class:"metric-item"},Ra={class:"metric-item"},Ta={class:"value mono"},Va={class:"card"},Da={class:"top-positions"},Sa={class:"position-rank"},Oa={class:"position-info"},Ua={class:"position-name"},Aa={class:"position-detail"},Ga=b(a({__name:"PnLAttribution",setup(a){const b=e("day"),Ga=e("greeks"),Ma=e({market:125400,gamma:28500,theta:-12300,vega:18200,other:-5200}),Ia=l(()=>Object.values(Ma.value).reduce((a,e)=>a+e,0)),Ba=l(()=>Ia.value/1e6*100),_a=e({delta:{rates:85e3,curve:32e3,twist:8400},gamma:{price:22e3,vol:5500,cross:1e3},vega:18200,rho:8500,other:-5200}),ja=e([{id:1,component:"Δ - Rate Moves (parallel shift)",amount:85e3,percentage:32.5,description:"Sensitivity to parallel shift in yield curve",category:"Directional",type:"delta"},{id:2,component:"Δ - Curve Shift",amount:32e3,percentage:12.2,description:"Steepening/Flattening contribution",category:"Directional",type:"delta"},{id:3,component:"Δ - Curve Twist",amount:8400,percentage:3.2,description:"Butterfly and higher order effects",category:"Directional",type:"delta"},{id:4,component:"Γ - Price Gamma",amount:22e3,percentage:8.4,description:"Rebalancing/convexity gains from rate moves",category:"Convexity",type:"gamma"},{id:5,component:"Γ - Vol Gamma",amount:5500,percentage:2.1,description:"Vol-related second order effects",category:"Convexity",type:"gamma"},{id:6,component:"Θ - Theta Decay",amount:-12300,percentage:-4.7,description:"Time value decay (daily)",category:"Time Value",type:"theta"},{id:7,component:"V - Vega",amount:18200,percentage:6.9,description:"Volatility level changes",category:"Vol",type:"vega"},{id:8,component:"ρ - Rho",amount:8500,percentage:3.2,description:"Credit spread and rate correlation moves",category:"Spread",type:"rho"},{id:9,component:"Other/FX",amount:-5200,percentage:-2,description:"FX moves, dividends, other factors",category:"Other",type:"other"}]),Ya=e([{id:1,name:"Yield Curve (2Y-10Y)",move:15,exposure:4.25,impliedPnL:63750,actualPnL:68200,explained:96.3},{id:2,name:"Volatility (Swaption)",move:2.5,exposure:7200,impliedPnL:18e3,actualPnL:16800,explained:93.3},{id:3,name:"Credit Spread (IG)",move:-8,exposure:-2150,impliedPnL:-17200,actualPnL:-15600,explained:90.7},{id:4,name:"EUR/USD FX",move:.5,exposure:12e3,impliedPnL:6e3,actualPnL:5800,explained:96.7},{id:5,name:"Equity Index",move:1.2,exposure:800,impliedPnL:960,actualPnL:850,explained:88.5}]),Ea=l(()=>{const a=Ya.value.reduce((a,e)=>a+e.actualPnL,0);return Ia.value-a}),Xa=e([{name:"Long IRS 5Y",asset:"RUB RUONIA",pnl:85400},{name:"Short Bonds",asset:"ОФЗ",pnl:42300},{name:"Long Swaptions",asset:"Payer Swaption 2Yx5Y",pnl:28500},{name:"CDS Protection",asset:"IG Index",pnl:18200},{name:"Basis Swap",asset:"3M vs 6M",pnl:12e3}]),Wa=e(null),qa=e(null),Na=e(null);let $a=null,Ka=null,za=null;const Ha=a=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),Ja=a=>Math.abs(a)>=1e6?(a/1e6).toFixed(1)+"М":"$"+(a/1e3).toFixed(0)+"K",Qa=()=>{ae()},Za=()=>{const a=[["P&L Attribution Report",b.value],[""],["Component","Amount","% of Total"],...ja.value.map(a=>[a.component,a.amount,a.percentage]),["TOTAL",Ia.value,"100.0"]].map(a=>a.join(",")).join("\n"),e=new Blob([a],{type:"text/csv"}),l=window.URL.createObjectURL(e),s=document.createElement("a");s.href=l,s.download=`pnl-attribution-${(new Date).toISOString()}.csv`,s.click()},ae=()=>{$a&&$a.destroy(),Ka&&Ka.destroy(),za&&za.destroy(),Wa.value?.getContext("2d")&&($a=new g(Wa.value.getContext("2d"),{type:"doughnut",data:{labels:["Market P&L","Gamma","Vega","Theta","Other"],datasets:[{data:[Ma.value.market,Ma.value.gamma,Ma.value.vega,Math.abs(Ma.value.theta),Math.abs(Ma.value.other)],backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(34, 197, 94, 0.8)","rgba(56, 189, 248, 0.8)","rgba(168, 85, 247, 0.8)","rgba(248, 113, 113, 0.8)"],borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"rgba(255,255,255,0.6)"},position:"right"}}}})),qa.value?.getContext("2d")&&(Ka=new g(qa.value.getContext("2d"),{type:"bar",data:{labels:["Mon","Tue","Wed","Thu","Fri"],datasets:[{label:"Delta",data:[85,92,78,101,95],backgroundColor:"rgba(59, 130, 246, 0.6)"},{label:"Gamma",data:[22,18,24,32,28],backgroundColor:"rgba(34, 197, 94, 0.6)"},{label:"Vega",data:[15,12,18,16,20],backgroundColor:"rgba(56, 189, 248, 0.6)"},{label:"Theta",data:[-12,-12,-12,-12,-12],backgroundColor:"rgba(168, 85, 247, 0.6)"}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:void 0,scales:{x:{stacked:!1,grid:{display:!1},ticks:{color:"rgba(255,255,255,0.3)"}},y:{stacked:!1,grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)"}}},plugins:{legend:{labels:{color:"rgba(255,255,255,0.6)"}}}}})),Na.value?.getContext("2d")&&(za=new g(Na.value.getContext("2d"),{type:"bar",data:{labels:["Start","Delta","Gamma","Vega","Theta","Other","End"],datasets:[{label:"Cumulative P&L",data:[0,85e3,28500,18200,-12300,-5200,114200],backgroundColor:["rgba(255,255,255,0.1)","rgba(34, 197, 94, 0.6)","rgba(34, 197, 94, 0.6)","rgba(34, 197, 94, 0.6)","rgba(248, 113, 113, 0.6)","rgba(248, 113, 113, 0.6)","rgba(59, 130, 246, 0.8)"],borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{grid:{display:!1},ticks:{color:"rgba(255,255,255,0.3)"}},y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"rgba(255,255,255,0.3)"}}},plugins:{legend:{display:!1}}}}))};return s(()=>{ae()}),t(()=>{$a&&$a.destroy(),Ka&&Ka.destroy(),za&&za.destroy()}),(a,e)=>(p(),i("div",h,[o("div",y,[e[6]||(e[6]=o("div",{class:"header-left"},[o("h1",{class:"page-title"},"Разложение P&L"),o("p",{class:"page-subtitle"},"Разложение прибыли по источникам и факторам риска")],-1)),o("div",k,[o("div",x,[e[3]||(e[3]=o("label",{class:"control-label"},"Период:",-1)),n(o("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),class:"period-select",onChange:Qa},[...e[2]||(e[2]=[r('<option value="day" data-v-5db96ab4>Сегодня</option><option value="week" data-v-5db96ab4>Неделя</option><option value="month" data-v-5db96ab4>Месяц</option><option value="ytd" data-v-5db96ab4>YTD</option><option value="year" data-v-5db96ab4>Год</option>',5)])],544),[[c,b.value]])]),o("div",L,[e[5]||(e[5]=o("label",{class:"control-label"},"Метод:",-1)),n(o("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>Ga.value=a),class:"method-select",onChange:Qa},[...e[4]||(e[4]=[o("option",{value:"greeks"},"Разложение по грекам",-1),o("option",{value:"riskfactors"},"Факторы риска",-1),o("option",{value:"positions"},"По позициям",-1)])],544),[[c,Ga.value]])]),o("button",{onClick:Za,class:"btn-secondary"}," Экспортировать ")])]),o("div",P,[o("div",w,[e[7]||(e[7]=o("div",{class:"summary-label"},"Общий P&L",-1)),o("div",{class:d(["summary-value",Ia.value>=0?"positive":"negative"])},v(Ha(Ia.value)),3),o("div",f,v(Ia.value/Math.abs(Ia.value||1)>0?"↑":"↓")+" "+v(Math.abs(Ba.value).toFixed(2))+"% ",1)]),o("div",C,[e[8]||(e[8]=o("div",{class:"summary-label"},"Рыночный P&L",-1)),o("div",F,v(Ha(Ma.value.market)),1),o("div",R,v((Ma.value.market/Ia.value*100).toFixed(1))+"% от общего ",1)]),o("div",T,[e[9]||(e[9]=o("div",{class:"summary-label"},"Theta (убыль времени)",-1)),o("div",{class:d(["summary-value",Ma.value.theta>=0?"positive":"negative"])},v(Ha(Ma.value.theta)),3),o("div",V,v((Ma.value.theta/Ia.value*100).toFixed(1))+"% от общего ",1)]),o("div",D,[e[10]||(e[10]=o("div",{class:"summary-label"},"Gamma P&L",-1)),o("div",{class:d(["summary-value",Ma.value.gamma>=0?"positive":"negative"])},v(Ha(Ma.value.gamma)),3),o("div",S,v((Ma.value.gamma/Ia.value*100).toFixed(1))+"% от общего ",1)]),o("div",O,[e[11]||(e[11]=o("div",{class:"summary-label"},"Vega P&L",-1)),o("div",{class:d(["summary-value",Ma.value.vega>=0?"positive":"negative"])},v(Ha(Ma.value.vega)),3),o("div",U,v((Ma.value.vega/Ia.value*100).toFixed(1))+"% от общего ",1)])]),o("div",A,[o("div",G,[e[12]||(e[12]=o("div",{class:"chart-header"},[o("h3",null,"Состав P&L"),o("span",{class:"chart-subtitle"},"Доля каждого компонента")],-1)),o("div",M,[o("canvas",{ref_key:"compositionChartRef",ref:Wa},null,512)])]),o("div",I,[e[13]||(e[13]=o("div",{class:"chart-header"},[o("h3",null,"Разложение P&L по дням"),o("span",{class:"chart-subtitle"},"Разложение по дням")],-1)),o("div",B,[o("canvas",{ref_key:"dailyAttributionRef",ref:qa},null,512)])])]),o("div",_,[e[18]||(e[18]=o("div",{class:"card-header"},[o("h3",null,"Детальное разложение P&L"),o("span",{class:"card-subtitle"},"Разложение по грекам и факторам риска")],-1)),o("div",j,[o("table",Y,[e[17]||(e[17]=o("thead",null,[o("tr",null,[o("th",{class:"col-component"},"Компонент"),o("th",{class:"col-amount"},"Сумма (М RUB)"),o("th",{class:"col-percent"},"% от общего"),o("th",{class:"col-description"},"Описание"),o("th",{class:"col-bucket"},"Категория")])],-1)),o("tbody",null,[(p(!0),i(u,null,m(ja.value,a=>(p(),i("tr",{key:a.id,class:d(a.type)},[o("td",E,v(a.component),1),o("td",{class:d(["col-amount",a.amount>=0?"positive":"negative"])},v(a.amount>=0?"+":"")+v(Ja(a.amount)),3),o("td",X,v(a.percentage.toFixed(1))+"%",1),o("td",W,v(a.description),1),o("td",q,v(a.category),1)],2))),128))]),o("tfoot",null,[o("tr",N,[e[14]||(e[14]=o("td",{class:"col-component"},[o("strong",null,"TOTAL")],-1)),o("td",{class:d(["col-amount",Ia.value>=0?"positive":"negative"])},[o("strong",null,v(Ia.value>=0?"+":"")+v(Ja(Ia.value)),1)],2),e[15]||(e[15]=o("td",{class:"col-percent mono"},[o("strong",null,"100.0%")],-1)),e[16]||(e[16]=o("td",{colspan:"2"},null,-1))])])])])]),o("div",$,[o("div",K,[e[23]||(e[23]=o("div",{class:"card-header"},[o("h3",null,"Δ (Delta) P&L"),o("span",{class:"card-subtitle"},"Directional risk exposure")],-1)),o("div",z,[o("div",H,[e[19]||(e[19]=o("span",{class:"label"},"Движения ставок",-1)),o("span",{class:d(["value",_a.value.delta.rates>=0?"positive":"negative"])},v(_a.value.delta.rates>=0?"+":"")+v(Ja(_a.value.delta.rates)),3)]),o("div",J,[e[20]||(e[20]=o("span",{class:"label"},"Сдвиг кривой",-1)),o("span",{class:d(["value",_a.value.delta.curve>=0?"positive":"negative"])},v(_a.value.delta.curve>=0?"+":"")+v(Ja(_a.value.delta.curve)),3)]),o("div",Q,[e[21]||(e[21]=o("span",{class:"label"},"Скручивание кривой",-1)),o("span",{class:d(["value",_a.value.delta.twist>=0?"positive":"negative"])},v(_a.value.delta.twist>=0?"+":"")+v(Ja(_a.value.delta.twist)),3)]),o("div",Z,[e[22]||(e[22]=o("span",{class:"label"},"Δ Total",-1)),o("span",aa,v(_a.value.delta.rates+_a.value.delta.curve+_a.value.delta.twist>=0?"+":"")+" "+v(Ja(_a.value.delta.rates+_a.value.delta.curve+_a.value.delta.twist)),1)])])]),o("div",ea,[e[28]||(e[28]=o("div",{class:"card-header"},[o("h3",null,"Γ (Gamma) P&L"),o("span",{class:"card-subtitle"},"Прибыли/убытки от конвергентности")],-1)),o("div",la,[o("div",sa,[e[24]||(e[24]=o("span",{class:"label"},"Gamma цены",-1)),o("span",{class:d(["value",_a.value.gamma.price>=0?"positive":"negative"])},v(_a.value.gamma.price>=0?"+":"")+v(Ja(_a.value.gamma.price)),3)]),o("div",ta,[e[25]||(e[25]=o("span",{class:"label"},"Gamma волатильности",-1)),o("span",{class:d(["value",_a.value.gamma.vol>=0?"positive":"negative"])},v(_a.value.gamma.vol>=0?"+":"")+v(Ja(_a.value.gamma.vol)),3)]),o("div",ia,[e[26]||(e[26]=o("span",{class:"label"},"Перекрёстная gamma",-1)),o("span",{class:d(["value",_a.value.gamma.cross>=0?"positive":"negative"])},v(_a.value.gamma.cross>=0?"+":"")+v(Ja(_a.value.gamma.cross)),3)]),o("div",oa,[e[27]||(e[27]=o("span",{class:"label"},"Γ Total",-1)),o("span",na,v(_a.value.gamma.price+_a.value.gamma.vol+_a.value.gamma.cross>=0?"+":"")+" "+v(Ja(_a.value.gamma.price+_a.value.gamma.vol+_a.value.gamma.cross)),1)])])]),o("div",ca,[e[33]||(e[33]=o("div",{class:"card-header"},[o("h3",null,"V (Vega) & Other"),o("span",{class:"card-subtitle"},"Волатильность и остаточные")],-1)),o("div",ra,[o("div",da,[e[29]||(e[29]=o("span",{class:"label"},"Vega (движения vol)",-1)),o("span",{class:d(["value",_a.value.vega>=0?"positive":"negative"])},v(_a.value.vega>=0?"+":"")+v(Ja(_a.value.vega)),3)]),o("div",va,[e[30]||(e[30]=o("span",{class:"label"},"Rho (ставка/кредит)",-1)),o("span",{class:d(["value",_a.value.rho>=0?"positive":"negative"])},v(_a.value.rho>=0?"+":"")+v(Ja(_a.value.rho)),3)]),o("div",ua,[e[31]||(e[31]=o("span",{class:"label"},"Other/FX",-1)),o("span",{class:d(["value",_a.value.other>=0?"positive":"negative"])},v(_a.value.other>=0?"+":"")+v(Ja(_a.value.other)),3)]),o("div",ma,[e[32]||(e[32]=o("span",{class:"label"},"V Total",-1)),o("span",pa,v(_a.value.vega+_a.value.rho+_a.value.other>=0?"+":"")+" "+v(Ja(_a.value.vega+_a.value.rho+_a.value.other)),1)])])])]),o("div",ga,[e[34]||(e[34]=o("div",{class:"chart-header"},[o("h3",null,"Водопад P&L"),o("span",{class:"chart-subtitle"},"Траектория накопления P&L с начала периода")],-1)),o("div",ba,[o("canvas",{ref_key:"waterfallChartRef",ref:Na},null,512)])]),o("div",ha,[e[37]||(e[37]=o("div",{class:"card-header"},[o("h3",null,"Разложение по факторам риска"),o("span",{class:"card-subtitle"},"P&L по экономическим факторам")],-1)),o("div",ya,[o("table",ka,[e[35]||(e[35]=o("thead",null,[o("tr",null,[o("th",null,"Фактор риска"),o("th",null,"Движение рынка"),o("th",null,"Экспозиция позиции"),o("th",null,"Подразумеваемый P&L"),o("th",null,"Фактический P&L"),o("th",null,"Объяснено %")])],-1)),o("tbody",null,[(p(!0),i(u,null,m(Ya.value,a=>(p(),i("tr",{key:a.id},[o("td",xa,v(a.name),1),o("td",{class:d(["move",a.move>=0?"positive":"negative"])},v(a.move>=0?"+":"")+v(a.move.toFixed(2)),3),o("td",La,v(a.exposure.toFixed(1)),1),o("td",{class:d(["pnl",a.impliedPnL>=0?"positive":"negative"])},v(a.impliedPnL>=0?"+":"")+v(Ja(a.impliedPnL)),3),o("td",{class:d(["pnl",a.actualPnL>=0?"positive":"negative"])},v(a.actualPnL>=0?"+":"")+v(Ja(a.actualPnL)),3),o("td",Pa,v(a.explained.toFixed(1))+"%",1)]))),128))]),e[36]||(e[36]=o("tfoot",null,[o("tr",{class:"total-row"},[o("td",null,[o("strong",null,"TOTAL")]),o("td",{colspan:"5"})])],-1))])])]),o("div",wa,[o("div",fa,[e[41]||(e[41]=o("div",{class:"card-header"},[o("h3",null,"Необъяснённый P&L"),o("span",{class:"card-subtitle"},"P&L не объяснённый факторами")],-1)),o("div",Ca,[o("div",Fa,[e[38]||(e[38]=o("span",{class:"label"},"Всего необъяснённого",-1)),o("span",{class:d(["value",Ea.value>=0?"positive":"negative"])},v(Ea.value>=0?"+":"")+v(Ja(Ea.value)),3)]),o("div",Ra,[e[39]||(e[39]=o("span",{class:"label"},"% от общего P&L",-1)),o("span",Ta,v((Math.abs(Ea.value)/Math.abs(Ia.value)*100).toFixed(1))+"%",1)]),e[40]||(e[40]=o("div",{class:"metric-item"},[o("span",{class:"label"},"Вероятные причины"),o("ul",{class:"causes-list"},[o("li",null,"• Проскальзывание спреда bid-ask"),o("li",null,"• Время исполнения"),o("li",null,"• Изменения корреляции"),o("li",null,"• Начисление дивидендов/купонов")])],-1))])]),o("div",Va,[e[42]||(e[42]=o("div",{class:"card-header"},[o("h3",null,"Топ вкладчиков в P&L"),o("span",{class:"card-subtitle"},"5 позиций с максимальным вкладом")],-1)),o("div",Da,[(p(!0),i(u,null,m(Xa.value,(a,e)=>(p(),i("div",{key:e,class:"position-item"},[o("div",Sa,v(e+1),1),o("div",Oa,[o("span",Ua,v(a.name),1),o("span",Aa,v(a.asset),1)]),o("div",{class:d(["position-pnl",a.pnl>=0?"positive":"negative"])},v(a.pnl>=0?"+":"")+v(Ja(a.pnl)),3)]))),128))])])]),e[43]||(e[43]=o("div",{class:"page-footer"},[o("span",null,"• Метод: Greeks Decomposition (DCF-based)"),o("span",null,"• Обновление: В реальном времени"),o("span",null,"• Базовая валюта: RUB")],-1))]))}}),[["__scopeId","data-v-5db96ab4"]]);export{Ga as default};
