import{d as a,r as e,v as l,G as t,c as s,e as i,f as r,x as o,L as n,y as c,j as d,t as u,F as p,n as v,i as h,A as m,q as f}from"./vendor-DLyKmMu8.js";import{i as g}from"./index-BjvaFruF.js";import{g as y,_}from"./index-Ba4DjugF.js";const b={class:"alpha-page"},k={class:"card input-card"},x={class:"form-grid"},w={class:"form-group"},C={class:"form-group"},I={class:"form-group"},S={class:"form-group",style:{"margin-bottom":"16px"}},F={class:"form-group",style:{"margin-bottom":"16px"}},A={key:0,class:"parse-info"},R={key:1,class:"parse-error"},$={class:"actions"},L=["disabled"],j={key:0,class:"error-msg"},N={class:"kpi-grid"},O={class:"kpi-card highlight"},V={class:"kpi-card highlight"},T={class:"kpi-card"},z={class:"kpi-value danger-val"},M={class:"kpi-card"},q={class:"kpi-value ok-val"},U={class:"kpi-card"},G={class:"kpi-value"},D={class:"kpi-card"},P={class:"kpi-value"},B={class:"kpi-sub"},E={class:"charts-row"},Q={class:"card chart-card"},H={class:"card chart-card"},J={class:"charts-row"},K={class:"card chart-card"},W={class:"card chart-card"},X={class:"card"},Y={class:"card"},Z={class:"card"},aa={class:"stats-table"},ea={class:"weight-col"},la=_(a({__name:"AlphaStacking",setup(a){const _=e({ortho_method:"sequential",shrinkage:.3}),la=e("1,5,10,21"),ta=e(""),sa=e(""),ia=e(!1),ra=e(""),oa=e(null),na=e(null),ca=e(null),da=e(null),ua=e(null),pa=e(null),va=e(null);let ha=[];const ma=l(()=>{if(!sa.value.trim())return{data:null,error:""};const a=sa.value.trim().split("\n").filter(a=>a.trim());if(0===a.length)return{data:null,error:""};const e=[];for(const o of a){const a=o.split(",").map(a=>parseFloat(a.trim()));if(a.some(isNaN))return{data:null,error:`Не удалось разобрать: "${o}"`};if(a.length<4)return{data:null,error:"Нужно минимум 4 столбца: period, asset, signal, fwd_return"};e.push({t:a[0],a:a[1],signals:a.slice(2,-1),fwd:a[a.length-1]})}const l=Math.max(...e.map(a=>a.t))+1,t=Math.max(...e.map(a=>a.a))+1,s=e[0].signals.length;if(s<2)return{data:null,error:"Нужно минимум 2 сигнала"};if(l<10)return{data:null,error:`Нужно минимум 10 периодов, получено ${l}`};const i=Array.from({length:l},()=>Array.from({length:t},()=>Array(s).fill(0))),r=Array.from({length:l},()=>Array(t).fill(0));for(const o of e)o.t<l&&o.a<t&&(i[o.t][o.a]=o.signals,r[o.t][o.a]=o.fwd);return{data:{panel_signals:i,panel_fwd_returns:r,T:l,N_a:t,N_s:s},error:""}}),fa=l(()=>{if(!ma.value.data)return"";const{T:a,N_a:e,N_s:l}=ma.value.data;return`Распознано: ${a} периодов × ${e} активов × ${l} сигналов`}),ga=l(()=>ma.value.error);function ya(){const a=[];let e=1234;const l=()=>(e=1664525*e+1013904223&2147483647,e/2147483647*2-1);for(let t=0;t<40;t++)for(let e=0;e<8;e++){const s=.02*l(),i=Array.from({length:4},(a,e)=>(s*(.6+.1*e)+.1*l()).toFixed(4)),r=(.5*s+.01*l()).toFixed(5);a.push([t,e,...i,r].join(","))}sa.value=a.join("\n"),ta.value="Momentum,Reversal,Quality,Value"}async function _a(){if(!ma.value.data)return;ia.value=!0,ra.value="",oa.value=null;const a=la.value.split(",").map(a=>parseInt(a.trim())).filter(a=>!isNaN(a)&&a>0),e=ta.value.trim()?ta.value.split(",").map(a=>a.trim()):void 0;try{const l=await fetch("   https://stochastic-dashbord-v1-production.up.railway.app/api/alpha-stacking/analyze",{method:"POST",headers:{"Content-Type":"application/json",...y()},body:JSON.stringify({panel_signals:ma.value.data.panel_signals,panel_fwd_returns:ma.value.data.panel_fwd_returns,signal_names:e,ortho_method:_.value.ortho_method,ic_horizons:a,shrinkage:_.value.shrinkage})});if(!l.ok){const a=await l.json();throw new Error(a.detail||`HTTP ${l.status}`)}const t=await l.json();oa.value=t.result,await m(),ka()}catch(l){ra.value=l.message}finally{ia.value=!1}}function ba(a){if(!a)return null;const e=g(a,"dark");return ha.push(e),e}function ka(){ha.forEach(a=>a.dispose()),ha=[],function(){const a=ba(na.value);if(!a)return;const e=oa.value.signal_stats.map(a=>a.name),l=oa.value.signal_stats.map(a=>+(100*a.raw_ic).toFixed(3)),t=oa.value.signal_stats.map(a=>+(100*a.ortho_ic).toFixed(3)),s=oa.value.signal_stats.map(a=>+a.raw_ir.toFixed(3)),i=oa.value.signal_stats.map(a=>+a.ortho_ir.toFixed(3));a.setOption({backgroundColor:"transparent",tooltip:{trigger:"axis"},legend:{top:5,textStyle:{color:"#aaa"}},xAxis:{type:"category",data:e,axisLabel:{color:"#aaa"}},yAxis:[{name:"IC (%)",splitLine:{lineStyle:{color:"#333"}}},{name:"IR",splitLine:{show:!1}}],series:[{name:"IC raw",type:"bar",data:l,itemStyle:{color:"#5b8af5",opacity:.6}},{name:"IC ortho",type:"bar",data:t,itemStyle:{color:"#5b8af5"}},{name:"IR raw",type:"line",yAxisIndex:1,data:s,lineStyle:{type:"dashed"},itemStyle:{color:"#f5a623"}},{name:"IR ortho",type:"line",yAxisIndex:1,data:i,itemStyle:{color:"#4caf72"}}],grid:{left:55,right:55,top:40,bottom:40}})}(),function(){const a=ba(ca.value);if(!a)return;const e=oa.value.signal_stats;a.setOption({backgroundColor:"transparent",tooltip:{trigger:"item",formatter:a=>`${a.name}: ${(100*a.value).toFixed(1)}%`},series:[{type:"pie",radius:["35%","70%"],data:e.map(a=>({name:a.name,value:+a.weight.toFixed(4)})),label:{formatter:a=>`${a.name}\n${(100*a.value).toFixed(1)}%`,color:"#e0e0e0"}}]})}(),xa(da.value,oa.value.cross_ic_before),xa(ua.value,oa.value.cross_ic_after),function(){const a=ba(pa.value);if(!a||!oa.value)return;const e=oa.value.ic_decay,l=oa.value.ic_horizons,t=[...oa.value.signal_stats.map(a=>a.name),"Stacked"],s=["#5b8af5","#4caf72","#f5a623","#e05c5c","#b39ddb","#80deea"],i=t.map((a,t)=>({name:a,type:"line",data:l.map(l=>e[l]?.[a]??null),lineStyle:"Stacked"===a?{width:2.5}:{type:"dashed",width:1.5},itemStyle:{color:s[t%s.length]},symbol:"circle",symbolSize:6}));a.setOption({backgroundColor:"transparent",tooltip:{trigger:"axis"},legend:{top:5,textStyle:{color:"#aaa"}},xAxis:{type:"category",data:l,name:"Горизонт (периодов)",nameLocation:"middle",nameGap:30,axisLabel:{color:"#aaa"}},yAxis:{name:"Mean IC",splitLine:{lineStyle:{color:"#333"}}},series:i,grid:{left:60,right:20,top:40,bottom:50}})}(),function(){const a=ba(va.value);if(!a||!oa.value)return;const e=oa.value.ic_time_series,l=Object.keys(e),t=e[l[0]]?.length??0,s=Array.from({length:t},(a,e)=>e+1),i=["#4caf72","#5b8af5","#f5a623","#e05c5c","#b39ddb","#80deea"],r=l.map((a,l)=>({name:a,type:"line",data:e[a],lineStyle:"stacked"===a?{width:2}:{type:"dashed",width:1,opacity:.7},itemStyle:{color:i[l%i.length]},symbol:"none",smooth:!1}));a.setOption({backgroundColor:"transparent",tooltip:{trigger:"axis"},legend:{top:5,textStyle:{color:"#aaa"}},xAxis:{type:"category",data:s,name:"Период",nameLocation:"middle",nameGap:25,axisLabel:{color:"#aaa"}},yAxis:{name:"IC",splitLine:{lineStyle:{color:"#333"}}},series:r,grid:{left:55,right:20,top:40,bottom:50}})}()}function xa(a,e,l){const t=ba(a);if(!t||!oa.value)return;const s=oa.value.signal_stats.map(a=>a.name),i=s.length,r=[];for(let o=0;o<i;o++)for(let a=0;a<i;a++)r.push([a,o,+e[o][a].toFixed(3)]);t.setOption({backgroundColor:"transparent",tooltip:{formatter:a=>`${s[a.data[1]]} vs ${s[a.data[0]]}: ${a.data[2]}`},xAxis:{type:"category",data:s,axisLabel:{color:"#aaa",rotate:30}},yAxis:{type:"category",data:s,axisLabel:{color:"#aaa"}},visualMap:{min:-1,max:1,calculable:!0,inRange:{color:["#e05c5c","#1a1a2e","#4caf72"]},textStyle:{color:"#aaa"},right:5,top:"middle"},series:[{type:"heatmap",data:r,label:{show:!0,formatter:a=>a.data[2].toFixed(2),color:"#fff",fontSize:11}}],grid:{left:80,right:80,top:10,bottom:50}})}function wa(a){return a>.05?"ok-val":a>0?"warn-val":"danger-val"}function Ca(a){return a>.5?"ok-val":a>0?"warn-val":"danger-val"}return t(oa,async a=>{a&&(await m(),ka())}),(a,e)=>(f(),s("div",b,[e[35]||(e[35]=i("div",{class:"page-header"},[i("h1",null,"Orthogonal Alpha Stacking"),i("p",{class:"subtitle"}," Residualization · IC / IR Analysis · Cross-Signal Diversification · Optimal Combination ")],-1)),i("div",k,[e[14]||(e[14]=i("h2",null,"Параметры",-1)),i("div",x,[i("div",w,[e[6]||(e[6]=i("label",null,"Метод ортогонализации",-1)),o(i("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>_.value.ortho_method=a)},[...e[5]||(e[5]=[i("option",{value:"sequential"},"Sequential (Gram-Schmidt)",-1),i("option",{value:"pairwise"},"Pairwise (каждый vs все)",-1)])],512),[[n,_.value.ortho_method]]),e[7]||(e[7]=i("span",{class:"hint"},"Sequential — порядок важен (сигнал 1 — базовый).",-1))]),i("div",C,[e[8]||(e[8]=i("label",null,"Shrinkage к равным весам",-1)),o(i("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>_.value.shrinkage=a),type:"number",min:"0",max:"1",step:"0.05"},null,512),[[c,_.value.shrinkage,void 0,{number:!0}]]),e[9]||(e[9]=i("span",{class:"hint"},"0 = чисто IR², 1 = равные веса.",-1))]),i("div",I,[e[10]||(e[10]=i("label",null,"IC горизонты (через запятую)",-1)),o(i("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>la.value=a),type:"text",placeholder:"1,5,10,21"},null,512),[[c,la.value]]),e[11]||(e[11]=i("span",{class:"hint"},"Периоды для decay анализа.",-1))])]),i("div",S,[e[12]||(e[12]=i("label",null,"Названия сигналов (через запятую)",-1)),o(i("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>ta.value=a),type:"text",placeholder:"Momentum,Reversal,Quality,Value"},null,512),[[c,ta.value]])]),e[15]||(e[15]=i("div",{class:"format-help"},[i("h4",null,"Формат данных"),i("p",null,[d(" Введите данные в виде CSV: каждая строка = один период + один актив, столбцы: "),i("code",null,"period, asset, signal_1, signal_2, ..., fwd_return"),d(". Последний столбец — форвардная доходность, остальные после первых двух — сигналы. ")]),i("p",{class:"hint"},"Пример (2 периода, 3 актива, 2 сигнала):"),i("pre",{class:"code-example"},"0,0,0.5,0.2,0.01\n0,1,-0.3,0.4,-0.005\n0,2,0.1,-0.1,0.003\n1,0,-0.1,0.4,-0.002\n1,1,0.3,-0.2,0.008\n1,2,0.2,0.3,0.001")],-1)),i("div",F,[e[13]||(e[13]=i("label",null,"Данные (period, asset, sig_1, ..., sig_N, fwd_return)",-1)),o(i("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>sa.value=a),rows:"10",placeholder:"0,0,0.5,0.2,0.01\n0,1,-0.3,0.4,-0.005\n0,2,0.1,-0.1,0.003\n1,0,-0.1,0.4,-0.002\n..."},null,512),[[c,sa.value]]),fa.value?(f(),s("div",A,u(fa.value),1)):r("",!0),ga.value?(f(),s("div",R,u(ga.value),1)):r("",!0)]),i("div",$,[i("button",{class:"btn-primary",onClick:_a,disabled:ia.value||!!ga.value||!sa.value.trim()},u(ia.value?"Вычисление...":"Запустить анализ"),9,L),i("button",{class:"btn-secondary",onClick:ya},"Демо-данные")]),ra.value?(f(),s("div",j,u(ra.value),1)):r("",!0)]),oa.value?(f(),s(p,{key:0},[i("div",N,[i("div",O,[e[16]||(e[16]=i("div",{class:"kpi-label"},"IC стэка",-1)),i("div",{class:v(["kpi-value",wa(oa.value.stack_ic)])},u((100*oa.value.stack_ic).toFixed(2))+"% ",3),e[17]||(e[17]=i("div",{class:"kpi-sub"},"mean Spearman rank IC",-1))]),i("div",V,[e[18]||(e[18]=i("div",{class:"kpi-label"},"IR стэка",-1)),i("div",{class:v(["kpi-value",Ca(oa.value.stack_ir)])},u(oa.value.stack_ir.toFixed(3)),3),e[19]||(e[19]=i("div",{class:"kpi-sub"},"IC / std(IC)",-1))]),i("div",T,[e[20]||(e[20]=i("div",{class:"kpi-label"},"Avg Cross-IC до",-1)),i("div",z,u((100*oa.value.avg_cross_ic_before).toFixed(1))+"%",1),e[21]||(e[21]=i("div",{class:"kpi-sub"},"средняя корреляция сигналов",-1))]),i("div",M,[e[22]||(e[22]=i("div",{class:"kpi-label"},"Avg Cross-IC после",-1)),i("div",q,u((100*oa.value.avg_cross_ic_after).toFixed(1))+"%",1),e[23]||(e[23]=i("div",{class:"kpi-sub"},"после ортогонализации",-1))]),i("div",U,[e[24]||(e[24]=i("div",{class:"kpi-label"},"Diversification Ratio",-1)),i("div",G,u(oa.value.diversification_ratio>100?">100×":oa.value.diversification_ratio.toFixed(1)+"×"),1),e[25]||(e[25]=i("div",{class:"kpi-sub"},"Cross-IC снижение",-1))]),i("div",D,[e[26]||(e[26]=i("div",{class:"kpi-label"},"Сигналов / Активов",-1)),i("div",P,u(oa.value.n_signals)+" / "+u(oa.value.n_assets),1),i("div",B,u(oa.value.n_periods)+" периодов",1)])]),i("div",E,[i("div",Q,[e[27]||(e[27]=i("h3",null,"IC / IR: до и после ортогонализации",-1)),i("div",{ref_key:"irBarChart",ref:na,class:"chart"},null,512)]),i("div",H,[e[28]||(e[28]=i("h3",null,"Веса стэкингового портфеля",-1)),i("div",{ref_key:"weightsChart",ref:ca,class:"chart"},null,512)])]),i("div",J,[i("div",K,[e[29]||(e[29]=i("h3",null,"Cross-IC до ортогонализации",-1)),i("div",{ref_key:"crossIcBefore",ref:da,class:"chart"},null,512)]),i("div",W,[e[30]||(e[30]=i("h3",null,"Cross-IC после ортогонализации",-1)),i("div",{ref_key:"crossIcAfter",ref:ua,class:"chart"},null,512)])]),i("div",X,[e[31]||(e[31]=i("h3",null,"IC Decay по горизонтам",-1)),i("div",{ref_key:"decayChart",ref:pa,class:"chart tall-chart"},null,512)]),i("div",Y,[e[32]||(e[32]=i("h3",null,"IC во времени (горизонт 1 период)",-1)),i("div",{ref_key:"icTimeChart",ref:va,class:"chart tall-chart"},null,512)]),i("div",Z,[e[34]||(e[34]=i("h3",null,"Детали по сигналам",-1)),i("table",aa,[e[33]||(e[33]=i("thead",null,[i("tr",null,[i("th",null,"Сигнал"),i("th",null,"IC (raw)"),i("th",null,"IC std (raw)"),i("th",null,"IR (raw)"),i("th",null,"IC (ortho)"),i("th",null,"IC std (ortho)"),i("th",null,"IR (ortho)"),i("th",null,"Вес в стэке")])],-1)),i("tbody",null,[(f(!0),s(p,null,h(oa.value.signal_stats,a=>(f(),s("tr",{key:a.name},[i("td",null,[i("strong",null,u(a.name),1)]),i("td",{class:v(wa(a.raw_ic))},u((100*a.raw_ic).toFixed(2))+"%",3),i("td",null,u((100*a.raw_ic_std).toFixed(2))+"%",1),i("td",{class:v(Ca(a.raw_ir))},u(a.raw_ir.toFixed(3)),3),i("td",{class:v(wa(a.ortho_ic))},u((100*a.ortho_ic).toFixed(2))+"%",3),i("td",null,u((100*a.ortho_ic_std).toFixed(2))+"%",1),i("td",{class:v(Ca(a.ortho_ir))},u(a.ortho_ir.toFixed(3)),3),i("td",ea,u((100*a.weight).toFixed(1))+"%",1)]))),128))])])])],64)):r("",!0)]))}}),[["__scopeId","data-v-4855e591"]]);export{la as default};
